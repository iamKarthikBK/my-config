(self.webpackChunk=self.webpackChunk||[]).push([[9561],{64078:(e,t,n)=>{n.d(t,{X:()=>N});var i,a=n(59312),s=n(27378),o=n(57050),r=n(19962),l=n(5114),d=n(44060),c=n(67424),m=n(89894),u=n(32096),p=n(40327),h=n(5739),g=n(98403),f=n(49708),b=n(85985),v=n(41398),k=n(24209),y=n(17343),I=n(38194),x=n(598),_=n(50628),E=n(25781),w=n(83078),U=n(18625);!function(e){var t="scrollaction";e.emit=function(e){return self.dispatchEvent(new CustomEvent(t,{detail:e}))},e.observe=U.P((function(){return f.R(self,t)}))}(i||(i={}));var C=n(42103),S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._subs=[],t._outOfTarget=function(e){return function(t){return!r.UL.hasPoint(t.getBoundingClientRect(),e)}},t}return(0,a.ZT)(t,e),t.prototype.componentDidMount=function(){this._listenTooltipAppearance()},t.prototype.componentWillUnmount=function(){this._subs.forEach((function(e){return e.unsubscribe()})),this._subs=[],this.context.hide()},t.prototype.render=function(){return s.createElement(h.F.div,{"data-role":"tooltip"},this.context.state.view(this.props.children))},t.prototype._listenTooltipAppearance=function(){var e=this,t=f.R(document,"keydown").pipe(b.h((function(e){return e.keyCode===E.R.ESC_CODE}))),n=f.R(document,"mousedown").pipe(v.M(this.context.state),b.h((function(t){var n=t[0],i=t[1];return(0,p.pipe)(i,l.map((function(e){return e.target})),l.filter((function(){return r.pK(n.target)})),w.wo(e._outOfTarget({x:n.clientX,y:n.clientY})))}))),a=k.T(t,n,f.R(document,"scroll"),i.observe.pipe(b.h((function(e){return"show"===e.detail})))).pipe(y.h(g.PU),I.B());this._subs=[this.context.hasContent.pipe(b.h(Boolean),x.c(a.pipe(_.P()))).subscribe(this.context.hide),this.context.hasContent.pipe(b.h(Boolean),x.c(k.T(g.gw(!0,500),a.pipe(y.h(!1))).pipe(_.P())),b.h(Boolean)).subscribe(this.context.show)]},t.contextType=C.G.Context,t}(s.Component),N=function(){return s.createElement(S,null,(0,o.ls)(l.map((function(e){return s.createElement(c.t.ByAbsoluteRect,(0,a.pi)({rect:r.UL.fromEl(e.target),className:A.container},c.t.Alignment.toSelector(e.alignment),{withPin:!0}),s.createElement("div",{className:A.content},e.content))})),l.toNullable))},T={position:"fixed",zIndex:u.DY,pointerEvents:"none",$nest:{"@media print":{visibility:"hidden"}}},M={padding:"".concat(m.ux.rem(.25)," ").concat(m.ux.rem(1)),borderRadius:m.ux.rem(u.fx),background:d.Il.BackgroundTooltip,color:d.Il.CoreNeutral1,textAlign:"center",whiteSpace:"nowrap",letterSpacing:m.ux.px(.25),fontSize:m.ux.rem(.75),lineHeight:m.ux.rem(1)},A=m.ux.stylesheet({container:[T],content:[M]})},26856:(e,t,n)=>{n.r(t),n.d(t,{createReaderGmailThreadIntegration:()=>Or});var i,a=n(17771),s=n(57050),o=n(64015),r=n(48044),l=n(45614),d=n(29511),c=n(34379),m=n(70631),u=n(38983);!function(e){e.create=function(e,t,n){return u.h.combine(e,n,t,((e,t,n)=>({threadId:e.threadId,subject:e.subject,loggedUser:e.loggedUser,messageCount:e.messageCount,avatars:e.avatars,messageIndexToIdMap:e.messageIndexToIdMap,expandedMessages:(0,s.zG)(e.expandedMessages,r.Su(((e,i)=>({message:(0,s.zG)(i,m.UI((e=>({id:e.id,index:e.index,author:e.context.author,audience:e.context.audience,links:e.context.links,wordCount:e.textMap.getPlainText().trim().split(/\s+/).length,date:e.context.date})))),summary:n.get(e)||(m.VZ(i)||m.IR(i)?i:m.x5),annotations:t.get(e)||(m.VZ(i)||m.IR(i)?i:m.x5)}))))})))}}(i||(i={}));var p,h=n(91625),g=n(27378),f=n(8125),b=n(5114);!function(e){e.overview="overview",e.coreUserJourney="coreUserJourney",e.pinning="pinning"}(p||(p={}));const v=[p.overview,p.coreUserJourney,p.pinning];function k(e){return"collapsed"!==e.kind}function y(e){return"messageView"===e.kind}function I(e){return"pinnedView"===e.kind}function x(e){return"onboardingView"===e.kind}function _(e){return"messageView"===e.kind&&m.d6(e.message)&&(0,s.zG)(e.summary,b.map((0,f.Kg)(m.d6,m.VZ,m.IR)),b.getOrElse(s.W8))&&(0,s.zG)(e.questions,b.map((0,f.Kg)(m.d6,m.VZ,m.IR)),b.getOrElse(s.W8))&&(0,s.zG)(e.mentions,b.map((0,f.Kg)(m.d6,m.VZ,m.IR)),b.getOrElse(s.W8))&&(0,s.zG)(e.links,b.map((0,f.Kg)(m.d6,m.VZ,m.IR)),b.getOrElse(s.W8))}var E=n(77176),w=n(5739),U=n(16027),C=n(60797),S=n(76974),N=n(61922);const T={textBoxPlaceholder:"Share your thoughts here.",textBoxAriaLabel:"Feedback text",submitButton:"Submit",cancelButton:"Close",requiredLabel:"Required"},M={onboarding:{optInButton:"Try it out",optOutButton:"No, thanks",prevIconTooltip:"Previous",nextIconTooltip:"Next",badge:"NEW",betaTermsUrl:"https://www.grammarly.com/beta-feature-terms",stepOfN:e=>`${e} OF 3`,overview:{phase0:{title:"Introducing email recaps",body:"Now Grammarly can automatically summarize key points to help you reply faster."},phase1:{title:"Introducing email recaps",body:"Now Grammarly can automatically summarize key points and follow-up actions."},phase2:{title:"Introducing email recaps",body:"Now Grammarly can automatically recap key points and help you decide whether you need to reply."},videoSrc:"https://d201kpdrh73vuz.cloudfront.net/reader/onboarding-overview.gif"},coreUserJourney:{title:"Reply faster",body:"Everything you need at your fingertips. Focus on writing, not hunting for details.",videoSrc:"https://d201kpdrh73vuz.cloudfront.net/reader/onboarding-core-user-journey.gif"},pinning:{title:"Choose what's important",body:"Pin key points and things to follow up on while you're reading.",videoSrc:"https://d201kpdrh73vuz.cloudfront.net/reader/onboarding-pinning.gif"}},expandedPanel:{viewButton:{thread:"Messages",pins:"Pinned"},goLeftIconTooltip:"Previous message",goRightIconTooltip:"Next message",jumpFirstIconTooltip:"Jump to first message",jumpLastIconTooltip:"Jump to last message",actionsButtonTooltip:"Actions",itemMenu:{copyTooltip:"Copy",pinTooltip:"Add pin",unpinTooltip:"Remove pin",dismissTooltip:"Dismiss",likeTooltip:"Helpful",dislikeTooltip:"Unhelpful",itemLikedTooltip:"This item is helpful",itemDislikedTooltip:"This item isn't helpful"},threadView:{summary:{title:"Summary",emptyTitle:"No items found",emptyBody:"Did we miss something?",emptyCTA:"Help us improve"},needsResponse:{title:"Follow-ups",emptyTitle:"No follow-ups found",emptyBody:"Did we miss something?",emptyCTA:"Help us improve"},mentions:{title:"Mentions",emptyTitle:"No mentions found",emptyBody:"Did we miss something?",emptyCTA:"Help us improve"},links:{title:"Links and attachments",emptyTitle:"No links or attachments found",emptyBody:"Did we miss something?",emptyCTA:"Help us improve"}},pinnedView:{summary:{title:"Summary",emptyTitle:"Nothing pinned yet",emptyBody:"Pin important summary items to find them more easily.",emptyCTA:"Return to Messages tab"},needsResponse:{title:"Follow-ups",emptyTitle:"Nothing pinned yet",emptyBody:"Pin follow-ups to find them more easily.",emptyCTA:"Return to Messages tab"},mentions:{title:"Mentions",emptyTitle:"Nothing pinned yet",emptyBody:"Pin mentioned items to find them more easily.",emptyCTA:"Return to Messages tab"},links:{title:"Links and attachments",emptyTitle:"Nothing pinned yet",emptyBody:"Pin links and attachments to find them more easily",emptyCTA:"Return to Messages tab"}}},collapseIconTooltip:"Hide email recap",expandIconTooltip:"Open email recap",recapExpandTooltip:"Open email recap",recapCollapseTooltip:"Hide email recap",sendFeedbackButton:"Send feedback",genericFeedbackDialog:{...T,ratings:["It's not helpful","It could be better","It's okay","It's pretty helpful","It's great"],title:"Is Grammarly Recap helpful?"},tellsUsMoreFeedbackDialog:{...T,cancelButton:"Skip",title:"Tell us more",description:"We'd love to hear what's going well and how we can improve."},notifications:{thankYou:"Thank you for your feedback"},enableInlineHighlights:"Show highlight",disableInlineHighlights:"Hide highlight"};var A,F,G,z,P,L,K,R,O=n(85985),B=n(22232);!function(e){e.first="first",e.last="last",e.left="left",e.right="right"}(A||(A={})),function(e){e.left="left",e.right="right"}(F||(F={})),function(e){e.onboardingPanel="onboardingPanel",e.readerPanel="readerPanel"}(G||(G={})),function(e){e.collapseButton="collapseButton",e.recapButton="recapButton"}(z||(z={})),function(e){e.expandButton="expandButton",e.recapButton="recapButton"}(P||(P={})),function(e){e.messagesButton="messagesButton",e.emptyPinnedSummaries="emptyPinnedSummaries",e.emptyPinnedFollowUps="emptyPinnedFollowUps",e.emptyPinnedMentions="emptyPinnedMentions",e.emptyPinnedLinks="emptyPinnedLinks"}(L||(L={})),function(e){let t;!function(e){e.panelMounted="panelMounted",e.collapse="collapse",e.expand="expand",e.threadViewNavigate="threadViewNavigate",e.onboardingViewNavigate="onboardingViewNavigate",e.openPinnedView="openPinnedView",e.openMessageView="openMessageView",e.optIn="optIn",e.optOut="optOut",e.closeNotification="closeNotification",e.submitFeedback="submitFeedback",e.skipFeedback="skipFeedback",e.closeFeedback="closeFeedback",e.openFeedback="openFeedback",e.columnScroll="columnScroll",e.itemBlur="itemBlur",e.itemMounted="itemMounted",e.openItemMenu="openItemMenu",e.linkClick="linkClick",e.check="check",e.pin="pin",e.copy="copy",e.dismiss="dismiss",e.like="like",e.dislike="dislike",e.toggleInlineHighlights="toggleInlineHighlights"}(t=e.Kind||(e.Kind={})),e.matchSubmitFeedback=function(e){return t=>{switch(t.source.kind){case"collapsedPanelButton":return e.collapsedPanelButton(t);case"expandedPanelHeaderButton":return e.expandedPanelHeaderButton(t);case"emptySummaryViewButton":case"emptyFollowUpsViewButton":case"emptyMentionsViewButton":case"emptyLinksViewButton":return e.emptyViewButton(t);case"itemPanelMenu":return e.itemMenu(t);default:(0,B.vE)(t.source)}}},e.itemTypeIs=function(e){return t=>t.itemType===e},e.is=function(e){return t=>t.kind===e}}(K||(K={})),function(e){e.ofType=function(e){return O.h(K.is(e))}}(R||(R={}));var D=n(64757),V=n(76168);const H=U.UI.Grid.make((({slots:e,notify:t})=>g.createElement(w.F.div,{className:V.notification},e.icon,e.content,g.createElement(D.zx.Ghost,{name:"close-notification",onClick:t({kind:K.Kind.closeNotification})},g.createElement(N.JO.Close,null))))),Z=U.UI.Knot.make(H,{icon:U.UI.Node.make((()=>g.createElement(N.JO.NotificationInfo,null))),content:U.UI.Node.make((()=>g.createElement("span",null,M.notifications.thankYou)))});function j(e){return t=>e.actions.next(t)}function q(e){return U.Z.composeKnot({root:U.Z.fromSideEffect(j(e),null),icon:()=>S.of(null),content:()=>S.of(null)})}const $=U.UI.Union.make("kind",{thankYou:Z}),W=U.UI.Union.asOption($);function Q(e){return U.Z.composeUnion({Some:U.Z.composeKnot({value:U.Z.composeUnion({thankYou:q(e)},(()=>e.state.pipe(E.U((e=>e.notification)),C.oA)))}),None:()=>S.of(null)},(()=>e.state.pipe(E.U((e=>e.notification)))))}var J=n(23556),Y=n(57053),X=n(55415),ee=n(22667),te=n(2844),ne=n(12187),ie=n(78870);const ae=e=>U.UI.Grid.make((({slots:t,view:n,notify:i})=>g.createElement("div",{className:ie.dialog},g.createElement("header",{className:ie.header},g.createElement("div",{className:ie.headerGroup},g.createElement(ee.K,{size:16}),"Help us improve"),g.createElement(w.F.Fragment,null,n("source").pipe(E.U((e=>g.createElement(D.zx.Ghost,{onClick:i({kind:"close",source:e}),name:"feedback-dialog-close"},g.createElement(N.JO.Close,null))))))),g.createElement(w.F.Fragment,null,t.title,t.rating,t.description),g.createElement(w.F.div,{role:"textbox",...(0,ne.Sh)(ie.textbox,n("formErrors").pipe(E.U((e=>e.has("textRequired")?ie.requiredTextBox:void 0)))),contentEditable:!0,"aria-placeholder":e.textBoxPlaceholder,"data-placeholder":e.textBoxPlaceholder,"aria-label":e.textBoxAriaLabel,onInput:e=>i({kind:"text",text:e.target.innerText})()}),g.createElement(w.F.Fragment,null,n("formErrors").pipe(E.U((t=>t.has("textRequired")?g.createElement("span",{className:ie.requiredLabel},e.requiredLabel):null)))),g.createElement("div",{className:ie.buttons},g.createElement(w.F.Fragment,null,n("source").pipe(E.U((t=>g.createElement(g.Fragment,null,g.createElement(D.zx.Primary,{onClick:i({kind:"submit",source:t}),name:"feedback-dialog-submit"},e.submitButton),g.createElement(D.zx.Ghost,{onClick:i({kind:"skip",source:t}),name:"feedback-dialog-skip"},e.cancelButton))))))))));function se(e,t){const n=u.h.create({text:"",formErrors:new Set});return U.Z.fromSideEffect((i=>{switch(i.kind){case"text":n.modify((e=>({text:i.text,formErrors:(0,s.zG)(new Set(e.formErrors),(e=>(e.delete("textRequired"),e)))})));break;case"close":n.set({text:"",formErrors:new Set}),e.actions.next({kind:K.Kind.closeFeedback,source:i.source});break;case"skip":n.set({text:"",formErrors:new Set}),e.actions.next({kind:K.Kind.skipFeedback,source:i.source});break;case"submit":{""===n.get().text.trim()&&n.lens("formErrors").set(new Set(["textRequired"]));const a=(0,s.zG)(t,b.chain((e=>e())));0===n.get().formErrors.size&&(b.isNone(t)||b.isSome(a))&&(e.actions.next({kind:K.Kind.submitFeedback,source:i.source,text:n.get().text,scoreResult:a}),n.set({text:"",formErrors:new Set}));break}default:(0,B.vE)(i)}}),te.aj([e.state.pipe(E.U((e=>e.feedbackDialog)),C.oA),n]).pipe(E.U((([{source:e},{formErrors:t}])=>({source:e,formErrors:t})))))}var oe=n(90845),re=n(93508),le=n(19962),de=n(61033);const ce=({onMount:e})=>g.createElement("div",{ref:e,className:de.panelOverlay}),me=U.UI.Grid.make((({state:e,slots:t})=>{const{ref:n,onMount:i}=oe.P.useElWatcher(),a=te.aj([e,n.pipe(E.U(b.map(le.UL.fromEl)),C.oA)]).pipe(E.U((([e,t])=>({..."bottom"===e.dialogSide?{top:e.sourceRect.bottom-t.top}:"top"===e.dialogSide?{bottom:t.bottom-e.sourceRect.bottom+e.sourceRect.height}:{},..."right"===e.alignment?{right:t.right-e.sourceRect.right}:"left"===e.alignment?{left:e.sourceRect.left-t.left}:{}}))),re.O({}));return g.createElement(g.Fragment,null,g.createElement(ce,{onMount:i}),g.createElement(w.F.div,{className:de.dialog,style:a},t.content))}));function ue(e){return()=>e.state.pipe(E.U((e=>e.feedbackDialog)),C.oA,E.U((e=>e.position)))}var pe=n(56229);const he=U.UI.Node.make((({state:e,notify:t})=>g.createElement("div",{className:pe.rating},g.createElement(Y.i,{maxRating:M.genericFeedbackDialog.ratings.length,ratingLabels:M.genericFeedbackDialog.ratings,className:pe.ratingContainer,ratingStarsClassName:pe.ratingStars,ratingLegendClassName:pe.ratingLegend,ratingLabelsClassName:pe.ratingLabels,onChange:e=>t({score:e})(),ariaLabel:M.genericFeedbackDialog.title}),g.createElement(w.F.Fragment,null,e.pipe(E.U((e=>e?g.createElement("span",{className:pe.requiredLabel},M.genericFeedbackDialog.requiredLabel):null))))))),ge=U.UI.Knot.make(ae(M.genericFeedbackDialog),{title:U.UI.Node.make((()=>g.createElement("h1",{className:pe.title},M.genericFeedbackDialog.title))),rating:he,description:U.UI.Node.empty}),fe=U.UI.Knot.make(me,{content:ge}),be=U.UI.Union.asOption(fe);function ve(e){const t=u.h.create({score:b.none,showRequired:!1});return U.Z.composeKnot({root:se(e,b.some((()=>(0,s.zG)(t.get().score,(e=>(b.isNone(e)&&t.lens("showRequired").set(!0),e)),b.map((e=>({score:e,label:M.genericFeedbackDialog.ratings[e]||""}))))))),title:()=>S.of(null),rating:U.Z.fromSideEffect((e=>t.set({score:b.some(e.score),showRequired:!1})),t.view("showRequired")),description:()=>S.of(null)})}function ke(e,t){return U.Z.composeUnion({Some:U.Z.composeKnot({value:U.Z.composeKnot({root:ue(e),content:ve(e)})}),None:()=>S.of(null)},(()=>e.state.pipe(E.U((0,s.ls)(X.ei("feedbackDialog"),b.filter(t))))))}var ye=n(32952),Ie=n(41398),xe=n(2834);const _e=U.UI.Node.make((({state:e,notify:t})=>{const{ref:n,onMount:i}=oe.P.useElWatcher(),a=g.useRef(new ye.xQ);return oe.P.useSubscriptionTo(a.current.pipe(Ie.M(n),E.U((([e,t])=>b.map(le.UL.fromEl)(t))),C.oA,xe.b((e=>t({kind:"openFeedback",buttonRect:e})())))),g.createElement(w.F.Fragment,null,e.pipe(E.U((({active:e,isSupported:t})=>t?g.createElement(D.zx.Ghost,{mount:i,onClick:()=>a.current.next(),name:"panel-open-feedback-button",title:M.sendFeedbackButton,ariaLabel:M.sendFeedbackButton,active:e},g.createElement(N.JO.AssistantFeedback,null)):null))))}));function Ee(e,t){return U.Z.fromSideEffect((n=>{if("openFeedback"===n.kind)t?e.actions.next({kind:K.Kind.openFeedback,source:{kind:"collapsedPanelButton"},position:{sourceRect:n.buttonRect,dialogSide:"top",alignment:"right"}}):e.actions.next({kind:K.Kind.openFeedback,source:{kind:"expandedPanelHeaderButton"},position:{sourceRect:n.buttonRect,dialogSide:"bottom",alignment:"right"}});else(0,B.vE)(n.kind)}),e.state.pipe(E.U((e=>e.feedbackDialog)),E.U((n=>({active:(0,s.zG)(n,b.fold(s.jv,(({source:e})=>t?"collapsedPanelButton"===e.kind:"expandedPanelHeaderButton"===e.kind))),isSupported:e.isSubmitFeedbackDialogSupported})))))}const we=U.UI.Grid.make((({slots:e})=>g.createElement(w.F.Fragment,null,e.button,e.dialog))),Ue=U.UI.Knot.make(we,{button:_e,dialog:be});function Ce(e,t,n){return U.Z.composeKnot({button:Ee(e,t),dialog:ke(e,n)})}var Se;!function(e){e.InlineHighlightsDisabled=({className:e,width:t=24})=>g.createElement(N.a1,{className:e,width:t,viewBox:"0 0 24 24"},g.createElement("path",{d:"M6.142,16.333L3.449,19.026C3.306,19.169 3.263,19.384 3.34,19.571C3.418,19.758 3.6,19.88 3.802,19.88L7.338,19.88C7.471,19.88 7.598,19.827 7.692,19.733L8.617,18.808L11.784,18.641C11.907,18.635 12.024,18.583 12.111,18.496L20.596,10.01C21.182,9.425 21.182,8.475 20.596,7.889C20.596,7.889 17.061,4.354 17.061,4.354C16.475,3.768 15.525,3.768 14.939,4.354L7.515,11.778L6.454,12.839C6.367,12.926 6.315,13.043 6.309,13.166L6.142,16.333ZM8.222,12.485L12.465,16.728L11.54,17.653C11.54,17.653 8.595,17.808 8.595,17.808C8.595,17.808 7.142,16.355 7.142,16.355L7.297,13.41L8.222,12.485ZM13.172,16.021L8.929,11.778L15.646,5.061C15.842,4.865 16.158,4.865 16.354,5.061L19.889,8.596C20.084,8.791 20.084,9.108 19.889,9.303L13.172,16.021Z",fill:"inherit",stroke:"none"})),e.InlineHighlightsEnabled=({className:e,width:t=24})=>g.createElement(N.a1,{className:e,width:t,viewBox:"0 0 24 24"},g.createElement("path",{d:"M14.939,4.354C15.525,3.768 16.475,3.768 17.061,4.354L20.596,7.889C21.182,8.475 21.182,9.425 20.596,10.01L18.934,11.673C18.533,11.574 18.117,11.516 17.689,11.503L19.889,9.303C20.084,9.108 20.084,8.791 19.889,8.596L16.353,5.061C16.158,4.865 15.842,4.865 15.646,5.061L8.929,11.778L12.078,14.927C11.921,15.257 11.794,15.603 11.699,15.962L8.222,12.485L7.297,13.41L7.142,16.355L8.595,17.808L11.502,17.655C11.51,17.995 11.547,18.327 11.61,18.651L8.616,18.808L7.691,19.733C7.598,19.827 7.47,19.88 7.338,19.88L3.802,19.88C3.6,19.88 3.418,19.758 3.34,19.571C3.263,19.384 3.306,19.169 3.449,19.026L6.141,16.333L6.308,13.166C6.315,13.043 6.367,12.926 6.454,12.839L14.939,4.354Z",fill:"inherit",stroke:"none"}),g.createElement("path",{d:"M22,17.5C22,15.015 19.985,13 17.5,13C15.015,13 13,15.015 13,17.5C13,19.985 15.015,22 17.5,22C19.985,22 22,19.985 22,17.5ZM21,17.5C21,19.433 19.433,21 17.5,21C15.567,21 14,19.433 14,17.5C14,15.567 15.567,14 17.5,14C19.433,14 21,15.567 21,17.5Z",fill:"inherit",stroke:"none"}),g.createElement("path",{d:"M20.015,16.765C20.162,16.619 20.162,16.381 20.015,16.235C19.869,16.088 19.631,16.088 19.485,16.235L17,18.72L16.015,17.735C15.869,17.588 15.631,17.588 15.485,17.735C15.338,17.881 15.338,18.119 15.485,18.265L17,19.78L20.015,16.765Z",fill:"inherit",stroke:"none"}))}(Se||(Se={}));const Ne=U.UI.Node.make((({state:e,notify:t})=>g.createElement(w.F.Fragment,null,e.pipe(E.U((({inlineHighlightsEnabled:e,isSupported:n})=>n?g.createElement(D.zx.Ghost,{onClick:t({kind:"toggleInlineHighlights",enabled:!e}),name:"panel-open-feedback-button",title:e?M.disableInlineHighlights:M.enableInlineHighlights,ariaLabel:e?M.disableInlineHighlights:M.enableInlineHighlights,key:"inlineHighlightsButton"},e?g.createElement(Se.InlineHighlightsEnabled,null):g.createElement(Se.InlineHighlightsDisabled,null)):null))))));function Te(e){return U.Z.fromSideEffect((({enabled:t})=>{e.actions.next({kind:K.Kind.toggleInlineHighlights,enabled:t})}),e.inlineHighlightsEnabled.pipe(E.U((t=>({inlineHighlightsEnabled:t,isSupported:e.areInlineHighlightsSupported})))))}var Me=n(64908),Ae=n(86705),Fe=n(53112),Ge=n(58120);const ze=({onClick:e,title:t,focusable:n,browser:i,ariaLabel:a})=>g.createElement(D.zx.Flat,{className:Ge.recapButton,onClick:e,name:"recap-button",title:t,ariaLabel:a,tabIndex:n?0:-1},g.createElement(ee.K,{size:22.4,className:Ge.logo}),g.createElement(Pe,null),g.createElement(Ae.v,{browser:i})),Pe=({color:e=Fe.Z.neutral70})=>g.createElement("svg",{width:"44",height:"10",viewBox:"0 0 44 10",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-label":"Recap",className:Ge.recap},g.createElement("path",{d:"M0 9.54578V0.454902H3.92401C4.53474 0.441273 5.14052 0.567287 5.69515 0.823335C6.18417 1.05365 6.59476 1.42255 6.8759 1.88423C7.168 2.38768 7.31401 2.96257 7.29756 3.54439C7.31546 4.10697 7.17223 4.66295 6.88473 5.14684C6.61248 5.58484 6.21939 5.93477 5.75281 6.15448L7.5994 9.54578H4.9183L3.32033 6.5451H2.46806V9.54578H0ZM2.46804 4.62749H3.33804C3.69403 4.64717 4.04783 4.56065 4.35456 4.37891C4.48182 4.28258 4.58244 4.1554 4.6469 4.00939C4.71137 3.86337 4.73756 3.70334 4.723 3.54439C4.73683 3.38295 4.71041 3.22059 4.64612 3.07185C4.58182 2.92312 4.48164 2.79264 4.35456 2.69212C4.05216 2.49864 3.69646 2.40545 3.33804 2.42578H2.46804V4.62749Z",fill:e}),g.createElement("path",{d:"M8.85059 9.5458V0.454918H15.4024V2.44356H11.3187V4.00606H15.0651V5.99469H11.3187V7.55719H15.3847V9.5458H8.85059Z",fill:e}),g.createElement("path",{d:"M25.1719 3.86399H22.6684C22.6488 3.48459 22.4872 3.12646 22.2156 2.8608C22.0648 2.72733 21.8892 2.6249 21.6988 2.5594C21.5084 2.49389 21.3069 2.46658 21.1059 2.47905C20.8315 2.46406 20.5576 2.51745 20.3089 2.63444C20.0602 2.75143 19.8445 2.92836 19.681 3.14933C19.3227 3.69763 19.15 4.34649 19.1883 5.00036C19.1409 5.66688 19.3157 6.33031 19.6854 6.8869C19.8521 7.09645 20.0662 7.26331 20.3101 7.37369C20.5541 7.48407 20.8208 7.53479 21.0882 7.52167C21.4779 7.542 21.862 7.42235 22.1713 7.18431C22.4451 6.94828 22.6221 6.61948 22.6684 6.26097L25.1719 6.27873C25.1359 6.68719 25.0261 7.08574 24.8479 7.45505C24.4293 8.33025 23.6927 9.01287 22.7883 9.36375C22.1411 9.60001 21.4525 9.70142 20.7647 9.66174C20.0769 9.62206 19.4045 9.44212 18.7888 9.133C18.1238 8.76993 17.5792 8.22072 17.2218 7.5527C16.8183 6.76399 16.6213 5.88584 16.6493 5.00033C16.62 4.11171 16.8219 3.23071 17.2352 2.44351C17.5977 1.77593 18.1468 1.22837 18.8154 0.867676C19.4982 0.504684 20.2616 0.319939 21.0348 0.330567C21.7374 0.318011 22.4343 0.458893 23.0768 0.743384C23.6602 1.00422 24.1608 1.42034 24.5238 1.94633C24.906 2.51684 25.1296 3.17864 25.1719 3.86399Z",fill:e}),g.createElement("path",{d:"M28.3137 9.5458H25.6504L28.6511 0.454918H32.0246L35.0254 9.5458H32.3621L31.8382 7.8058H28.8375L28.3137 9.5458ZM29.3968 5.95918H31.2789L30.3734 2.95847H30.3024L29.3968 5.95918Z",fill:e}),g.createElement("path",{d:"M36.2773 9.54575V0.454869H40.2013C40.8155 0.440928 41.4237 0.578119 41.9724 0.854376C42.4653 1.10813 42.8751 1.49788 43.1532 1.97742C43.4429 2.49314 43.5886 3.07729 43.5749 3.66865C43.5901 4.26188 43.4394 4.84758 43.1399 5.35988C42.852 5.83714 42.4307 6.21979 41.9281 6.46071C41.3612 6.72892 40.7395 6.86116 40.1125 6.8469H38.7453V9.54573L36.2773 9.54575ZM38.7453 4.9293H39.6153C39.9848 4.95083 40.3486 4.83012 40.6319 4.59194C40.7558 4.47337 40.8528 4.32958 40.9164 4.1703C40.9799 4.01102 41.0086 3.83995 41.0003 3.66865C41.0097 3.49854 40.9816 3.32845 40.9179 3.17043C40.8542 3.0124 40.7566 2.87032 40.6319 2.75423C40.3461 2.52145 39.9833 2.40425 39.6153 2.42575H38.7453V4.9293Z",fill:e})),Le=U.UI.Grid.make((({state:e,slots:t,notify:n})=>(oe.P.useEffectOnDidMount(n("panelMounted")),g.createElement(w.F.div,{className:Me.panelGrid},g.createElement(w.F.div,{className:Me.header},e.pipe(E.U((({expanded:e,browser:t,focusable:i})=>g.createElement(ze,{onClick:n(e?"collapse":"expand"),title:e?M.recapCollapseTooltip:M.recapExpandTooltip,ariaLabel:e?M.recapCollapseTooltip:M.recapExpandTooltip,browser:t,focusable:i})))),t.header,g.createElement(w.F.div,{className:Me.toolbar},t.toolbar)),t.content))));function Ke(e){return U.Z.fromSideEffect((t=>{switch(t){case"collapse":e.actions.next({kind:K.Kind.collapse,source:z.recapButton});break;case"expand":e.actions.next({kind:K.Kind.expand,source:P.recapButton});break;case"panelMounted":e.actions.next({kind:K.Kind.panelMounted,subject:G.readerPanel});break;default:(0,B.vE)(t)}}),e.state.pipe(E.U((t=>({expanded:k(t),browser:e.browser,focusable:b.isNone(t.feedbackDialog)})))))}const Re=U.UI.Node.make((({state:e,notify:t})=>g.createElement(w.F.Fragment,null,e.pipe(E.U((({expanded:e,focusable:n})=>g.createElement(D.zx.Ghost,{onClick:t(e?"collapse":"expand"),name:"toggle-panel-button",title:e?M.collapseIconTooltip:M.expandIconTooltip,ariaLabel:e?M.collapseIconTooltip:M.expandIconTooltip,tabIndex:n?0:-1},g.createElement(N.JO.Arrow,{direction:e?N.n4.up:N.n4.down}))))))));function Oe(e){return U.Z.fromSideEffect((t=>{switch(t){case"expand":e.actions.next({kind:K.Kind.expand,source:P.expandButton});break;case"collapse":e.actions.next({kind:K.Kind.collapse,source:z.collapseButton});break;default:(0,B.vE)(t)}}),e.state.pipe(E.U((e=>({expanded:k(e),focusable:b.isNone(e.feedbackDialog)})))))}const Be=U.UI.Grid.make((({slots:e})=>g.createElement(w.F.Fragment,null,e.toggleInlineHighlights,e.feedback,e.togglePanel))),De=U.UI.Knot.make(Be,{feedback:Ue,togglePanel:Re,toggleInlineHighlights:Ne}),Ve=U.UI.Knot.make(Le,{header:U.UI.Node.make((()=>g.createElement("div",{className:J.header}))),toolbar:De,content:U.UI.Node.empty});function He(e){return U.Z.composeKnot({root:Ke(e),header:()=>S.of(null),toolbar:U.Z.composeKnot({feedback:Ce(e,!0,(e=>"expandedPanelHeaderButton"===e.source.kind)),togglePanel:Oe(e),toggleInlineHighlights:Te(e)}),content:()=>S.of(null)})}var Ze=n(49708),je=n(83771);const qe=(0,ne.xb)((({children:e})=>g.createElement("h6",{className:je.sectionTitle},e))),$e=e=>U.UI.Grid.make((({slots:t,notify:n})=>{const{onMount:i,ref:a}=oe.P.useElWatcher();return oe.P.useSubscriptionTo(a.pipe(C.cp((e=>Ze.R(e,"scroll"))),xe.b(n("scroll")))),g.createElement("div",{className:je.column,style:{flex:e}},g.createElement("div",{className:je.scrollView,ref:i},g.createElement(qe,null,t.title),t.content))})),We=U.UI.Grid.make((({slots:e})=>g.createElement(w.F.div,{className:je.layout},e.summary,e.questions,e.mentions,e.links))),Qe=350,Je=307,Ye=266,Xe=266;var et=n(26328),tt=n(47397);const nt=({title:e,children:t})=>g.createElement("div",{className:tt.empty},g.createElement(w.F.div,{className:tt.title},e),g.createElement(w.F.div,{className:tt.body},t));var it,at,st=n(62337);!function(e){function t(e){return"itemPanelMenu"===e.kind}e.isCollapsedPanelButton=function(e){return"collapsedPanelButton"===e.kind},e.isExpandedPanelHeaderButton=function(e){return"expandedPanelHeaderButton"===e.kind},e.isReaderItemMenu=t,e.isReaderSummaryItemMenu=function(e){return t(e)&&"summaryItem"===e.itemType},e.isReaderQuestionItemMenu=function(e){return t(e)&&"followUpItem"===e.itemType},e.isReaderPersonItemMenu=function(e){return t(e)&&"mentionItem"===e.itemType},e.isReaderLinkItemMenu=function(e){return t(e)&&"linkItem"===e.itemType}}(it||(it={})),function(e){function t(e){return it.isReaderItemMenu(e.source)}e.isReaderSummaryItemMenu=function(e){return t(e)&&it.isReaderSummaryItemMenu(e.source)},e.isReaderQuestionItemMenu=function(e){return t(e)&&it.isReaderQuestionItemMenu(e.source)},e.isReaderPersonItemMenu=function(e){return t(e)&&it.isReaderPersonItemMenu(e.source)},e.isReaderLinkItemMenu=function(e){return t(e)&&it.isReaderLinkItemMenu(e.source)}}(at||(at={}));var ot=n(35115);const rt=U.UI.Knot.make(ae(M.tellsUsMoreFeedbackDialog),{title:U.UI.Node.make((()=>g.createElement("h1",{className:ot.title},M.tellsUsMoreFeedbackDialog.title))),rating:U.UI.Node.empty,description:U.UI.Node.make((()=>g.createElement("p",{className:ot.description},M.tellsUsMoreFeedbackDialog.description)))}),lt=U.UI.Knot.make(me,{content:rt}),dt=U.UI.Union.asOption(lt);function ct(e,t){return U.Z.composeUnion({Some:U.Z.composeKnot({value:U.Z.composeKnot({root:ue(e),content:U.Z.composeKnot({root:se(e,b.none),title:()=>S.of(null),rating:()=>S.of(null),description:()=>S.of(null)})})}),None:()=>S.of(null)},(()=>e.state.pipe(E.U((0,s.ls)(X.ei("feedbackDialog"),b.filter(t))))))}var mt=n(19429),ut=n(28043),pt=n(66310);const ht={URI:"Observable",map:(e,t)=>e.pipe(E.U(t)),ap:(e,t)=>te.aj([e,t]).pipe(E.U((([e,t])=>e(t)))),of:e=>S.of(e)};function gt(e,t,n){return mt.VF((i=>(0,s.zG)(t(i),ut.x(),pt.w((t=>n.traverseWithIndex(ht)(t,((t,n)=>e(n,t)(i.pipe(O.h((e=>e.key===t)),E.U((e=>e.action)))))))),ut.x())))}var ft=n(99094),bt=n(23063),vt=n(93253);function kt(){return U.UI.Grid.make((({state:e,view:t,slots:n,notify:i})=>{const{ref:a,onMount:o}=oe.P.useElWatcher(),r=g.useRef(new ye.xQ),l=g.useRef(u.h.create(!1));return g.useEffect((()=>{const e=t("item").pipe(bt.q(1)).subscribe((e=>i({kind:"show",item:e})()));return()=>e.unsubscribe()}),[]),oe.P.useSubscriptionTo(r.current.pipe(Ie.M(a),E.U((([e,t])=>(0,s.zG)(t,b.map((t=>{let n=0,i=0;const a=t.offsetParent;let s=t;for(;s&&s!==a;)n+=s.scrollTop,i+=s.scrollLeft,s=s.parentElement;return{item:e,top:t.offsetTop-n,left:t.offsetLeft+t.offsetWidth-i,width:t.offsetWidth,height:t.offsetHeight}}))))),C.oA,E.U((({item:e,top:t,left:n,width:a,height:s})=>i({kind:"openMenu",item:e,itemRect:st.Wm.create({top:t,left:n,width:a,height:s})})())))),g.createElement(w.F.li,{...(0,ne.Sh)(vt.item,e.pipe(E.U((e=>e.item.pinned)),E.U((0,f.RN)(vt.pinned,void 0)))),mount:o,tabIndex:t("focusable").pipe(E.U((e=>e?0:-1))),onFocus:t("item").pipe(E.U((e=>()=>{requestAnimationFrame((()=>{i({kind:"focus",item:e})()}))}))),onBlur:t("item").pipe(E.U((e=>t=>{const n=t.currentTarget;requestAnimationFrame((()=>{var t,a;n.contains(document.activeElement)||n.contains((null===(a=null===(t=document.activeElement)||void 0===t?void 0:t.shadowRoot)||void 0===a?void 0:a.activeElement)||null)||i({kind:"blur",item:e})()}))}))),onKeyDown:e=>{var t,n;"ArrowDown"===e.key&&(null===(t=e.currentTarget)||void 0===t?void 0:t.nextElementSibling)instanceof HTMLElement?e.currentTarget.nextElementSibling.focus():"ArrowUp"===e.key&&(null===(n=e.currentTarget)||void 0===n?void 0:n.previousElementSibling)instanceof HTMLElement&&e.currentTarget.previousElementSibling.focus()},onMouseLeave:()=>{l.current.set(!1)},onMouseOver:()=>{l.current.set(!0)}},g.createElement("label",{className:vt.content},n.title,g.createElement(ft.f.Context.Provider,{value:{hovered:l.current}},n.item)),g.createElement(w.F.div,{className:vt.moreButton},e.pipe(E.U((e=>g.createElement(D.zx.Ghost,{title:M.expandedPanel.actionsButtonTooltip,tabIndex:e.focusable?0:-1,onClick:()=>r.current.next(e.item),ariaLabel:"Actions",name:"actions-button"},g.createElement(N.JO.EllipsisSmall,{className:vt.ellipsis})))))),n.menu,n.feedback)}))}function yt(e,t,n,i,a){return s=>{switch(s.kind){case"show":a(s.item);break;case"focus":t.set(i(s.item));break;case"blur":e.actions.next({kind:K.Kind.itemBlur});break;case"openMenu":e.actions.next({kind:K.Kind.openItemMenu,itemId:i(s.item)}),n.set(b.some(s.itemRect)),t.set(i(s.item));break;default:(0,B.vE)(s)}}}function It(e,t,n,i){return(n===e||null===n&&0===t)&&b.isNone(i)}var xt,_t=n(81336),Et=n(83078),wt=n(67465);function Ut(){return U.UI.Node.make((({view:e,state:t,notify:n})=>{const{ref:i,onMount:a}=oe.P.useElWatcher(),o=g.useRef(new ye.xQ);return oe.P.useSubscriptionTo(o.current.pipe(Ie.M(i),E.U((([e,t])=>(0,s.zG)(t,b.map(le.UL.fromEl),b.map((t=>({...e,buttonRect:t})))))),C.oA,xe.b((e=>n(e)())))),g.createElement(w.F.div,{mount:a,...(0,ne.Sh)(wt.menu,e("item").pipe(E.U((e=>e.pinned?wt.pinned:void 0)))),style:e("bottomRightCorner").pipe(E.U(b.fold((()=>({display:"none"})),(e=>({...e,display:"flex"})))))},t.pipe(E.U((({item:e,clipboardSupported:t,feedbackDialogActive:i,feedbackSupported:a})=>{const r=e.rating===_t.DE.liked||(0,s.zG)(i,Et.FX("like")),l=e.rating===_t.DE.disliked||(0,s.zG)(i,Et.FX("dislike"));return g.createElement(g.Fragment,null,t?g.createElement(D.zx.Flat,{name:"copy-button",title:M.expandedPanel.itemMenu.copyTooltip,ariaLabel:M.expandedPanel.itemMenu.copyTooltip,className:wt.button,onClick:n({kind:"copy",item:e})},g.createElement(N.JO.Copy,null)):null,g.createElement(D.zx.Flat,{name:"pin-button",title:e.pinned?M.expandedPanel.itemMenu.unpinTooltip:M.expandedPanel.itemMenu.pinTooltip,ariaLabel:e.pinned?M.expandedPanel.itemMenu.unpinTooltip:M.expandedPanel.itemMenu.pinTooltip,className:wt.button,onClick:n({kind:"pin",item:e,pinned:!e.pinned}),active:e.pinned},g.createElement(N.JO.Pin,null)),g.createElement(D.zx.Flat,{name:"remove-button",title:M.expandedPanel.itemMenu.dismissTooltip,ariaLabel:M.expandedPanel.itemMenu.dismissTooltip,className:wt.button,onClick:n({kind:"dismiss",item:e})},g.createElement(N.JO.Ignore,null)),a?g.createElement(g.Fragment,null,g.createElement("div",{className:wt.separator}),b.isSome(i)||void 0===e.rating?g.createElement(g.Fragment,null,g.createElement(D.zx.Flat,{name:"dislike-button",title:M.expandedPanel.itemMenu.dislikeTooltip,ariaLabel:M.expandedPanel.itemMenu.dislikeTooltip,className:wt.button,onClick:()=>o.current.next({kind:"dislike",item:e}),active:l},l?g.createElement(xt.ThumbsDownFilled,null):g.createElement(xt.ThumbsDown,null)),g.createElement(D.zx.Flat,{name:"like-button",title:M.expandedPanel.itemMenu.likeTooltip,ariaLabel:M.expandedPanel.itemMenu.likeTooltip,className:wt.button,onClick:()=>o.current.next({kind:"like",item:e}),active:r},r?g.createElement(xt.ThumbsUpFilled,null):g.createElement(xt.ThumbsUp,null))):r?g.createElement(xt.ThumbsUpFilled,{className:wt.inactiveIcon}):l?g.createElement(xt.ThumbsDownFilled,{className:wt.inactiveIcon}):null):null)}))))}))}function Ct(e,t={dialogSide:"top",alignment:"right"}){return n=>{switch(n.kind){case"copy":e.copy(n.item);break;case"dismiss":e.dismiss(n.item);break;case"pin":e.pin(n.item,n.pinned);break;case"like":e.like(n.item,{sourceRect:n.buttonRect,...t});break;case"dislike":e.dislike(n.item,{sourceRect:n.buttonRect,...t});break;default:(0,B.vE)(n)}}}function St(e,t,n,i){return b.toNullable(t)===e||(0,s.zG)(n,b.exists(i(e)))}!function(e){e.ThumbsDown=({className:e,width:t=18})=>g.createElement(N.a1,{className:e,width:t,viewBox:"-1 -1 22 20"},g.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.94506 1.49087L3.94129 1.49999L1.22638 7.89292C1.06797 8.31105 1.03966 8.85929 1.01631 9.57841L1.01618 9.58249C1.01167 9.72126 1.00697 9.8662 1.00031 10.0091C1.00591 10.1675 1.08822 10.3603 1.28344 10.5353C1.48809 10.7188 1.74942 10.8182 1.97538 10.8182H8.88923L7.78363 16.1831C7.74404 16.3671 7.78727 16.6111 7.90957 16.807C7.92806 16.8367 7.94592 16.8618 7.96283 16.883C7.97026 16.8765 7.97776 16.87 7.98532 16.8633C8.08412 16.7763 8.18009 16.6875 8.25236 16.6196C8.28819 16.5859 8.31747 16.558 8.33751 16.5387L8.36015 16.5169L8.36114 16.516L13.3603 11.4772C13.5028 11.3373 13.5926 11.1398 13.5926 10.9091V1.81818C13.5926 1.57101 13.483 1.34726 13.3061 1.1944C13.1632 1.07085 12.9836 1 12.7901 1H4.67906C4.66798 1 4.6565 1.00023 4.64528 1.00068M9.06411 17.2273C9.06411 17.2273 8.27026 18 8.10374 18C7.25484 18 6.60509 16.9062 6.80597 15.9727L7.66214 11.8182H1.97538C0.984023 11.8182 0 10.9917 0 9.9917C0.0070643 9.84692 0.0119094 9.6977 0.0168363 9.54596C0.039042 8.86205 0.0629075 8.12702 0.299089 7.51818L3.0208 1.10909C3.03813 1.06714 3.05698 1.02601 3.07728 0.985763C3.28437 0.575142 3.64235 0.257042 4.07809 0.102666C4.2438 0.0439576 4.42076 0.00892764 4.60495 0.00149288C4.62942 0.000509854 4.65435 0 4.67906 0H12.7901C13.2356 0 13.6447 0.165198 13.9601 0.437858C14.3466 0.771997 14.5926 1.26752 14.5926 1.81818V10.9091C14.5926 11.4091 14.3943 11.8636 14.0609 12.1909L9.06411 17.2273ZM4.64528 1.00068C4.56232 1.00405 4.48416 1.01971 4.41203 1.04526C4.22152 1.11276 4.06246 1.25304 3.97014 1.43608C3.96113 1.45395 3.95276 1.47222 3.94506 1.49087M17.3951 1V9.90909H19V1H17.3951ZM16.3951 0.75C16.3951 0.335787 16.7308 0 17.1451 0H19.25C19.6642 0 20 0.335786 20 0.75V10.1591C20 10.5733 19.6642 10.9091 19.25 10.9091H17.1451C16.7308 10.9091 16.3951 10.5733 16.3951 10.1591V0.75Z",stroke:"none"})),e.ThumbsUp=({className:e,width:t=18})=>g.createElement(N.a1,{className:e,width:t,viewBox:"-1 -1 22 20"},g.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.0549 16.5091L16.0587 16.5L18.7736 10.1071C18.932 9.68895 18.9603 9.14071 18.9837 8.42159L18.9838 8.41751C18.9883 8.27874 18.993 8.1338 18.9997 7.99095C18.9941 7.83251 18.9118 7.63967 18.7166 7.46467C18.5119 7.28121 18.2506 7.18182 18.0246 7.18182L11.1108 7.18182L12.2164 1.8169C12.256 1.63292 12.2127 1.38894 12.0904 1.19295C12.0719 1.16332 12.0541 1.13822 12.0372 1.11697C12.0297 1.12346 12.0222 1.13004 12.0147 1.13671C11.9159 1.22375 11.8199 1.31246 11.7476 1.38043C11.7118 1.41412 11.6825 1.44205 11.6625 1.46127L11.6399 1.48305L11.6389 1.48402L6.63965 6.52285C6.49717 6.66269 6.40741 6.86024 6.40741 7.09091L6.40741 16.1818C6.40741 16.429 6.51702 16.6527 6.69386 16.8056C6.83679 16.9291 7.01641 17 7.20987 17L15.3209 17C15.332 17 15.3435 16.9998 15.3547 16.9993M10.9359 0.772727C10.9359 0.772727 11.7297 -7.23009e-07 11.8963 -7.08451e-07C12.7452 -6.34238e-07 13.3949 1.09375 13.194 2.02727L12.3379 6.18182L18.0246 6.18182C19.016 6.18182 20 7.0083 20 8.0083C19.9929 8.15308 19.9881 8.3023 19.9832 8.45404C19.961 9.13795 19.9371 9.87298 19.7009 10.4818L16.9792 16.8909C16.9619 16.9329 16.943 16.974 16.9227 17.0142C16.7156 17.4249 16.3577 17.743 15.9219 17.8973C15.7562 17.956 15.5792 17.9911 15.395 17.9985C15.3706 17.9995 15.3456 18 15.3209 18L7.20987 18C6.76441 18 6.35535 17.8348 6.03991 17.5621C5.65335 17.228 5.40741 16.7325 5.40741 16.1818L5.40741 7.09091C5.40741 6.59091 5.60568 6.13636 5.93913 5.80909L10.9359 0.772727ZM15.3547 16.9993C15.4377 16.996 15.5158 16.9803 15.588 16.9547C15.7785 16.8872 15.9375 16.747 16.0299 16.5639C16.0389 16.5461 16.0472 16.5278 16.0549 16.5091M2.60495 17L2.60495 8.09091L1.00003 8.09091L1.00003 17L2.60495 17ZM3.60495 17.25C3.60495 17.6642 3.26916 18 2.85495 18L0.750031 18C0.335817 18 3.05469e-05 17.6642 3.05831e-05 17.25L3.14057e-05 7.84091C3.14419e-05 7.4267 0.335818 7.09091 0.750031 7.09091L2.85495 7.09091C3.26916 7.09091 3.60495 7.4267 3.60495 7.84091L3.60495 17.25Z",stroke:"none"})),e.ThumbsDownFilled=({className:e,width:t=18})=>g.createElement(N.a1,{className:e,width:t,viewBox:"-1 -1 22 20"},g.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.0208 1.10909C3.03813 1.06714 3.05698 1.02601 3.07728 0.985763C3.28437 0.575142 3.64235 0.257042 4.07809 0.102666C4.2438 0.0439576 4.42076 0.00892764 4.60495 0.00149288C4.62942 0.000509854 4.65435 0 4.67906 0H12.7901C13.2356 0 13.6447 0.165198 13.9601 0.437858C14.3466 0.771997 14.5926 1.26752 14.5926 1.81818V10.9091C14.5926 11.4091 14.3943 11.8636 14.0609 12.1909L9.06411 17.2273C9.06411 17.2273 8.27026 18 8.10374 18C7.25484 18 6.60509 16.9062 6.80597 15.9727L7.66214 11.8182H1.97538C0.984023 11.8182 0 10.9917 0 9.9917C0.0070643 9.84692 0.0119094 9.6977 0.0168363 9.54596C0.039042 8.86205 0.0629075 8.12702 0.299089 7.51818L3.0208 1.10909Z",stroke:"none"}),g.createElement("path",{d:"M17.1451 0C16.7308 0 16.3951 0.335787 16.3951 0.75V10.1591C16.3951 10.5733 16.7308 10.9091 17.1451 10.9091H19.25C19.6642 10.9091 20 10.5733 20 10.1591V0.75C20 0.335786 19.6642 0 19.25 0H17.1451Z",stroke:"none"})),e.ThumbsUpFilled=({className:e,width:t=18})=>g.createElement(N.a1,{className:e,width:t,viewBox:"-1 -1 22 20"},g.createElement("path",{d:"M16.9792 16.8909C16.9618 16.9329 16.943 16.974 16.9227 17.0142C16.7156 17.4249 16.3576 17.743 15.9219 17.8973C15.7562 17.956 15.5792 17.9911 15.395 17.9985C15.3706 17.9995 15.3456 18 15.3209 18L7.20984 18C6.76438 18 6.35532 17.8348 6.03988 17.5621C5.65332 17.228 5.40738 16.7325 5.40738 16.1818L5.40738 7.09091C5.40738 6.59091 5.60565 6.13636 5.9391 5.80909L10.9359 0.772727C10.9359 0.772727 11.7297 0 11.8962 0C12.7451 0 13.3949 1.09375 13.194 2.02727L12.3378 6.18182L18.0246 6.18182C19.0159 6.18182 20 7.0083 20 8.0083C19.9929 8.15308 19.9881 8.3023 19.9831 8.45404C19.9609 9.13795 19.9371 9.87298 19.7009 10.4818L16.9792 16.8909Z",stroke:"none"}),g.createElement("path",{d:"M2.85492 18C3.26913 18 3.60492 17.6642 3.60492 17.25L3.60492 7.84091C3.60492 7.4267 3.26913 7.09091 2.85492 7.09091L0.750001 7.09091C0.335788 7.09091 0 7.42669 0 7.84091V17.25C0 17.6642 0.335787 18 0.75 18H2.85492Z",stroke:"none"}))}(xt||(xt={}));var Nt=n(50243);const Tt=({children:e})=>g.createElement(w.F.ul,{className:Nt.list},e);var Mt=n(39335),At=n(38459);const Ft=U.UI.Node.make((({state:e,notify:t})=>g.createElement(w.F.Fragment,null,e.pipe(E.U((({item:e,focusable:n})=>g.createElement("a",{href:e.url,target:"_blank",rel:"noreferrer",key:Mt.createHash("superfasthash").hash(`${e.url}${e.mimeType?e.mimeType:""}`),className:At.linkWrapper,tabIndex:n?0:-1,onClick:t({item:e})},g.createElement("div",{className:At.linkAndIcon},function(e,t){switch(e){case"hyperlink":return g.createElement(N.JO.Formatting.Link,{className:At.icon});case"email":return g.createElement(N.JO.Attachments.Email,{className:At.icon});case"attachment":switch(t){case"text/plain":case"text/html":case"application/msword":case"application/vnd.apple.pages":return g.createElement(N.JO.Attachments.Document,{className:At.icon});case"application/vnd.ms-excel":case"application/vnd.apple.numbers":return g.createElement(N.JO.Attachments.Spreadsheet,{className:At.icon});case"application/vnd.ms-powerpoint":case"application/vnd.apple.keynote":return g.createElement(N.JO.Attachments.Presentation,{className:At.icon});case"application/pdf":return g.createElement(N.JO.Attachments.Pdf,{className:At.icon});case"application/zip":case"application/vnd.rar":return g.createElement(N.JO.Attachments.Archive,{className:At.icon});default:return t?/^image\/.+/.test(t)?g.createElement(N.JO.Attachments.Image,{className:At.icon}):/^video\/.+/.test(t)?g.createElement(N.JO.Attachments.Video,{className:At.icon}):g.createElement(N.JO.Attachments.Attachment,{className:At.icon}):g.createElement(N.JO.Formatting.Link,{className:At.icon})}default:return g.createElement(N.JO.Formatting.Link,{className:At.icon})}}(e.type,e.mimeType),g.createElement("span",{className:At.link},"hyperlink"===e.type?""!==e.name?e.name:e.url:e.name)))))))));var Gt=n(69566);const zt=({title:e})=>g.createElement(w.F.div,{className:Gt.title},e),Pt=kt(),Lt=Ut(),Kt=U.UI.Knot.make(Pt,{item:Ft,title:U.UI.Union.asOption(U.UI.Node.make((({state:e})=>g.createElement(zt,{title:e})))),menu:Lt,feedback:dt}),Rt=U.UI.List.make(o.Bk,Kt),Ot=U.UI.Composite.make(U.UI.Grid.make((({slots:e})=>g.createElement(Tt,null,e.links))),Rt),Bt=e=>t=>e.actions.next({kind:K.Kind.linkClick,item:t.item}),Dt=e=>t=>at.isReaderLinkItemMenu(t)&&t.source.item.url===e;function Vt(e,t,n){const i=u.h.create(null),a=u.h.create(b.none),r=e.state.pipe(O.h((0,f.Kg)(I,y)),E.U((e=>e.activeMenuItemId)));return gt(((l,d)=>{const c=t.pipe(E.U((0,s.ls)(o.hX((e=>e.url===l)),o.YM)),C.oA),m=te.aj([e.state.view("feedbackDialog"),c,i,r,a]).pipe(E.U((([e,t,n,i,a])=>({item:t,itemRect:a,menuActive:St(l,i,e,Dt),feedbackDialogActive:(0,s.zG)(e,b.filter(Dt(l)),b.map((e=>e.source.action))),focusable:It(l,d,n,e)}))),ut.x());return U.Z.composeKnot({root:U.Z.fromSideEffect(yt(e,i,a,(e=>e.url),(t=>e.actions.next({kind:K.Kind.itemMounted,itemType:"linkItem",item:t}))),m.pipe(E.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),item:U.Z.fromSideEffect(Bt(e),m.pipe(E.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),title:()=>c.pipe(E.U(n)),menu:U.Z.fromSideEffect(Ct({pin:(t,n)=>e.actions.next({kind:K.Kind.pin,pinned:n,itemType:"linkItem",item:t}),copy:t=>e.actions.next({kind:K.Kind.copy,itemType:"linkItem",item:t}),dismiss:t=>e.actions.next({kind:K.Kind.dismiss,itemType:"linkItem",item:t}),like:(t,n)=>e.actions.next({kind:K.Kind.like,itemType:"linkItem",item:t,position:n}),dislike:(t,n)=>e.actions.next({kind:K.Kind.dislike,itemType:"linkItem",item:t,position:n})}),m.pipe(E.U((t=>({item:t.item,bottomRightCorner:t.menuActive?(0,s.zG)(t.itemRect,b.map(st.Wm.topLeftPoint)):b.none,clipboardSupported:e.isClipboardSupported,feedbackSupported:e.isSubmitFeedbackDialogSupported,feedbackDialogActive:t.feedbackDialogActive}))))),feedback:ct(e,Dt(l))})}),(()=>t.pipe(E.U(o.UI(X.ei("url"))))),o.Bk)}var Ht=n(45587);const Zt={lineAndAvatar:Ht.lineAndAvatar,lineAndCheckbox:Ht.lineAndCheckbox,lineOnly:Ht.lineOnly},jt=({lineCount:e,type:t,className:n})=>g.createElement("div",{className:n},[...Array(e).keys()].map((e=>g.createElement("div",{...(0,ne.Sh)(Ht.itemLoading,Zt[t]),key:e},g.createElement("div",{className:Ht.rect}),g.createElement("div",{className:Ht.line})))));var qt=n(69350);const $t=U.UI.Node.make((({state:e,notify:t})=>{const{ref:n,onMount:i}=oe.P.useElWatcher(),a=g.useRef(new ye.xQ);return oe.P.useSubscriptionTo(a.current.pipe(Ie.M(n),E.U((([e,t])=>b.map(le.UL.fromEl)(t))),C.oA,xe.b((e=>t({kind:"openFeedback",buttonRect:e})())))),g.createElement(w.F.Fragment,null,e.pipe(E.U((({isSupported:e,buttonLabel:t,description:n})=>e?g.createElement(g.Fragment,null,n,g.createElement(D.zx.Ghost,{className:qt.emptyCTAButton,mount:i,onClick:()=>a.current.next(),name:"open-feedback-button"},t)):null))))}));function Wt(e,t,n,i={dialogSide:"top",alignment:"left"}){return U.Z.fromSideEffect((t=>{if("openFeedback"===t.kind)e.actions.next({kind:K.Kind.openFeedback,source:{kind:n},position:{sourceRect:t.buttonRect,...i}});else(0,B.vE)(t.kind)}),{isSupported:e.isSubmitFeedbackDialogSupported,...t})}const Qt=U.UI.Grid.make((({slots:e})=>g.createElement(w.F.Fragment,null,e.button,e.dialog))),Jt=U.UI.Knot.make(Qt,{button:$t,dialog:be});function Yt(e,t,n,i){return U.Z.composeKnot({button:Wt(e,t,n,i),dialog:ke(e,(e=>e.source.kind===n))})}const Xt=U.UI.Composite.make(U.UI.Grid.make((({slots:e})=>g.createElement(nt,{title:M.expandedPanel.threadView.links.emptyTitle},e.button))),Jt),en=U.UI.Union.make("_tag",{None:Xt,Some:U.UI.Group.make({value:Ot})}),tn=U.UI.Node.make((()=>g.createElement(jt,{type:"lineAndAvatar",lineCount:2}))),nn=U.UI.Union.make("type",{InProgress:tn,Fatal:Xt,Error:Xt,Success:en});function an(e){const t=e.state.pipe(O.h(y),E.U((e=>e.links)),O.h(b.isSome),E.U((e=>e.value))),n=t.pipe(O.h(m.d6),E.U((e=>e.value))),i=()=>Yt(e,{buttonLabel:M.expandedPanel.threadView.links.emptyCTA,description:M.expandedPanel.threadView.links.emptyBody},"emptyLinksViewButton",{dialogSide:"top",alignment:"right"});return U.Z.composeUnion({InProgress:()=>S.of(null),Error:i(),Fatal:i(),Success:U.Z.composeUnion({None:i(),Some:U.Z.composeKnot({value:Vt(e,n,(()=>b.none))})},(()=>(0,s.zG)(n,E.U(et.nI))))},(()=>t))}var sn=n(31846);const on=({src:e,name:t})=>{const[n,i]=g.useState(!1);return e&&!n?g.createElement("img",{src:e,className:sn.image,onError:()=>i(!0),"aria-hidden":!0}):g.createElement("div",{className:sn.avatar,style:{backgroundColor:Fe.Z.neutral40},role:"img","aria-hidden":!0},t?function(e){return(e.split(/\s+/)[0][0]||"").toUpperCase()}(t):"?")};var rn=n(93383);const ln=U.UI.Node.make((({state:e})=>g.createElement(w.F.div,{className:rn.personAndAvatar},e.pipe(E.U((({name:e,email:t,avatarUrl:n})=>g.createElement(g.Fragment,null,g.createElement(on,{name:e,src:b.toUndefined(n)}),g.createElement("span",{className:rn.nameOrEmail},null!=e?e:t)))))))),dn=kt(),cn=Ut(),mn=U.UI.Knot.make(dn,{item:ln,title:U.UI.Union.asOption(U.UI.Node.make((({state:e})=>g.createElement(zt,{title:e})))),menu:cn,feedback:dt}),un=U.UI.List.make(o.Bk,mn),pn=U.UI.Composite.make(U.UI.Grid.make((({slots:e})=>g.createElement(Tt,null,e.people))),un),hn=e=>t=>at.isReaderPersonItemMenu(t)&&t.source.item.email===e;function gn(e,t,n){const i=u.h.create(null),a=u.h.create(b.none),r=e.state.pipe(O.h((0,f.Kg)(I,y)),E.U((e=>e.activeMenuItemId)));return gt(((l,d)=>{const c=t.pipe(E.U((0,s.ls)(o.hX((e=>e.email===l)),o.YM)),C.oA),m=te.aj([e.state.view("feedbackDialog"),c,i,r,a]).pipe(E.U((([e,t,n,i,a])=>({item:t,itemRect:a,menuActive:St(l,i,e,hn),feedbackDialogActive:(0,s.zG)(e,b.filter(hn(l)),b.map((e=>e.source.action))),focusable:It(l,d,n,e)}))),ut.x());return U.Z.composeKnot({root:U.Z.fromSideEffect(yt(e,i,a,(e=>e.email),(t=>e.actions.next({kind:K.Kind.itemMounted,itemType:"mentionItem",item:t}))),m.pipe(E.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),item:()=>c,title:()=>c.pipe(E.U(n)),menu:U.Z.fromSideEffect(Ct({pin:(t,n)=>e.actions.next({kind:K.Kind.pin,pinned:n,itemType:"mentionItem",item:t}),copy:t=>e.actions.next({kind:K.Kind.copy,itemType:"mentionItem",item:t}),dismiss:t=>e.actions.next({kind:K.Kind.dismiss,itemType:"mentionItem",item:t}),like:(t,n)=>e.actions.next({kind:K.Kind.like,itemType:"mentionItem",item:t,position:n}),dislike:(t,n)=>e.actions.next({kind:K.Kind.dislike,itemType:"mentionItem",item:t,position:n})}),m.pipe(E.U((t=>({item:t.item,bottomRightCorner:t.menuActive?(0,s.zG)(t.itemRect,b.map(st.Wm.topLeftPoint)):b.none,clipboardSupported:e.isClipboardSupported,feedbackSupported:e.isSubmitFeedbackDialogSupported,feedbackDialogActive:t.feedbackDialogActive}))))),feedback:ct(e,hn(l))})}),(()=>t.pipe(E.U(o.UI(X.ei("email"))))),o.Bk)}const fn=U.UI.Composite.make(U.UI.Grid.make((({slots:e})=>g.createElement(nt,{title:M.expandedPanel.threadView.mentions.emptyTitle},e.button))),Jt),bn=U.UI.Union.make("_tag",{None:fn,Some:U.UI.Group.make({value:pn})}),vn=U.UI.Node.make((()=>g.createElement(jt,{type:"lineAndAvatar",lineCount:2}))),kn=U.UI.Union.make("type",{InProgress:vn,Fatal:fn,Error:fn,Success:bn});function yn(e){const t=e.state.pipe(O.h(y),E.U((e=>e.mentions)),O.h(b.isSome),E.U((e=>e.value))),n=t.pipe(O.h(m.d6),E.U((e=>e.value))),i=()=>Yt(e,{buttonLabel:M.expandedPanel.threadView.mentions.emptyCTA,description:M.expandedPanel.threadView.mentions.emptyBody},"emptyMentionsViewButton",{dialogSide:"top",alignment:"right"});return U.Z.composeUnion({InProgress:()=>S.of(null),Error:i(),Fatal:i(),Success:U.Z.composeUnion({None:i(),Some:U.Z.composeKnot({value:gn(e,n,(()=>b.none))})},(()=>(0,s.zG)(n,E.U(et.nI))))},(()=>t))}var In=n(31944),xn=n(11071);const _n=U.UI.Node.make((({state:e,notify:t})=>g.createElement(w.F.Fragment,null,e.pipe(E.U((({item:e,focusable:n})=>g.createElement(In.J,{checked:e.checked,labelId:`question-item-${e.itemId}`,className:xn.checkboxWrapper,checkboxClassName:xn.checkbox,labelClassName:xn.label,onChange:n=>t({checked:n,item:e})(),tabIndex:n?0:-1},g.createElement("div",{...(0,ne.Sh)(e.checked?xn.textChecked:void 0,xn.itemText)},e.text)))))))),En=kt(),wn=Ut(),Un=U.UI.Knot.make(En,{item:_n,title:U.UI.Union.asOption(U.UI.Node.make((({state:e})=>g.createElement(zt,{title:e})))),menu:wn,feedback:dt}),Cn=(U.UI.List.make(o.Bk,Un),U.UI.Composite.make(U.UI.Grid.make((({slots:e})=>g.createElement(Tt,null,e.list))),U.UI.List.make(o.Bk,Un))),Sn=e=>t=>e.actions.next({kind:K.Kind.check,item:t.item,checked:t.checked}),Nn=e=>t=>at.isReaderQuestionItemMenu(t)&&t.source.item.itemId===e;function Tn(e,t,n){const i=u.h.create(null),a=u.h.create(b.none),r=e.state.pipe(O.h((0,f.Kg)(I,y)),E.U((e=>e.activeMenuItemId)));return gt(((l,d)=>{const c=t.pipe(E.U((0,s.ls)(o.hX((e=>e.itemId===l)),o.YM)),C.oA),m=te.aj([e.state.view("feedbackDialog"),c,i,r,a]).pipe(E.U((([e,t,n,i,a])=>({item:t,itemRect:a,menuActive:St(l,i,e,Nn),feedbackDialogActive:(0,s.zG)(e,b.filter(Nn(l)),b.map((e=>e.source.action))),focusable:It(l,d,n,e)}))),ut.x());return U.Z.composeKnot({root:U.Z.fromSideEffect(yt(e,i,a,(e=>e.itemId),(t=>e.actions.next({kind:K.Kind.itemMounted,itemType:"followUpItem",item:t}))),m.pipe(E.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),item:U.Z.fromSideEffect(Sn(e),m.pipe(E.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),title:()=>c.pipe(E.U(n)),menu:U.Z.fromSideEffect(Ct({pin:(t,n)=>e.actions.next({kind:K.Kind.pin,pinned:n,itemType:"followUpItem",item:t}),copy:t=>e.actions.next({kind:K.Kind.copy,itemType:"followUpItem",item:t}),dismiss:t=>e.actions.next({kind:K.Kind.dismiss,itemType:"followUpItem",item:t}),like:(t,n)=>e.actions.next({kind:K.Kind.like,itemType:"followUpItem",item:t,position:n}),dislike:(t,n)=>e.actions.next({kind:K.Kind.dislike,itemType:"followUpItem",item:t,position:n})}),m.pipe(E.U((t=>({item:t.item,bottomRightCorner:t.menuActive?(0,s.zG)(t.itemRect,b.map(st.Wm.topLeftPoint)):b.none,clipboardSupported:e.isClipboardSupported,feedbackSupported:e.isSubmitFeedbackDialogSupported,feedbackDialogActive:t.feedbackDialogActive}))))),feedback:ct(e,Nn(l))})}),(()=>t.pipe(E.U(o.UI(X.ei("itemId"))))),o.Bk)}const Mn=U.UI.Composite.make(U.UI.Grid.make((({slots:e})=>g.createElement(nt,{title:M.expandedPanel.threadView.needsResponse.emptyTitle},e.button))),Jt),An=U.UI.Union.make("_tag",{None:Mn,Some:U.UI.Group.make({value:Cn})}),Fn=U.UI.Node.make((()=>g.createElement(jt,{type:"lineAndCheckbox",lineCount:2}))),Gn=U.UI.Union.make("type",{InProgress:Fn,Error:Mn,Fatal:Mn,Success:An});function zn(e){const t=e.state.pipe(O.h(y),E.U((e=>e.questions)),O.h(b.isSome),E.U((e=>e.value))),n=t.pipe(O.h(m.d6),E.U((e=>e.value))),i=()=>Yt(e,{buttonLabel:M.expandedPanel.threadView.needsResponse.emptyCTA,description:M.expandedPanel.threadView.needsResponse.emptyBody},"emptyFollowUpsViewButton");return U.Z.composeUnion({InProgress:()=>S.of(null),Error:i(),Fatal:i(),Success:U.Z.composeUnion({None:i(),Some:U.Z.composeKnot({value:Tn(e,n,(()=>b.none))})},(()=>(0,s.zG)(n,E.U(et.nI))))},(()=>t))}var Pn=n(83581);const Ln=kt(),Kn=Ut(),Rn=U.UI.Knot.make(Ln,{item:U.UI.Node.make((({state:e})=>g.createElement(w.F.div,{className:Pn.itemText},e))),title:U.UI.Union.asOption(U.UI.Node.make((({state:e})=>g.createElement(zt,{title:e})))),menu:Kn,feedback:dt}),On=U.UI.List.make(o.Bk,Rn),Bn=U.UI.Composite.make(U.UI.Grid.make((({slots:e})=>g.createElement(Tt,null,e.list))),On),Dn=e=>t=>at.isReaderSummaryItemMenu(t)&&t.source.item.itemId===e;function Vn(e,t,n){const i=u.h.create(null),a=u.h.create(b.none),r=e.state.pipe(O.h((0,f.Kg)(I,y)),E.U((e=>e.activeMenuItemId)));return gt(((l,d)=>{const c=t.pipe(E.U((0,s.ls)(o.hX((e=>e.itemId===l)),o.YM)),C.oA),m=te.aj([e.state.view("feedbackDialog"),c,i,r,a]).pipe(E.U((([e,t,n,i,a])=>({item:t,itemRect:a,menuActive:St(l,i,e,Dn),feedbackDialogActive:(0,s.zG)(e,b.filter(Dn(l)),b.map((e=>e.source.action))),focusable:It(l,d,n,e)}))),ut.x());return U.Z.composeKnot({root:U.Z.fromSideEffect(yt(e,i,a,(e=>e.itemId),(t=>e.actions.next({kind:K.Kind.itemMounted,itemType:"summaryItem",item:t}))),m.pipe(E.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),item:()=>c.pipe(E.U((e=>e.text))),title:()=>c.pipe(E.U(n)),menu:U.Z.fromSideEffect(Ct({pin:(t,n)=>e.actions.next({kind:K.Kind.pin,pinned:n,itemType:"summaryItem",item:t}),copy:t=>e.actions.next({kind:K.Kind.copy,itemType:"summaryItem",item:t}),dismiss:t=>e.actions.next({kind:K.Kind.dismiss,itemType:"summaryItem",item:t}),like:(t,n)=>e.actions.next({kind:K.Kind.like,itemType:"summaryItem",item:t,position:n}),dislike:(t,n)=>e.actions.next({kind:K.Kind.dislike,itemType:"summaryItem",item:t,position:n})},{dialogSide:"top",alignment:"left"}),m.pipe(E.U((t=>({item:t.item,bottomRightCorner:t.menuActive?(0,s.zG)(t.itemRect,b.map(st.Wm.topLeftPoint)):b.none,clipboardSupported:e.isClipboardSupported,feedbackSupported:e.isSubmitFeedbackDialogSupported,feedbackDialogActive:t.feedbackDialogActive}))))),feedback:ct(e,Dn(l))})}),(()=>t.pipe(E.U(o.UI(X.ei("itemId"))))),o.Bk)}var Hn=n(48789);const Zn=U.UI.Composite.make(U.UI.Grid.make((({slots:e})=>g.createElement(nt,{title:M.expandedPanel.threadView.summary.emptyTitle},e.button))),Jt),jn=U.UI.Union.make("_tag",{None:Zn,Some:U.UI.Group.make({value:Bn})}),qn=U.UI.Node.make((()=>g.createElement(jt,{className:Hn.loader,type:"lineOnly",lineCount:2}))),$n=U.UI.Union.make("type",{InProgress:qn,Error:Zn,Fatal:Zn,Success:jn});function Wn(e){const t=e.state.pipe(O.h(y),E.U((e=>e.summary)),O.h(b.isSome),E.U((e=>e.value))),n=t.pipe(O.h(m.d6),E.U((e=>e.value))),i=()=>Yt(e,{buttonLabel:M.expandedPanel.threadView.summary.emptyCTA,description:M.expandedPanel.threadView.summary.emptyBody},"emptySummaryViewButton",{dialogSide:"top",alignment:"left"});return U.Z.composeUnion({InProgress:()=>S.of(null),Error:i(),Fatal:i(),Success:U.Z.composeUnion({None:i(),Some:U.Z.composeKnot({value:Vn(e,n,(()=>b.none))})},(()=>(0,s.zG)(n,E.U(et.nI))))},(()=>t))}const Qn=U.UI.Knot.make($e(Qe),{content:$n,title:U.UI.Node.make((()=>g.createElement("span",null,M.expandedPanel.threadView.summary.title)))}),Jn=U.UI.Knot.make($e(Je),{content:Gn,title:U.UI.Node.make((()=>g.createElement("span",null,M.expandedPanel.threadView.needsResponse.title)))}),Yn=U.UI.Knot.make($e(Ye),{content:kn,title:U.UI.Node.make((()=>g.createElement("span",null,M.expandedPanel.threadView.mentions.title)))}),Xn=U.UI.Knot.make($e(Xe),{content:nn,title:U.UI.Node.make((()=>g.createElement("span",null,M.expandedPanel.threadView.links.title)))}),ei=U.UI.Union.asOption(Qn),ti=U.UI.Union.asOption(Jn),ni=U.UI.Union.asOption(Yn),ii=U.UI.Union.asOption(Xn),ai=U.UI.Knot.make(We,{summary:ei,questions:ti,mentions:ni,links:ii});function si(e){const t=e.state.pipe(O.h(y)),n=t=>e.actions.next({kind:K.Kind.columnScroll}),i=S.of(null);return U.Z.composeKnot({summary:U.Z.composeUnion({Some:U.Z.composeKnot({value:U.Z.composeKnot({root:U.Z.fromSideEffect(n,i),content:Wn(e),title:()=>i})}),None:()=>i},(()=>t.pipe(E.U((e=>e.summary))))),questions:U.Z.composeUnion({Some:U.Z.composeKnot({value:U.Z.composeKnot({root:U.Z.fromSideEffect(n,i),content:zn(e),title:()=>i})}),None:()=>i},(()=>t.pipe(E.U((e=>e.questions))))),mentions:U.Z.composeUnion({Some:U.Z.composeKnot({value:U.Z.composeKnot({root:U.Z.fromSideEffect(n,i),content:yn(e),title:()=>i})}),None:()=>i},(()=>t.pipe(E.U((e=>e.mentions))))),links:U.Z.composeUnion({Some:U.Z.composeKnot({value:U.Z.composeKnot({root:U.Z.fromSideEffect(n,i),content:an(e),title:()=>i})}),None:()=>i},(()=>t.pipe(E.U((e=>e.links)))))})}var oi=n(37896);function ri(e){if("parsedDate"===e.kind){const t=new Date(e.timestamp);return`${oi.Rb[t.getMonth()]} ${t.getDate()}`}return e.date}var li=n(79579);const di=U.UI.Union.make("_tag",{None:U.UI.Node.make((({notify:e})=>g.createElement(nt,{title:M.expandedPanel.pinnedView.links.emptyTitle},M.expandedPanel.pinnedView.links.emptyBody,g.createElement(D.zx.Ghost,{onClick:e("showMessages"),name:"pinned-mentions-empty-cta",className:li.emptyCTAButton},M.expandedPanel.pinnedView.links.emptyCTA)))),Some:U.UI.Group.make({value:Ot})});function ci(e){const t=e.state.pipe(O.h(I),E.U((e=>e.links)),O.h(b.isSome),E.U((e=>e.value)));return U.Z.composeUnion({None:U.Z.fromSideEffect((t=>{if("showMessages"===t)e.actions.next({kind:K.Kind.openMessageView,source:L.emptyPinnedLinks});else(0,B.vE)(t)}),null),Some:U.Z.composeKnot({value:Vt(e,t,(e=>(0,s.zG)(e.messagePinnedFrom,b.map((e=>{var t;return`From ${null!==(t=e.author.name)&&void 0!==t?t:e.author.email}, ${ri(e.date)}`})))))})},(()=>(0,s.zG)(t,E.U(et.nI))))}const mi=U.UI.Union.make("_tag",{None:U.UI.Node.make((({notify:e})=>g.createElement(nt,{title:M.expandedPanel.pinnedView.mentions.emptyTitle},M.expandedPanel.pinnedView.mentions.emptyBody,g.createElement(D.zx.Ghost,{onClick:e("showMessages"),name:"pinned-mentions-empty-cta",className:li.emptyCTAButton},M.expandedPanel.pinnedView.mentions.emptyCTA)))),Some:U.UI.Group.make({value:pn})});function ui(e){const t=e.state.pipe(O.h(I),E.U((e=>e.mentions)),O.h(b.isSome),E.U((e=>e.value)));return U.Z.composeUnion({None:U.Z.fromSideEffect((t=>{if("showMessages"===t)e.actions.next({kind:K.Kind.openMessageView,source:L.emptyPinnedMentions});else(0,B.vE)(t)}),null),Some:U.Z.composeKnot({value:gn(e,t,(e=>(0,s.zG)(e.messagePinnedFrom,b.map((e=>{var t;return`From ${null!==(t=e.author.name)&&void 0!==t?t:e.author.email}, ${ri(e.date)}`})))))})},(()=>(0,s.zG)(t,E.U(et.nI))))}const pi=U.UI.Union.make("_tag",{None:U.UI.Node.make((({notify:e})=>g.createElement(nt,{title:M.expandedPanel.pinnedView.needsResponse.emptyTitle},M.expandedPanel.pinnedView.needsResponse.emptyBody,g.createElement(D.zx.Ghost,{onClick:e("showMessages"),name:"pinned-follow-ups-empty-cta",className:li.emptyCTAButton},M.expandedPanel.pinnedView.needsResponse.emptyCTA)))),Some:U.UI.Group.make({value:Cn})});function hi(e){const t=e.state.pipe(O.h(I),E.U((e=>e.questions)),O.h(b.isSome),E.U((e=>e.value)));return U.Z.composeUnion({None:U.Z.fromSideEffect((t=>{if("showMessages"===t)e.actions.next({kind:K.Kind.openMessageView,source:L.emptyPinnedFollowUps});else(0,B.vE)(t)}),null),Some:U.Z.composeKnot({value:Tn(e,t,(e=>{var t;return b.some(`From ${null!==(t=e.message.author.name)&&void 0!==t?t:e.message.author.email}, ${ri(e.message.date)}`)}))})},(()=>(0,s.zG)(t,E.U(et.nI))))}const gi=U.UI.Union.make("_tag",{None:U.UI.Node.make((({notify:e})=>g.createElement(nt,{title:M.expandedPanel.pinnedView.summary.emptyTitle},M.expandedPanel.pinnedView.summary.emptyBody,g.createElement(D.zx.Ghost,{onClick:e("showMessages"),name:"pinned-summary-empty-cta",className:li.emptyCTAButton},M.expandedPanel.pinnedView.summary.emptyCTA)))),Some:U.UI.Group.make({value:Bn})});function fi(e){const t=e.state.pipe(O.h(I),E.U((e=>e.summaryItems)),O.h(b.isSome),E.U((e=>e.value)));return U.Z.composeUnion({None:U.Z.fromSideEffect((t=>{if("showMessages"===t)e.actions.next({kind:K.Kind.openMessageView,source:L.emptyPinnedSummaries});else(0,B.vE)(t)}),null),Some:U.Z.composeKnot({value:Vn(e,t,(e=>{var t;return b.some(`From ${null!==(t=e.message.author.name)&&void 0!==t?t:e.message.author.email}, ${ri(e.message.date)}`)}))})},(()=>(0,s.zG)(t,E.U(et.nI))))}const bi=U.UI.Knot.make($e(Qe),{content:gi,title:U.UI.Node.make((()=>g.createElement("span",null,M.expandedPanel.pinnedView.summary.title)))}),vi=U.UI.Knot.make($e(Je),{content:pi,title:U.UI.Node.make((()=>g.createElement("span",null,M.expandedPanel.pinnedView.needsResponse.title)))}),ki=U.UI.Knot.make($e(Ye),{content:mi,title:U.UI.Node.make((()=>g.createElement("span",null,M.expandedPanel.pinnedView.mentions.title)))}),yi=U.UI.Knot.make($e(Xe),{content:di,title:U.UI.Node.make((()=>g.createElement("span",null,M.expandedPanel.pinnedView.links.title)))}),Ii=U.UI.Union.asOption(bi),xi=U.UI.Union.asOption(vi),_i=U.UI.Union.asOption(ki),Ei=U.UI.Union.asOption(yi),wi=U.UI.Knot.make(We,{summary:Ii,questions:xi,mentions:_i,links:Ei});function Ui(e){const t=e.state.pipe(O.h(I)),n=t=>e.actions.next({kind:K.Kind.columnScroll}),i=S.of(null);return U.Z.composeKnot({summary:U.Z.composeUnion({Some:U.Z.composeKnot({value:U.Z.composeKnot({root:U.Z.fromSideEffect(n,i),content:fi(e),title:()=>i})}),None:()=>i},(()=>t.pipe(E.U((e=>e.summaryItems))))),questions:U.Z.composeUnion({Some:U.Z.composeKnot({value:U.Z.composeKnot({root:U.Z.fromSideEffect(n,i),content:hi(e),title:()=>i})}),None:()=>i},(()=>t.pipe(E.U((e=>e.questions))))),mentions:U.Z.composeUnion({Some:U.Z.composeKnot({value:U.Z.composeKnot({root:U.Z.fromSideEffect(n,i),content:ui(e),title:()=>i})}),None:()=>i},(()=>t.pipe(E.U((e=>e.mentions))))),links:U.Z.composeUnion({Some:U.Z.composeKnot({value:U.Z.composeKnot({root:U.Z.fromSideEffect(n,i),content:ci(e),title:()=>i})}),None:()=>i},(()=>t.pipe(E.U((e=>e.links)))))})}const Ci=U.UI.Union.make("kind",{messageView:ai,pinnedView:wi});function Si(e){return U.Z.composeUnion({messageView:si(e),pinnedView:Ui(e)},(()=>e.state.pipe(O.h((0,f.Kg)(I,y)),E.U((e=>({kind:e.kind}))))))}var Ni=n(37903),Ti=n(89739);const Mi=U.UI.Node.make((({view:e})=>g.createElement("div",{className:Ti.activeMailInfo},g.createElement(w.F.span,{className:Ti.date},e("date").pipe(E.U(ri))),g.createElement(w.F.span,{className:Ti.author},e("author").pipe(E.U((e=>{var t;return null!==(t=e.name)&&void 0!==t?t:e.email}))))))),Ai=U.UI.Node.make((()=>g.createElement("div",{className:Ti.activeMailInfo},"Loading..."))),Fi=U.UI.Union.make("type",{InProgress:Ai,Success:Mi,Fatal:U.UI.Node.make((()=>g.createElement("div",{className:Ti.activeMailInfo}))),Error:U.UI.Node.make((()=>g.createElement("div",{className:Ti.activeMailInfo})))});function Gi(e){return U.Z.composeUnion({InProgress:()=>S.of(null),Success:()=>e.state.pipe(O.h(y),E.U((e=>e.header)),O.h(m.d6),E.U((e=>e.value))),Fatal:()=>S.of(null),Error:()=>S.of(null)},(()=>e.state.pipe(O.h(y),E.U((e=>e.header)))))}var zi=n(14692);const Pi=U.UI.Knot.make(U.UI.Grid.make((({slots:e,state:t,notify:n})=>g.createElement(w.F.div,{className:zi.navigationFrame},g.createElement(w.F.div,{className:zi.buttonGroup},t.pipe(E.U((e=>g.createElement(g.Fragment,null,g.createElement(D.zx.Ghost,{onClick:n(A.first),name:"navigate-first",disabled:!e.canGoBack,title:e.canGoBack?M.expandedPanel.jumpFirstIconTooltip:void 0,ariaLabel:e.canGoBack?M.expandedPanel.jumpFirstIconTooltip:void 0,tabIndex:e.focusable?0:-1},g.createElement(N.JO.Exit,{...(0,ne.Sh)(zi.iconJump,zi.iconGoFirst)})),g.createElement(D.zx.Ghost,{onClick:n(A.left),name:"navigate-left",disabled:!e.canGoBack,title:e.canGoBack?M.expandedPanel.goLeftIconTooltip:void 0,ariaLabel:e.canGoBack?M.expandedPanel.goLeftIconTooltip:void 0,tabIndex:e.focusable?0:-1},g.createElement(N.JO.Arrow,{direction:N.n4.left,className:zi.icon}))))))),e.mailInfo,g.createElement(w.F.div,{className:zi.buttonGroup},t.pipe(E.U((e=>g.createElement(g.Fragment,null,g.createElement(D.zx.Ghost,{onClick:n(A.right),name:"navigate-right",disabled:!e.canGoForward,title:e.canGoForward?M.expandedPanel.goRightIconTooltip:void 0,ariaLabel:e.canGoForward?M.expandedPanel.goRightIconTooltip:void 0,tabIndex:e.focusable?0:-1},g.createElement(N.JO.Arrow,{direction:N.n4.right,className:zi.icon})),g.createElement(D.zx.Ghost,{onClick:n(A.last),name:"navigate-last",disabled:!e.canGoForward,title:e.canGoForward?M.expandedPanel.jumpLastIconTooltip:void 0,ariaLabel:e.canGoForward?M.expandedPanel.jumpLastIconTooltip:void 0,tabIndex:e.focusable?0:-1},g.createElement(N.JO.Exit,{className:zi.iconJump})))))))))),{mailInfo:Fi});function Li(e){return U.Z.composeKnot({root:U.Z.fromSideEffect((t=>(0,s.zG)(e.getNextActiveMessageIndex(t),Et.bw((n=>e.actions.next({kind:K.Kind.threadViewNavigate,action:t,nextIndex:n}))))),e.state.pipe(O.h(y)).pipe(E.U((e=>({...e.navigation,focusable:b.isNone(e.feedbackDialog)}))))),mailInfo:Gi(e)})}var Ki=n(16204);const Ri=U.UI.Node.make((({state:e,notify:t})=>g.createElement(w.F.Fragment,null,e.pipe(E.U((({activeView:e,focusable:n})=>g.createElement(D.zx.Group,{sticky:!0,className:Ki.buttonGroup},g.createElement(D.zx.White,{name:"thread-view",onClick:t("messageView"),active:"messageView"===e,className:Ki.button,tabIndex:n?0:-1},M.expandedPanel.viewButton.thread),g.createElement(D.zx.White,{name:"pinned-view",onClick:t("pinnedView"),active:"pinnedView"===e,className:Ki.button,tabIndex:n?0:-1},M.expandedPanel.viewButton.pins))))))));function Oi(e){return U.Z.fromSideEffect((t=>{switch(t){case"pinnedView":e.actions.next({kind:K.Kind.openPinnedView});break;case"messageView":e.actions.next({kind:K.Kind.openMessageView,source:L.messagesButton});break;default:(0,B.vE)(t)}}),e.state.pipe(O.h((0,f.Kg)(y,I)),E.U((e=>({activeView:e.kind,focusable:b.isNone(e.feedbackDialog)})))))}const Bi=U.UI.Grid.make((({slots:e})=>g.createElement(w.F.div,{className:Ni.header},e.viewButtons,e.frame))),Di=U.UI.Union.asOption(Pi),Vi=U.UI.Union.asOption(Ri),Hi=U.UI.Knot.make(Bi,{viewButtons:Vi,frame:Di});function Zi(e){return U.Z.composeKnot({viewButtons:U.Z.composeUnion({None:()=>S.of(null),Some:U.Z.composeKnot({value:Oi(e)})},(()=>e.state.pipe(E.U((e=>(0,f.Kg)(y,I)(e)?b.some(e):b.none))))),frame:U.Z.composeUnion({None:()=>S.of(null),Some:U.Z.composeKnot({value:Li(e)})},(()=>e.state.pipe(E.U((e=>y(e)?b.some(e):b.none)))))})}const ji=U.UI.Knot.make(Le,{header:Hi,toolbar:De,content:Ci});function qi(e){return U.Z.composeKnot({root:Ke(e),header:Zi(e),toolbar:U.Z.composeKnot({feedback:Ce(e,!1,(e=>"expandedPanelHeaderButton"===e.source.kind)),togglePanel:Oe(e),toggleInlineHighlights:Te(e)}),content:Si(e)})}var $i=n(86885),Wi=n(40349);const Qi=U.UI.Node.make((({state:e,notify:t})=>g.createElement("div",{className:Wi.controls},g.createElement("div",{className:Wi.onboardingButtonGroup},g.createElement(D.zx.Primary,{name:"try-it-out-button",onClick:t("optIn"),className:Wi.optInButton},M.onboarding.optInButton),g.createElement(D.zx.Flat,{name:"no-thanks-button",onClick:t("optOut"),className:Wi.optOutButton},M.onboarding.optOutButton)),g.createElement(w.F.div,{className:Wi.navigation},e.pipe(E.U((e=>g.createElement(g.Fragment,null,g.createElement(D.zx.Flat,{name:"left-button",onClick:t(F.left),disabled:v[0]===e,className:Wi.leftButton,title:M.onboarding.prevIconTooltip,ariaLabel:M.onboarding.prevIconTooltip},g.createElement(N.JO.Arrow,{direction:N.n4.left,width:12})),g.createElement(D.zx.Flat,{name:"right-button",onClick:t(F.right),disabled:v[v.length-1]===e,className:Wi.rightButton,title:M.onboarding.nextIconTooltip,ariaLabel:M.onboarding.nextIconTooltip},g.createElement(N.JO.Arrow,{direction:N.n4.right,width:12,className:Wi.arrowRight})),g.createElement("div",{className:Wi.stepOfN},M.onboarding.stepOfN(v.indexOf(e)+1))))))))));var Ji=n(57391);const Yi=U.UI.Node.make((({state:e})=>g.createElement(g.Fragment,null,g.createElement("link",{rel:"preload",as:"image",href:M.onboarding.overview.videoSrc}),g.createElement("link",{rel:"preload",as:"image",href:M.onboarding.coreUserJourney.videoSrc}),g.createElement("link",{rel:"preload",as:"image",href:M.onboarding.pinning.videoSrc}),g.createElement(w.F.Fragment,null,e.pipe(E.U((e=>g.createElement("img",{src:M.onboarding[e].videoSrc,key:e,className:Ji.illustration}))))))));var Xi=n(51869),ea=n(19230);const ta=({title:e,children:t})=>g.createElement(g.Fragment,null,g.createElement("div",{className:ea.title},e),g.createElement("div",{className:ea.body},t)),na=({features:e,browser:t})=>{const n=e=>g.createElement(g.Fragment,null,e,g.createElement(Ae.v,{browser:t,title:g.createElement("a",{href:M.onboarding.betaTermsUrl,target:"_blank",rel:"noreferrer"},"BETA")}));return e.has("needsResponse")&&e.has("mentions")?g.createElement(ta,{title:n(M.onboarding.overview.phase2.title)},M.onboarding.overview.phase2.body):e.has("needsResponse")?g.createElement(ta,{title:n(M.onboarding.overview.phase1.title)},M.onboarding.overview.phase1.body):g.createElement(ta,{title:n(M.onboarding.overview.phase0.title)},M.onboarding.overview.phase0.body)},ia=()=>g.createElement(ta,{title:M.onboarding.coreUserJourney.title},M.onboarding.coreUserJourney.body),aa=()=>g.createElement(ta,{title:M.onboarding.pinning.title},M.onboarding.pinning.body),sa=U.UI.Node.make((({state:e})=>g.createElement(w.F.Fragment,null,e.pipe(E.U((e=>{switch(e.step){case p.overview:return g.createElement(na,{key:"step-overview",features:e.features,browser:e.browser});case p.coreUserJourney:return g.createElement(ia,{key:"step-core-user-journey"});case p.pinning:return g.createElement(aa,{key:"step-pinning"});default:(0,B.vE)(e.step)}})))))),oa=({onShow:e,children:t})=>(oe.P.useEffectOnDidMount(e),g.createElement("div",{className:Xi.onboarding},t)),ra=U.UI.Grid.make((({slots:e,notify:t})=>g.createElement(oa,{onShow:t("panelMounted")},g.createElement(w.F.div,null,e.illustrations),g.createElement(ee.K,{size:22.4,className:Xi.logo}),g.createElement("div",{className:Xi.content,"data-grammarly-part":"reader-onboarding-content"},g.createElement("div",{className:Xi.badge},M.onboarding.badge),g.createElement(w.F.div,{className:Xi.steps},e.steps),g.createElement(w.F.div,null,e.controls))))),la=U.UI.Knot.make(ra,{steps:sa,illustrations:Yi,controls:Qi});function da(e){return U.Z.fromSideEffect((t=>{const n=t.action;switch(n){case"optIn":e.actions.next({kind:K.Kind.optIn});break;case"optOut":e.actions.next({kind:K.Kind.optOut});break;case F.left:case F.right:e.actions.next({kind:K.Kind.onboardingViewNavigate,action:n});break;case"panelMounted":e.actions.next({kind:K.Kind.panelMounted,subject:G.onboardingPanel});break;default:(0,B.vE)(n)}}),e.state.pipe(O.h(x),E.U((t=>({steps:{step:v[t.step],features:t.features,browser:e.browser},illustrations:v[t.step],controls:v[t.step]})))))}var ca=n(35300);const ma=U.UI.Grid.make((({slots:e})=>g.createElement("div",{className:ca.onboarding,"data-grammarly-part":"reader-onboarding"},g.createElement(w.F.Fragment,null,e.content),g.createElement(w.F.div,{className:ca.toolbar},e.toolbar)))),ua=U.UI.Knot.make(ma,{content:la,toolbar:Re});function pa(e){return U.Z.composeKnot({toolbar:Oe(e),content:da(e)})}const ha=U.UI.Union.make("kind",{collapsed:Ve,expanded:ji,onboarding:ua}),ga=U.UI.Knot.make(U.UI.Grid.make((({slots:e})=>g.createElement(w.F.div,{className:$i.panelWrapper,"data-grammarly-part":"reader-panel"},e.content,e.notification))),{content:ha,notification:W});var fa,ba,va=n(17889),ka=n(26430),ya=n(38348),Ia=n(29567),xa=n(85548),_a=n(14601),Ea=n(12126),wa=n(77843),Ua=n(95195),Ca=n(20817),Sa=n(65219),Na=n(81999),Ta=n(44760);!function(e){e.thankYou="thankYou"}(fa||(fa={})),function(e){e.create=function(e,t=6e3){return{kind:e,dismissTimestamp:Date.now()+t}}}(ba||(ba={}));var Ma=n(55822);function Aa(e,t=self){return t.navigator&&t.navigator.clipboard&&t.navigator.clipboard.writeText?t.navigator.clipboard.writeText(e):Promise.reject("The Clipboard API is not available.")}function Fa(e){return(t,n)=>i=>(0,s.zG)(i,r.cq(e)(t,(0,s.ls)(b.some,n)),b.getOrElse((()=>(0,s.zG)(i,r.ZQ(e)(t,n(b.none))))))}const Ga=(e,t)=>Fa(Sa.h.Id.eq)(e,t),za=(e,t)=>Fa(h.p.Id.eq)(e,t),Pa=(e,t)=>Fa(xa.A.eq)(e,t),La=(e,t)=>Fa(Ia.G.eq)(e,t);var Ka,Ra;!function(e){let t;e.empty=(e,t)=>({activeMenuItemId:b.none,activeMessageIndex:b.none,onboardingStep:(null==e?void 0:e.seenOnboarding)?b.none:b.some(0),panelState:"expanded",feedbackDialog:b.none,notification:b.none,activeView:(null==e?void 0:e.seenOnboarding)?"messageView":"onboardingView",annotations:(0,s.zG)(t,b.chain((t=>{var n,i;return b.fromNullable(null===(i=null===(n=null==e?void 0:e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.annotations)})),b.fold((()=>new Map),l.To(new Map,((e,t,n)=>(0,s.zG)(h.X.decode(n),Ua.g_((()=>t),(n=>t.set(e,n)))))))),summaryItems:(0,s.zG)(t,b.chain((t=>{var n,i;return b.fromNullable(null===(i=null===(n=null==e?void 0:e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.summaries)})),b.fold((()=>new Map),l.To(new Map,((e,t,n)=>(0,s.zG)(Sa.k.decode(n),Ua.g_((()=>t),(n=>t.set(e,n)))))))),people:(0,s.zG)(t,b.chain((t=>{var n,i;return b.fromNullable(null===(i=null===(n=null==e?void 0:e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.persons)})),b.fold((()=>new Map),l.To(new Map,((e,t,n)=>(0,s.zG)(Na.EC.decode(n),Ua.g_((()=>t),(n=>t.set(e,n)))))))),links:(0,s.zG)(t,b.chain((t=>{var n,i;return b.fromNullable(null===(i=null===(n=null==e?void 0:e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.links)})),b.fold((()=>new Map),l.To(new Map,((e,t,n)=>(0,s.zG)(Ta.e9.decode(n),Ua.g_((()=>t),(n=>t.set(e,n))))))))}),function(e){e.summaryItems=Ca.Ri.create((e=>e.summaryItems),((e,t)=>({...t,summaryItems:e}))),e.annotations=Ca.Ri.create((e=>e.annotations),((e,t)=>({...t,annotations:e}))),e.links=Ca.Ri.create((e=>e.links),((e,t)=>({...t,links:e}))),e.people=Ca.Ri.create((e=>e.people),((e,t)=>({...t,people:e})))}(t=e.Lens||(e.Lens={}))}(Ka||(Ka={}));class Oa{constructor(e,t,n,i,a,o,l=a.has("submitFeedbackDialog")){this._mailThread=e,this.browser=t,this._gnar=n,this._sessionUuid=i,this._features=a,this._readerCSState=o,this.isSubmitFeedbackDialogSupported=l,this._subscriptions=new _a.w,this.isClipboardSupported=function(e=self){return!!(e.navigator&&e.navigator.clipboard&&e.navigator.clipboard.writeText)}(),this._state=u.h.create(Ka.empty(this._readerCSState.get(),(0,s.zG)(this._mailThread.get().threadId,b.fromEither))),this._panelInjected=!1,this._onboardingPanelShown=!1,this._userNavigatedInPanel=!1,this.actions=new ye.xQ,this.state=u.h.combine(this._mailThread,this._state,((e,{panelState:t,activeMessageIndex:n,activeView:i,annotations:a,summaryItems:o,people:l,links:d,onboardingStep:c,activeMenuItemId:u,feedbackDialog:p,notification:g})=>{if("collapsed"===t)return{kind:"collapsed",feedbackDialog:p,notification:g};const v=(0,s.zG)(n,b.getOrElse((()=>e.messageCount-1))),k=(0,s.zG)(b.fromNullable(e.messageIndexToIdMap.get(v)),b.chain((t=>b.fromNullable(e.expandedMessages.get(t)))));return{feedbackDialog:p,notification:g,..."onboardingView"===i?{kind:"onboardingView",step:(0,s.zG)(c,b.getOrElse((()=>0))),features:this._features}:"pinnedView"===i?{kind:"pinnedView",summaryItems:(0,s.zG)(o,r.hX((e=>!e.dismissed&&e.pinned)),r.VO(Sa.h.ord),Da(this._features,"summaries")),questions:(0,s.zG)(a,r.hX((e=>!e.dismissed&&e.pinned)),r.VO(h.p.ord),Da(this._features,"needsResponse")),mentions:(0,s.zG)((0,s.zG)(l,r.hX((0,f.W9)((e=>!e.dismissed),Na.ln)),r.VO(Na.e3.ord)),Va(this._features,["mentions","peopleAndLinks"])),links:(0,s.zG)((0,s.zG)(d,r.hX((0,f.W9)((e=>!e.dismissed),Ta.kP)),r.VO(Ta.WO.ord)),Da(this._features,"links")),activeMenuItemId:u}:"messageView"===i?{kind:"messageView",header:(0,s.zG)(k,b.fold((()=>m.x5),(e=>(0,s.zG)(e.message,m.UI((e=>({author:e.author,date:e.date}))))))),navigation:{canGoBack:v>0,canGoForward:v<e.messageCount-1},message:(0,s.zG)(k,b.fold((()=>m.x5),(e=>(0,s.zG)(e.message,m.UI((e=>({id:e.id,date:e.date,wordCount:e.wordCount}))))))),summary:(0,s.zG)(Ha(k,o),Da(this._features,"summaries")),questions:(0,s.zG)(Za(k,a),Da(this._features,"needsResponse")),mentions:(0,s.zG)(ja(k,l,e.avatars),Va(this._features,["mentions","peopleAndLinks"])),links:(0,s.zG)(qa(k,d),Da(this._features,"links")),activeMenuItemId:u}:(0,B.vE)(i)}})),this.inlineHighlightsEnabled=this._readerCSState.view((({inlineHighlightsEnabled:e})=>(0,s.zG)(b.fromNullable(e),b.getOrElse((()=>!0))))),this._maybeThreadId=(0,s.zG)(this._mailThread.get().threadId,b.fromEither,b.toUndefined),this.areInlineHighlightsSupported=a.has("inlineHighlights"),this._subscriptions.add(this._mailThread.view("messageCount").subscribe((e=>this._state.lens("activeMessageIndex").modify(b.map((t=>Math.max(0,Math.min(t,e-1)))))))),this._subscriptions.add(this._trackMessageShow()),this._subscriptions.add(this._autoDismissNotifications()),this._subscriptions.add(this._handleCollapseButtonClick()),this._subscriptions.add(this._handleExpandButtonClick()),this._subscriptions.add(this._handlePanelMounted()),this._subscriptions.add(this._handleThreadViewNavigate()),this._subscriptions.add(this._handleOpenPinnedView()),this._subscriptions.add(this._handleOpenMessageView()),this._subscriptions.add(this._handleOnboardingViewNavigate()),this._subscriptions.add(this._handleCheckQuestionItem()),this._subscriptions.add(this._handleColumnScroll()),this._subscriptions.add(this._handleItemBlur()),this._subscriptions.add(this._handleOpenItemMenu()),this._subscriptions.add(this._handleLinkItemClick()),this._subscriptions.add(this._handlePin()),this._subscriptions.add(this._handleDismiss()),this._subscriptions.add(this._handleCopy()),this._subscriptions.add(this._handleRating()),this._subscriptions.add(this._handleOptIn()),this._subscriptions.add(this._handleOptOut()),this._subscriptions.add(this._handleCloseNotification()),this._subscriptions.add(this._handleOpenFeedbackDialog()),this._subscriptions.add(this._handleSubmitFeedbackDialog()),this._subscriptions.add(this._handleSkipFeedbackDialog()),this._subscriptions.add(this._handleCloseFeedbackDialog()),this._subscriptions.add(this._handleInlineHighlightsToggle())}_handlePanelMounted(){return this.actions.pipe(R.ofType(K.Kind.panelMounted)).subscribe((({subject:e})=>{e===G.readerPanel?this._panelInjected||"onboardingView"===this._state.get().activeView||(this._gnar.readerMailPanelShow(this._sessionUuid,this._maybeThreadId),this._panelInjected=!0):e===G.onboardingPanel?this._onboardingPanelShown||(this._gnar.readerMailOnboardingPanelShow(this._sessionUuid,this._maybeThreadId),this._onboardingPanelShown=!0):(0,B.vE)(e)}))}_handleExpandButtonClick(){return this.actions.pipe(R.ofType(K.Kind.expand)).subscribe((({source:e})=>{switch(this._state.modify((e=>({...e,panelState:"expanded",feedbackDialog:b.none,notification:b.none}))),e){case P.expandButton:this._gnar.readerMailPanelExpandButtonClick(this._state.get().activeView,this._sessionUuid,this._maybeThreadId);break;case P.recapButton:this._gnar.readerMailRecapExpandButtonClick(this._state.get().activeView,this._sessionUuid,this._maybeThreadId);break;default:(0,B.vE)(e)}}))}_handleCollapseButtonClick(){return this.actions.pipe(R.ofType(K.Kind.collapse)).subscribe((({source:e})=>{switch(this._state.modify((e=>({...e,panelState:"collapsed",feedbackDialog:b.none,notification:b.none}))),e){case z.collapseButton:this._gnar.readerMailPanelCollapseButtonClick(this._state.get().activeView,this._sessionUuid,this._maybeThreadId);break;case z.recapButton:this._gnar.readerMailRecapCollapseButtonClick(this._sessionUuid,this._maybeThreadId);break;default:(0,B.vE)(e)}}))}_handleOptIn(){return this.actions.pipe(R.ofType(K.Kind.optIn)).subscribe((()=>{this._state.modify((e=>({...e,activeView:"messageView",onboardingStep:b.none}))),this._gnar.readerMailOnboardingPanelOptInButtonClick(this._sessionUuid,this._maybeThreadId)}))}_handleOptOut(){return this.actions.pipe(R.ofType(K.Kind.optOut)).subscribe((()=>{this._state.modify((e=>({...e,panelState:"collapsed",onboardingStep:b.none,feedbackDialog:b.none,notification:b.none}))),this._gnar.readerMailOnboardingPanelOptOutButtonClick(this._sessionUuid,this._maybeThreadId)}))}_handleOnboardingViewNavigate(){return this.actions.pipe(R.ofType(K.Kind.onboardingViewNavigate)).subscribe((({action:e})=>{const t=(0,s.zG)(this._state.get().onboardingStep,b.getOrElse((()=>0)),(t=>{switch(e){case F.left:return Math.max(t-1,0);case F.right:return Math.min(t+1,2);default:(0,B.vE)(e)}}));this._state.lens("onboardingStep").set(b.some(t)),this._gnar.readerMailOnboardingPanelNavigationButtonClick(this._sessionUuid,v[t],this._maybeThreadId)}))}getNextActiveMessageIndex(e){return function(e,t,n){if(e===A.left&&t>0)return b.some(t-1);if(e===A.right&&t<n-1)return b.some(t+1);if(e===A.first&&t>0)return b.some(0);if(e===A.last&&t<n-1)return b.some(n-1);return b.none}(e,(0,s.zG)(this._state.get().activeMessageIndex,b.getOrElse((()=>this._mailThread.get().messageCount-1))),this._mailThread.get().messageCount)}_handleThreadViewNavigate(){return this.actions.pipe(R.ofType(K.Kind.threadViewNavigate)).subscribe((({action:e,nextIndex:t})=>{this._userNavigatedInPanel=!0,this._state.lens("activeMessageIndex").set(b.some(t)),this._gnar.readerMailPanelNavigationButtonClick(e,this._sessionUuid,this._maybeThreadId)}))}_handleOpenPinnedView(){return this.actions.pipe(R.ofType(K.Kind.openPinnedView)).subscribe((()=>{this._state.lens("activeView").set("pinnedView"),this._gnar.readerMailPanelPinnedButtonClick(this._sessionUuid,this._maybeThreadId)}))}_handleOpenMessageView(){return this.actions.pipe(R.ofType(K.Kind.openMessageView)).subscribe((({source:e})=>{switch(this._state.lens("activeView").set("messageView"),e){case L.messagesButton:this._gnar.readerMailPanelMessagesButtonClick(this._sessionUuid,this._maybeThreadId);break;case L.emptyPinnedSummaries:case L.emptyPinnedFollowUps:case L.emptyPinnedMentions:case L.emptyPinnedLinks:this._gnar.readerMailPanelReturnToMessagesButtonClick(this._sessionUuid,e,this._maybeThreadId);break;default:(0,B.vE)(e)}}))}_handleCheckQuestionItem(){return this.actions.pipe(R.ofType(K.Kind.check)).subscribe((({item:e,checked:t})=>{this._state.lens(Ka.Lens.annotations).modify(za(e.itemId,(0,s.ls)(b.getOrElse((()=>e)),(e=>({...e,checked:t}))))),this._gnar.readerMailPanelQuestionItemCheck(e.message.id,this._state.get().activeView,this._sessionUuid,t,this._maybeThreadId)}))}_handlePin(){return this.actions.pipe(R.ofType(K.Kind.pin)).subscribe((({item:e,itemType:t,pinned:n})=>{switch(t){case"summaryItem":this._state.lens(Ka.Lens.summaryItems).modify(Ga(e.itemId,(0,s.ls)(b.getOrElse((()=>e)),(e=>({...e,pinned:n}))))),this._gnar.readerMailPanelSummaryItemPin(e.message.id,this._sessionUuid,n,this._maybeThreadId);break;case"followUpItem":this._state.lens(Ka.Lens.annotations).modify(za(e.itemId,(0,s.ls)(b.getOrElse((()=>e)),(e=>({...e,pinned:n}))))),this._gnar.readerMailPanelQuestionItemPin(e.message.id,this._sessionUuid,n,this._maybeThreadId);break;case"linkItem":this._state.lens(Ka.Lens.links).modify(Pa(e.url,(0,s.ls)(b.getOrElse((()=>e)),(e=>({...e,pinned:n,messagePinnedFrom:n?b.some(e.message):b.none}))))),this._gnar.readerMailPanelLinkItemPin(e.message.id,this._sessionUuid,n,this._maybeThreadId);break;case"mentionItem":this._state.lens(Ka.Lens.people).modify(La(e.email,(0,s.ls)(b.getOrElse((()=>e)),(e=>({...e,pinned:n,messagePinnedFrom:n?b.some(e.message):b.none}))))),this._gnar.readerMailPanelPersonItemPin(e.message.id,this._sessionUuid,n,this._maybeThreadId);break;default:(0,B.vE)(e)}this._setActiveItemId(null)}))}_handleCopy(){return this.actions.pipe(R.ofType(K.Kind.copy)).subscribe((({item:e,itemType:t})=>{switch(t){case"summaryItem":this._subscriptions.add(Ea.D(Aa(e.text)).subscribe()),this._gnar.readerMailPanelSummaryItemCopy(e.message.id,this._sessionUuid,this._maybeThreadId);break;case"followUpItem":this._subscriptions.add(Ea.D(Aa(e.text)).subscribe()),this._gnar.readerMailPanelQuestionItemCopy(e.message.id,this._sessionUuid,this._maybeThreadId);break;case"linkItem":this._subscriptions.add(Ea.D(Aa(e.name)).subscribe()),this._gnar.readerMailPanelLinkItemCopy(e.message.id,this._sessionUuid,this._maybeThreadId);break;case"mentionItem":this._subscriptions.add(Ea.D(Aa(e.email)).subscribe()),this._gnar.readerMailPanelPersonItemCopy(e.message.id,this._sessionUuid,this._maybeThreadId);break;default:(0,B.vE)(e)}this._setActiveItemId(null)}))}_handleDismiss(){return this.actions.pipe(R.ofType(K.Kind.dismiss)).subscribe((({item:e,itemType:t})=>{switch(t){case"summaryItem":this._state.lens(Ka.Lens.summaryItems).modify(Ga(e.itemId,(0,s.ls)(b.getOrElse((()=>e)),(e=>({...e,dismissed:!0}))))),this._gnar.readerMailPanelSummaryItemDismiss(e.message.id,this._sessionUuid,this._maybeThreadId);break;case"followUpItem":this._state.lens(Ka.Lens.annotations).modify(za(e.itemId,(0,s.ls)(b.getOrElse((()=>e)),(e=>({...e,dismissed:!0}))))),this._gnar.readerMailPanelQuestionItemDismiss(e.message.id,this._sessionUuid,this._maybeThreadId);break;case"linkItem":this._state.lens(Ka.Lens.links).modify(Pa(e.url,(0,s.ls)(b.getOrElse((()=>e)),(e=>({...e,dismissed:!0}))))),this._gnar.readerMailPanelLinkItemDismiss(e.message.id,this._sessionUuid,this._maybeThreadId);break;case"mentionItem":this._state.lens(Ka.Lens.people).modify(La(e.email,(0,s.ls)(b.getOrElse((()=>e)),(e=>({...e,dismissed:!0}))))),this._gnar.readerMailPanelPersonItemDismiss(e.message.id,this._sessionUuid,this._maybeThreadId);break;default:(0,B.vE)(e)}this._setActiveItemId(null)}))}_handleRating(){return this.actions.pipe(O.h((0,f.Kg)(K.is(K.Kind.like),K.is(K.Kind.dislike)))).subscribe((({kind:e,item:t,itemType:n,position:i})=>{switch(n){case"summaryItem":this._state.lens(Ka.Lens.summaryItems).modify(Ga(t.itemId,(0,s.ls)(b.getOrElse((()=>t)),(t=>({...t,rating:Ba(e)}))))),this.actions.next({kind:K.Kind.openFeedback,source:{kind:"itemPanelMenu",itemType:"summaryItem",item:t,action:e},position:i});break;case"followUpItem":this._state.lens(Ka.Lens.annotations).modify(za(t.itemId,(0,s.ls)(b.getOrElse((()=>t)),(t=>({...t,rating:Ba(e)}))))),this.actions.next({kind:K.Kind.openFeedback,source:{kind:"itemPanelMenu",itemType:"followUpItem",item:t,action:e},position:i});break;case"linkItem":this._state.lens(Ka.Lens.links).modify(Pa(t.url,(0,s.ls)(b.getOrElse((()=>t)),(t=>({...t,rating:Ba(e)}))))),this.actions.next({kind:K.Kind.openFeedback,source:{kind:"itemPanelMenu",itemType:"linkItem",item:t,action:e},position:i});break;case"mentionItem":this._state.lens(Ka.Lens.people).modify(La(t.email,(0,s.ls)(b.getOrElse((()=>t)),(t=>({...t,rating:Ba(e)}))))),this.actions.next({kind:K.Kind.openFeedback,source:{kind:"itemPanelMenu",itemType:"mentionItem",item:t,action:e},position:i});break;default:(0,B.vE)(t)}}))}_setActiveItemId(e){this._state.lens("activeMenuItemId").set(b.fromNullable(e))}_handleOpenItemMenu(){return this.actions.pipe(R.ofType(K.Kind.openItemMenu)).subscribe((({itemId:e})=>this._setActiveItemId(e)))}_handleColumnScroll(){return this.actions.pipe(R.ofType(K.Kind.columnScroll)).subscribe((()=>this._setActiveItemId(null)))}_handleItemBlur(){return this.actions.pipe(R.ofType(K.Kind.itemBlur)).subscribe((()=>this._setActiveItemId(null)))}_handleOpenFeedbackDialog(){return this.actions.pipe(R.ofType(K.Kind.openFeedback)).subscribe((({source:e,position:t})=>this._state.lens("feedbackDialog").set(b.some({source:e,position:t}))))}_handleCloseFeedbackDialog(){return this.actions.pipe(R.ofType(K.Kind.closeFeedback)).subscribe((()=>this._state.modify((e=>({...e,feedbackDialog:b.none,activeMenuItemId:b.none})))))}_handleSkipFeedbackDialog(){return this.actions.pipe(R.ofType(K.Kind.skipFeedback)).subscribe((()=>this._state.modify((e=>({...e,feedbackDialog:b.none,activeMenuItemId:b.none})))))}_handleSubmitFeedbackDialog(){return this.actions.pipe(R.ofType(K.Kind.submitFeedback)).subscribe((()=>this._state.modify((e=>({...e,feedbackDialog:b.none,activeMenuItemId:b.none,notification:b.some(ba.create(fa.thankYou))})))))}_handleCloseNotification(){return this.actions.pipe(R.ofType(K.Kind.closeNotification)).subscribe((()=>this._state.lens("notification").set(b.none)))}_handleLinkItemClick(){return this.actions.pipe(R.ofType(K.Kind.linkClick)).subscribe((({item:e})=>{this._gnar.readerMailPanelLinkItemClick(e.message.id,this._sessionUuid,this._maybeThreadId)}))}_handleInlineHighlightsToggle(){return this.actions.pipe(R.ofType(K.Kind.toggleInlineHighlights)).subscribe((({enabled:e})=>{e?this._gnar.readerMailInlineHighlightsDisable(this._sessionUuid,this._maybeThreadId):this._gnar.readerMailInlineHighlightsEnable(this._sessionUuid,this._maybeThreadId)}))}dispose(){this._subscriptions.unsubscribe()}_autoDismissNotifications(){return wa.F(1e3).pipe(Ie.M(this._state),O.h((([e,t])=>(0,s.zG)(t.notification,b.fold(s.jv,(e=>Date.now()>=e.dismissTimestamp)))))).subscribe((()=>this._state.lens("notification").modify(b.filter((e=>Date.now()<e.dismissTimestamp)))))}_trackMessageShow(){return this.state.pipe(O.h(_),ut.x(((e,t)=>ka.Rb.eq.equals(e.message.value,t.message.value)))).subscribe((e=>{const t=(0,s.zG)(e.summary,b.filter(m.d6),b.fold((()=>0),(e=>e.value.length))),n=(0,s.zG)(e.questions,b.filter(m.d6),b.fold((()=>0),(e=>e.value.length))),i=(0,s.zG)(e.mentions,b.filter(m.d6),b.fold((()=>0),(e=>e.value.length)));this._gnar.readerMailPanelMessageShow(Array.from(this._features),e.message.value.id,i,n,this._sessionUuid,this._userNavigatedInPanel?"navigation":"firstLoad",t,e.message.value.wordCount,"parsedDate"===e.message.value.date.kind?e.message.value.date.timestamp:void 0,this._maybeThreadId)}))}}function Ba(e){return"like"===e?_t.DE.liked:"dislike"===e?_t.DE.disliked:(0,B.vE)(e)}function Da(e,t){return e.has(t)?b.some:(0,s.a9)(b.none)}function Va(e,t){return t.some((t=>e.has(t)))?b.some:(0,s.a9)(b.none)}function Ha(e,t){return(0,s.zG)(e,b.fold((()=>m.x5),(e=>(0,s.zG)(a.Y(m.$w)({summary:e.summary,message:e.message}),m.UI((({summary:e,message:n})=>(0,s.zG)(e,b.fold((()=>[]),(0,s.ls)(X.ei("summary"),o.UI((e=>{var i,a;const s=Sa.h.Id.create(e.id),o=t.get(s);return{message:{id:n.id,author:n.author,date:n.date,index:n.index},itemId:s,text:e.text,pinned:null!==(i=null==o?void 0:o.pinned)&&void 0!==i&&i,dismissed:null!==(a=null==o?void 0:o.dismissed)&&void 0!==a&&a,rating:null==o?void 0:o.rating}})),o.hX((e=>!e.dismissed)))))))))))}function Za(e,t){return(0,s.zG)(e,b.fold((()=>m.x5),(e=>(0,s.zG)(a.Y(m.$w)({annotations:e.annotations,message:e.message}),m.UI((({annotations:e,message:n})=>(0,s.zG)(e,b.fold((()=>[]),(0,s.ls)(X.ei("annotations"),o.UI((e=>{var i,a,s;const o=h.p.Id.create(e.id),r=t.get(o);return{message:{id:n.id,author:n.author,date:n.date,index:n.index},itemId:o,text:e.text,type:e.type,pinned:null!==(i=null==r?void 0:r.pinned)&&void 0!==i&&i,checked:null!==(a=null==r?void 0:r.checked)&&void 0!==a&&a,dismissed:null!==(s=null==r?void 0:r.dismissed)&&void 0!==s&&s,rating:null==r?void 0:r.rating}})),o.hX((e=>!e.dismissed)),o.hX((e=>"question"===e.type||"action_item"===e.type)))))))))))}function ja(e,t,n){return(0,s.zG)(e,b.fold((()=>m.x5),(e=>(0,s.zG)(e.message,m.tS((e=>(0,s.zG)(e.audience,va.c2,b.fold((()=>m.kH(new Ma.ZS("No audience"))),(i=>m.Vp((0,s.zG)(i,o.UI((i=>{var a,o,r;const l=t.get(i.email);return{message:{id:e.id,author:e.author,date:e.date,index:e.index},messagePinnedFrom:null!==(a=null==l?void 0:l.messagePinnedFrom)&&void 0!==a?a:b.none,name:(0,s.zG)($a(i,n),b.toUndefined),email:i.email,avatarUrl:(0,s.zG)(b.fromNullable(n.get(i.email)),b.chain((e=>b.fromNullable(e.avatarUrl)))),pinned:null!==(o=null==l?void 0:l.pinned)&&void 0!==o&&o,dismissed:null!==(r=null==l?void 0:l.dismissed)&&void 0!==r&&r,rating:null==l?void 0:l.rating}})),o.hX((e=>!e.dismissed)))))))))))))}function qa(e,t){return(0,s.zG)(e,b.fold((()=>m.x5),(e=>(0,s.zG)(e.message,m.tS((e=>m.Vp(e.links.map((n=>{var i,a,s;const o=t.get(n.url);return{message:{id:e.id,author:e.author,date:e.date,index:e.index},messagePinnedFrom:null!==(i=null==o?void 0:o.messagePinnedFrom)&&void 0!==i?i:b.none,name:n.name,url:n.url,type:n.type,mimeType:ya.q.isAttachment(n)?n.mimeType:void 0,pinned:null!==(a=null==o?void 0:o.pinned)&&void 0!==a&&a,dismissed:null!==(s=null==o?void 0:o.dismissed)&&void 0!==s&&s,rating:null==o?void 0:o.rating}})).filter((e=>!e.dismissed)))))))))}function $a(e,t){return(0,s.zG)(b.fromNullable(t.get(e.email)),b.chain((e=>b.fromNullable(e.name))),Et.vx(b.fromNullable(e.name)))}!function(e){e.Mock=class{constructor(e,t=!0,n=!0){this._state=e,this.isSubmitFeedbackDialogSupported=t,this.areInlineHighlightsSupported=n,this._subscriptions=new _a.w,this.inlineHighlightsEnabled=u.h.create(!0),this.actions=new ye.xQ,this.browser="chrome",this.isClipboardSupported=!0,this.state=this._state.view(),this._subscriptions.add(this.actions.pipe(O.h((0,f.Kg)(K.is(K.Kind.submitFeedback),K.is(K.Kind.skipFeedback),K.is(K.Kind.closeFeedback)))).subscribe((()=>this._updateFeedback(b.none)))),this._subscriptions.add(this.actions.pipe(R.ofType(K.Kind.openFeedback)).subscribe((({source:e,position:t})=>this._updateFeedback(b.some({source:e,position:t}))))),this._subscriptions.add(this.actions.pipe(O.h((0,f.Kg)(K.is(K.Kind.columnScroll),K.is(K.Kind.itemBlur)))).subscribe((()=>this._setActiveItemId(null)))),this._subscriptions.add(this.actions.pipe(R.ofType(K.Kind.openItemMenu)).subscribe((({itemId:e})=>this._setActiveItemId(e)))),this._subscriptions.add(this.actions.pipe(O.h((0,f.Kg)(K.is(K.Kind.like),K.is(K.Kind.dislike)))).subscribe((({kind:e,item:t,itemType:n,position:i})=>{switch(n){case"summaryItem":this.actions.next({kind:K.Kind.openFeedback,source:{kind:"itemPanelMenu",itemType:"summaryItem",item:t,action:e},position:i});break;case"followUpItem":this.actions.next({kind:K.Kind.openFeedback,source:{kind:"itemPanelMenu",itemType:"followUpItem",item:t,action:e},position:i});break;case"linkItem":this.actions.next({kind:K.Kind.openFeedback,source:{kind:"itemPanelMenu",itemType:"linkItem",item:t,action:e},position:i});break;case"mentionItem":this.actions.next({kind:K.Kind.openFeedback,source:{kind:"itemPanelMenu",itemType:"mentionItem",item:t,action:e},position:i});break;default:(0,B.vE)(t)}})))}getNextActiveMessageIndex(e){return b.none}dispose(){this._subscriptions.unsubscribe()}_setActiveItemId(e){this._state.modify((t=>y(t)||I(t)?{...t,activeMenuItemId:b.fromNullable(e)}:t))}_updateFeedback(e){this._state.modify((t=>"collapsed"!==t.kind&&"onboardingView"!==t.kind?{...t,activeMenuItemId:b.isNone(e)?b.none:t.activeMenuItemId,feedbackDialog:e}:"collapsed"===t.kind?{...t,feedbackDialog:e}:t))}}}(Ra||(Ra={}));var Wa=n(84603),Qa=n(66319),Ja=n(90361),Ya=n(75420),Xa=n(74850),es=n(19751),ts=n(40151),ns=n(24209),is=n(17343),as=n(16118),ss=n(78674),os=n(71032),rs=n(85321),ls=n(67434),ds=n(95093),cs=n(73975),ms=n(69243);const us=ms.OT(ms.dt({s:ms.pk,e:ms.pk})),ps=ms.G0([ms.i0("main_point"),ms.i0("date"),ms.i0("question"),ms.i0("action_item")]);var hs;!function(e){let t;!function(e){e.codec=ms.UQ(ms.Z_,(e=>"string"==typeof e),"ReaderAnnotationId"),e.create=function(e,t){return`${e}|${t.s}-${t.e}`}}(t=e.Id||(e.Id={}))}(hs||(hs={}));const gs=ms.dt({annotations:ms.IX(ms.jV([ms.dt({message_id:ka.Rb.Id.codec,span:us,type:ps}),ms.r$({id:hs.Id.codec,isSensitive:ms.O7,isMessageFiltered:ms.O7,isMessageSensitive:ms.O7})]))});new ms.Dy("ReaderAnnotations",gs.is,gs.validate,(e=>e.annotations.reduce(((e,t)=>{var n;return e[t.message_id]={messageId:t.message_id,isMessageFiltered:t.isMessageFiltered||!1,isMessageSensitive:t.isMessageSensitive||!1,annotations:((null===(n=e[t.message_id])||void 0===n?void 0:n.annotations)||[]).concat({id:t.id||hs.Id.create(t.message_id,t.span),span:t.span,type:t.type,isSensitive:t.isSensitive||!1})},e}),{})));var fs;!function(e){e.eq=cs.MW({id:cs.yv,span:cs.MW({s:cs.lr,e:cs.lr}),type:cs.yv,isSensitive:cs.vD})}(hs||(hs={})),function(e){let t;!function(e){e.create=function(e,t){return`${e}|${t}`}}(t=e.Id||(e.Id={}))}(fs||(fs={}));var bs=n(25691);class vs{constructor(e=Xa.Y.create("Reader-Card-Controller")){this._logger=e,this._hovered=new ye.xQ,this._dismissed=new ye.xQ,this.cardHovered=this._hovered.pipe((0,re.O)(!1),(0,ut.x)()),this.cardDismissed=this._dismissed.pipe((0,ut.x)()),this._activeCardModel=u.h.create(null),this.view=(0,te.aj)([this._activeCardModel]).pipe((0,E.U)((([e])=>(null==e?void 0:e.annotation)?g.createElement(bs.W,{anchorRect:e.highlightRect},g.createElement("div",{style:{background:"white",borderRadius:10,padding:10,fontSize:"12px",fontFamily:"sans-serif",boxShadow:"0px 2px 10px rgba(0, 0, 0, 0.6)"}},g.createElement("b",null,"Annotation"),g.createElement("pre",{style:{maxWidth:400,whiteSpace:"pre-wrap"}},JSON.stringify(e.annotation,null,4)))):null))),this._logger.debug("Created")}show(e){this._activeCardModel.set(e)}hide(){this._activeCardModel.set(null),this._hovered.next(!1)}dispose(){this.hide()}}var ks=n(34311);class ys{constructor(e){this._annotationsStateService=e}getHoveredStateBehavior(e){return this._annotationsStateService.getHighlightedAnnotation().pipe((0,E.U)((t=>t&&t.highlightIds.includes(e)?ks.pc.hovered:ks.pc.none)))}}var Is,xs=n(50628),_s=n(24755),Es=n(95300),ws=n(95343),Us=n(11407),Cs=n(28728),Ss=n(15555),Ns=n(13718);!function(e){e.eq=cs.f7(((e,t)=>e&&t?e.annotationId===t.annotationId:e===t))}(Is||(Is={}));class Ts{constructor(e,t=Xa.Y.create(Ts.name)){this._options=e,this._log=t,this._rawHighlightedAnnotation=()=>this._options.mouseData.pipe(Ns.U(Us.S.hz30),es.skipBy(Cs.Z.eq),E.U((({client:e,offset:t})=>{if(e&&t&&function(e,t){var n;let i=t.ownerDocument.elementFromPoint(e.left,e.top);(null===(n=null==i?void 0:i.shadowRoot)||void 0===n?void 0:n.elementFromPoint)&&(i=i.shadowRoot.elementFromPoint(e.left,e.top));return t.contains(i)}(e,this._options.textNode)){const e=this._options.highlightGeometry.geometry.get();return Array.from(e.keys()).reduce(((n,i)=>{const a=e.get(i);if(a){const e=a.rects&&(null===a.meta.highlightDisplayFormat||Ss.jk.isInteractable(a.meta.highlightDisplayFormat))&&a.rects.find((e=>st.UL.contains(t,e)));if(e)return{annotationId:a.meta.annotationId,activeHighlightId:a.meta.highlightId,activeHighlightRect:e,highlightIds:[]}}return n}),null)}return null})),es.skipBy(Is.eq),E.U((e=>{if(!e)return null;const t=this._options.highlightGeometry.geometry.get(),n=[];return t.forEach(((t,i)=>{t.meta.annotationId===e.annotationId&&n.push(i)})),{...e,highlightIds:n}}))),this._offByUpdatedGeometry=e=>this._options.highlightGeometry.geometry.pipe(E.U((t=>e&&t.has(e.activeHighlightId)?e:null)),O.h((e=>null===e)),is.h(null),xe.b((e=>this._log.trace("OffByUpdatedGeometry",e)))),this._offByTextPositionChange=()=>ns.T(this._options.textNodeLayout.rect.changes.pipe(xe.b((()=>this._log.trace("Text field position, size has been changed")))),this._options.textNodeLayout.scroll.changes.pipe(xe.b((()=>this._log.trace("Text field scroll has been changed")))),Ze.R(self,"scroll").pipe(xe.b((()=>this._log.trace("Window scroll detected"))))).pipe(xs.P(),is.h(null))}getActiveAnnotation(){throw new Error("Not implemented")}getHighlightedAnnotation(){throw new Error("Not implemented")}}class Ms extends Ts{constructor(e,t=Xa.Y.create(Ms.name)){super(e,t)}getActiveAnnotation(){return this.getHighlightedAnnotation().pipe(es.skipBy(Is.eq))}getHighlightedAnnotation(){return this._rawHighlightedAnnotation().pipe(es.skipBy(Is.eq),pt.w((e=>e?ns.T(this._offByUpdatedGeometry(e),this._offByTextPositionChange()).pipe(xe.b((()=>this._log.trace("Active state was overriden by text or geometry change"))),xs.P(),re.O(e)):S.of(null))),es.skipBy(Is.eq),_s.O(new Es.X(null)),ws.x())}}var As=n(93356),Fs=n(76331),Gs=n(40327),zs=n(10166),Ps=n(71249),Ls=n(4432);class Ks{constructor(){}create(e,t){return{getRects:()=>{var n;const i=[];let a,s=e.start,o=!1;do{const r=t.getFragmentAtOrBeforeOffset(s);if(r&&a!==s){a=s;if(null===(n=r.node.textContent)||void 0===n?void 0:n.replace(/\s/g,"")){const n=Ls.M.createRange(t,s,Math.min(r.endOffset,e.end));n&&i.push(...Array.from(n.getClientRects()))}s=r.endOffset===s?r.endOffset+1:r.endOffset}else o=!0}while(s<e.end&&!o);return(0,Gs.pipe)(i,zs.e,zs.y,Ps.UI(st.Pf.create))}}}getClientRects(e){return e.getRects()}getIsInvalid(e){return!1}getIsConsistent(e,t,n){return!0}dispose(e){}}var Rs=n(13116),Os=n(28094),Bs=n(95981),Ds=n(63919),Vs=n(25924),Hs=n(18505),Zs=n(2780),js=n(68383),qs=n(92783),$s=n(57356),Ws=n(51655),Qs=n(70718),Js=n(13822);function Ys(e,t,n,i=!1){const a=(0,Ws.Me)(e).body,s=(0,Ws.Jj)(e);let o={left:"0px",top:"0px"};if(t.fieldPaintingPositioning===$s.Q.nonPositioned&&t.positionedAncestor===a){const e=s.getComputedStyle(a);o={left:e.marginLeft||"0px",top:e.marginRight||"0px"}}else if(t.positionedAncestor!==a){const e=s.getComputedStyle(t.positionedAncestor);o={left:e.borderLeftWidth&&`-${e.borderLeftWidth}`||"0px",top:e.borderTopWidth&&`-${e.borderTopWidth}`||"0px"}}return a=>{a.style.position="absolute",a.style.top=o.top,a.style.left=i?"auto":o.left,a.style.right=i?o.left:"auto",a.style.pointerEvents="none",function({subjectElement:e,isPositioned:t,subjectElementStyle:n,integrationRoot:i,positionedAncestor:a}){t?(i.style.zIndex=n.zIndex,e.insertAdjacentElement("afterend",i)):a.insertAdjacentElement("afterbegin",i)}({subjectElement:e,isPositioned:t.fieldPaintingPositioning===$s.Q.positioned,subjectElementStyle:n,integrationRoot:a,positionedAncestor:t.positionedAncestor})}}function Xs(e){return st.Pf.create({...e.client,...e.size})}class eo{constructor(e){this._highlightsSubject=e,this.getFieldPositionRelativeToViewport=()=>{const e=this._highlightsSubject.getBoundingClientRect();return{top:e.top,left:e.left,width:e.width,height:e.height}},this._prepareHighlights=(e,t=(0,Ws.is)(e))=>{const n=(0,Ws.o)(e),i=(0,Qs.fL)(e,!1,n,t);return{layout:i,rootInjector:Ys(e,i,n),enableHighlightsBlendingOnRoot:(0,Os.$)(e,n)}},this._prepareInnerElements=(e,t=(0,Ws.is)(e),n)=>{const i=(0,Ws.o)(e),a=n||(0,Qs.fL)(e,!1,i,t);return{layout:a,rootInjector:Ys(e,a,i,!0)}},this._highlights=this._prepareHighlights(this._highlightsSubject),this._innerElements=this._prepareInnerElements(this._highlightsSubject,void 0,this._highlights.layout),this._win=(0,Ws.Jj)(this._highlightsSubject),this._createTextNodeRect=e=>({page:Ds.Cv.fromClient(e.client,{top:this._win.scrollY,left:this._win.scrollX}),offset:e.offset,client:e.client,size:e.size,padding:e.padding}),this.textNode={rect:this._highlights.layout.textField.paddingRect.map(this._createTextNodeRect),visibleRect:this._highlights.layout.textField.visibleRect.map(this._createTextNodeRect),scroll:this._highlights.layout.textField.scroll,scrollSize:this._highlights.layout.textField.scrollSize,scroller:(0,c.iX)(this._highlightsSubject,{rect:this._highlights.layout.textField.paddingRect.map(this._createTextNodeRect),scrollSize:this._highlights.layout.textField.scrollSize})},this.highlightHeightOffset=0,this.mouse=(0,te.aj)([this._highlights.layout.textField.paddingRect.behavior,this._highlights.layout.textField.scroll.behavior]).pipe((0,E.U)((([e,t])=>({rect:Xs(e),scroll:t}))),(0,pt.w)((({rect:e,scroll:t})=>(0,qs.Am)()?(0,Vs.q7)(this._win,e,t):(0,Vs.B0)(this._win,e,t))),(0,ut.x)(Ja.fS))}createGeometryLayout(){return new Bs.D((()=>Xs(this._highlights.layout.textField.paddingRect.getCurrent())),(()=>this._highlights.layout.textField.scroll.getCurrent()),(()=>Xs(this._highlights.layout.textField.paddingRect.getApproximate())),(()=>this._highlights.layout.textField.scroll.getApproximate()))}render(e,t){const n={position:"absolute",top:0,left:0},i={position:"absolute",top:0,right:0},a=()=>e.innerElements?g.createElement(e.innerElements,null):null,s=(0,Ws.Me)(this._highlightsSubject),o=Hs.VB.get({monitorAs:"highlights"}).inject(Zs.EM.fromDocument(s,"grammarly-extension"),(e=>{t.highlightsBlendingEnabled&&this._highlights.enableHighlightsBlendingOnRoot(e),this._highlights.rootInjector(e)}),js.G7.showWhenLoaded(g.createElement((()=>g.createElement(g.Fragment,null,e.highlights&&g.createElement("div",{"data-grammarly-part":"highlights",style:n},g.createElement(Js.V,{layout:this._highlights.layout},g.createElement("div",{style:n},g.createElement(e.highlights,null)))))),null))),r=Hs.VB.get({monitorAs:"inner-elements"}).inject(Zs.EM.fromDocument(s,"grammarly-extension"),this._innerElements.rootInjector,js.G7.showWhenLoaded(g.createElement((()=>e.innerElements?g.createElement("div",{"data-grammarly-part":"inner-elements",style:i},g.createElement(a,null)):null),null))),l=e.outerElements&&Hs.VB.get({monitorAs:"outer-elements"}).inject(Zs.EM.fromDocument(s,"grammarly-popups"),Zs.zs.appendChild(s.documentElement),js.G7.showWhenLoaded(g.createElement(e.outerElements,null)),{eventPropagationHandler:t.eventPropagationHandler});return{dispose:()=>{o&&o.dispose(),l&&l.dispose(),r&&r.dispose()}}}}var to,no=n(43675),io=n(92843),ao=n(37881),so=n(22679),oo=n(87965),ro=n(50663),lo=n(48189),co=n(49468);class mo{constructor(e,t,n,i){this._layout=e,this._highlights=t,this._annotationCards=n,this._getHoveredStateBehavior=i,this._highlightHoverStateBehavior=e=>this._getHoveredStateBehavior(e),this._getHighlightsContainer=e=>g.createElement(w.F.div,{style:this._layout.textNode.scrollSize.behavior.pipe((0,E.U)((e=>({height:e.height,width:e.width}))))},e),this.highlights=()=>this._getHighlightsContainer(g.createElement(g.Fragment,null,g.createElement(ao.$v,{key:"aqua-highlights",highlightHeightOffset:0,highlights:this._highlights.geometry.view((e=>Array.from(e.values()))),getHoverState:this._highlightHoverStateBehavior}))),this.outerElements=()=>{const e=this._annotationCards;return g.createElement(co.o,{style:{zIndex:so.op,position:"absolute",top:0,left:0,width:"100%"}},g.createElement(oo.p,null,g.createElement("div",{style:{position:"fixed",visibility:"hidden"}}),g.createElement(w.F.Fragment,null,e),g.createElement(ro.G,null),g.createElement(lo.p,{regular:!0,bold:!0})))}}}!function(e){e.eqByAnnotations=cs.Uz((e=>({annotations:e.annotations,messageId:e.messageId})))(cs.MW({messageId:cs.yv,annotations:Ps.Eh(hs.eq)}))}(to||(to={}));class uo{constructor(e,t,n,i=Xa.Y.create("Reader-Gmail-Annotations")){this._annotatedMessages=e,this._features=n,this._logger=i,this._subscriptions=new _a.w,this._currentAnnotations=new Map,this._geometryProvider=new Ks,this._state=new Map,this._bodyNodeToMessageId=new WeakMap,this._annotationIdsForMessageId=new Map,this._hiddenMessages=new WeakMap;const o=new ye.xQ,r=this._annotatedMessages.pipe(re.O(new Map),as.G(),E.U((([e,t])=>(0,s.zG)(no.yi(to.eqByAnnotations)(e,t),io.v.reduce([],((e,{messageId:t})=>e.concat({kind:"remove",messageId:t})),((e,t,n)=>e.concat({kind:"update",prevAnnotations:t.annotations,...n})),((e,t)=>e.concat({kind:"add",...t})))))),rs.zg(s.yR),ds.T(o));this._intersectionObserver=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting?(0,s.zG)(b.fromNullable(this._hiddenMessages.get(e.target)),Et.bw((t=>{this._hiddenMessages.delete(e.target),o.next({kind:"add",...t})}))):(0,s.zG)(b.fromNullable(this._bodyNodeToMessageId.get(e.target)),b.chain((e=>b.fromNullable(this._state.get(e)))),Et.bw((({message:t})=>{const{messageId:n,bodyNode:i}=t;o.next({kind:"remove",messageId:n}),this._hiddenMessages.set(e.target,t),this._intersectionObserver.observe(i)})))}))}),{root:t}),this._subscriptions.add(r.subscribe((e=>{const t=this._state.get(e.messageId);if(t&&("update"===e.kind?e.prevAnnotations.forEach((t=>{const n=fs.Id.create(e.messageId,function(e){return`${e.span.s}-${e.span.e}-${e.type}`}(t));this._currentAnnotations.delete(n),(0,s.zG)(b.fromNullable(this._annotationIdsForMessageId.get(e.messageId)),Et.bw((e=>{e.delete(n)})))})):"remove"===e.kind&&((0,s.zG)(b.fromNullable(this._annotationIdsForMessageId.get(e.messageId)),Et.bw((e=>{for(const t of e.values())this._currentAnnotations.delete(t)}))),this._annotationIdsForMessageId.delete(e.messageId),this._bodyNodeToMessageId.delete(t.message.bodyNode),this._state.delete(e.messageId)),t.disposables.forEach((e=>e.dispose())),this._logger.trace(`Annotations for ${e.messageId} cleared`)),"add"===e.kind||"update"===e.kind){const t=b.fromNullable(this._features.has("inlineCards")?new vs:null),n=new eo(e.bodyNode),i=new Fs.C(this._geometryProvider,n.createGeometryLayout(),(()=>e.textMap),(0,As.u)(),(0,ks.WF)(n.textNode)),o=(0,s.zG)(t,b.map((()=>new Ms({textNode:e.bodyNode,textNodeLayout:n.textNode,mouseData:n.mouse,highlightGeometry:i})))),r=(0,s.zG)(o,b.map((e=>new ys(e)))),l=(0,s.zG)(a.Y(b.option)({stateService:o,controller:t}),b.map((({stateService:e,controller:t})=>e.getActiveAnnotation().subscribe((e=>{if(e){const i=this._currentAnnotations.get(e.annotationId);i&&t.show({highlightRect:(0,Rs.Z)(e.activeHighlightRect,n.textNode.rect.getApproximate().client,n.textNode.scroll.getApproximate()),annotation:i})}else t.hide()}))))),d=new mo(n,i,(0,s.zG)(t,b.map((e=>e.view)),b.getOrElse((()=>S.of(null)))),(e=>(0,s.zG)(r,b.map((t=>t.getHoveredStateBehavior(e))),b.getOrElse((()=>S.of(ks.pc.none))))));this._intersectionObserver.observe(e.bodyNode),this._state.set(e.messageId,{message:e,disposables:[i,n.render(d,{}),{dispose:()=>this._intersectionObserver.unobserve(e.bodyNode)},...(0,s.zG)(t,b.map((e=>[e])),b.getOrElse((()=>[]))),...(0,s.zG)(l,b.map((e=>[{dispose:()=>e.unsubscribe()}])),b.getOrElse((()=>[])))]}),this._bodyNodeToMessageId.set(e.bodyNode,e.messageId);const c=(0,s.zG)(b.fromNullable(this._annotationIdsForMessageId.get(e.messageId)),b.getOrElse((()=>{const t=new Set;return this._annotationIdsForMessageId.set(e.messageId,t),t})));e.annotations.filter((e=>"main_point"===e.type)).forEach((t=>{const n=`${t.span.s}-${t.span.e}-${t.type}`,a=ks.y$.Id.create(e.messageId,n),s=fs.Id.create(e.messageId,n);this._logger.trace("Adding annotation highlight",a),this._currentAnnotations.set(s,t),c.add(s),i.addHighlight(a,{start:t.span.s,end:t.span.e},{highlightId:a,annotationId:s,highlightColor:Ss.hE.Preset.create(Ss.al.blue),highlightDisplayFormat:Ss.jk.background,highlightLiveliness:this._features.has("inlineCards")?Ss.iY.animated:Ss.iY.static})}))}})))}dispose(){this._subscriptions.unsubscribe();for(const{disposables:e}of this._state.values())e.forEach((e=>e.dispose()));this._currentAnnotations.clear(),this._state.clear(),this._annotationIdsForMessageId.clear(),this._intersectionObserver.disconnect()}}var po=n(85089),ho=n(89068),go=n(91224),fo=n(73572),bo=n(18347),vo=n(44586),ko=n(17733),yo=n(79582);function Io(e,t){return new vo.y((function(n){var i=e.length;if(0!==i)for(var a=new Array(i),s=0,o=0,r=function(r){var l=(0,Ea.D)(e[r]),d=!1;n.add(l.subscribe({next:function(e){d||(d=!0,o++),a[r]=e},error:function(e){return n.error(e)},complete:function(){++s!==i&&d||(o===i&&n.next(t?t.reduce((function(e,t,n){return e[t]=a[n],e}),{}):a),n.complete())}}))},l=0;l<i;l++)r(l);else n.complete()}))}var xo=n(16169),_o=n(44923),Eo=n(68477),wo=n(60655),Uo=n(58028),Co=n(66081),So=n(24713),No=n(38062),To=n(80900),Mo=n(38194),Ao=n(81407),Fo=n(78146),Go=n(44212),zo=n(86400);function Po(e){return e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function Lo(e){const t=e.match(/(?<name>.*?)\s*<(?<email>.*?)>/);if(null==t?void 0:t.groups){const e=t.groups.email,n=t.groups.name;return(0,s.zG)(Ia.G.create(e),Ua.Yo((()=>"No email address found")),Ua.UI((e=>({email:e,name:(0,s.zG)(n,Po,(e=>""===e?void 0:e))}))))}return(0,s.zG)(Ia.G.create(e.trim()),b.map((e=>({name:void 0,email:e}))),Ua.Yo((()=>`Malformed user [${e}]`)))}function Ko(e){const t=e.includes("<")&&e.includes(">");return(0,s.zG)(t?e.split(/>\s*,\s*/):e.split(/\s*,\s*/),(e=>e.length>1&&t?e.map((e=>e+">")):e),Ps.hX((e=>!e.match(/^undisclosed/))),Ps.UI(Lo),Ps.IX.sequence(Ua.wE))}function Ro(e){try{const t=e.split(/\n{2,}/)[0];return t?(0,s.zG)(function(e){const t=e.split(/\n+/),n=[];for(const e of t)if(/^\s+/.test(e))n.length>0&&(n[n.length-1].value+=e.trimStart());else{const t=e.match(/(.*?):\s*(.*)/);t&&t.length>=3&&n.push({header:String(t[1]).toLowerCase(),value:t[2]})}return n.reduce(((e,{header:t,value:n})=>({...e,[t]:n})),{})}(t),(e=>{var t,n,i,o;return a.Y(Ua.wE)({id:(0,s.zG)(null===(n=null===(t=e["message-id"])||void 0===t?void 0:t.match(/<(.*?)>/))||void 0===n?void 0:n[1],Ua.ij("No Message-ID header")),inReplyTo:Ua.F2(null===(o=null===(i=e["in-reply-to"])||void 0===i?void 0:i.match(/<(.*?)>/))||void 0===o?void 0:o[1]),date:(0,s.zG)(e.date,Ua.ij("No Date header"),Ua.UI((e=>new Date(e)))),from:(0,s.zG)(e.from,Ua.ij("No From header"),Ua.tS(Lo)),to:(0,s.zG)(e.to,Ua.ij("No To header"),Ua.tS(Ko)),cc:(0,s.zG)(e.cc,(e=>e?Ko(e):Ua.F2(void 0))),bcc:(0,s.zG)(e.bcc,(e=>e?Ko(e):Ua.F2(void 0))),subject:(0,s.zG)(e.subject,Ua.ij("No Subject header")),deliveredTo:(0,s.zG)(e["delivered-to"],Ua.F2),replyTo:(0,s.zG)(e["reply-to"],(e=>e?Ko(e):Ua.F2(void 0))),listUnsubscribe:(0,s.zG)(e["list-unsubscribe"],(e=>e?function(e){const t=(0,zo.rL)(e,/<([^<>]+)>/g,(e=>e[1]));return t.length?t:void 0}(e):void 0),Ua.F2),headers:Ua.F2(e)})})):Ua.t$("Expected headers")}catch(e){return Ua.t$(String(e))}}var Oo=n(30625);async function Bo(e,t,n){const i=await async function(e,t,n){var i,a,s,o;const r=(null===(a=null===(i=/^(?<url>.*?)\/?[#\?]/.exec(e))||void 0===i?void 0:i.groups)||void 0===a?void 0:a.url)||"https://mail.google.com/mail/u/0";try{const e=await fetch(`${r}/?ik=${encodeURIComponent(t)}&view=om&permmsgid=${encodeURIComponent(n)}`),i=await e.text(),a=null===(o=null===(s=/<pre[\s\S]*?id="raw_message_text"[\s\S]*?>(?<orig_msg>[\s\S]*?)<\/pre>/m.exec(i))||void 0===s?void 0:s.groups)||void 0===o?void 0:o.orig_msg;return a?Ua.ij({message:"Could not decode message"})((0,Oo.l_)(a.trim())):Ua.t$({message:"Could not extract message from response",mimeMessageNotFound:!0})}catch(e){return Ua.t$({message:String(e)})}}(n,t,e);return(0,s.zG)(i,Ua.tS((e=>(0,s.zG)(Ro(e),Ua.Vn((e=>({message:e})))))))}function Do(e){return!!e.messageNode&&!!e.id&&void 0!==e.index}class Vo{constructor(e,t,n,i,o=Xa.Y.create("Reader-Gmail-Thread-Context")){this._doc=e,this._messageList=t,this._telemetry=i,this._logger=o,this._subscriptions=new _a.w,this._state=u.h.create((0,s.zG)(function(e){const t=Ua.ij(new Ma.DH("Cannot find thread subject container"))(e.querySelector(fo.Av)||e.querySelector(fo.cE));return{threadId:(0,s.zG)(t,Ua.tS((e=>Ua.ij(new Ma.DH("Cannot find thread ID"))(e.getAttribute("data-thread-perm-id"))))),subject:(0,s.zG)(t,Ua.tS((e=>Ua.ij(new Ma.DH("Cannot find thread Subject"))(e.textContent)))),loggedUser:(0,s.zG)(Ua.ij(new Ma.DH("Cannot extract user from avatar"))(Wa.x.getAuthor()),Ua.tS((t=>(0,s.zG)(Ia.G.create(t.email),b.map((n=>({name:t.name?t.name:void 0,email:n,avatarUrl:(0,s.zG)(b.fromNullable(e.querySelector(fo.Dy)),b.chain(Zo),b.toUndefined)}))),Ua.Yo((()=>new Ma.DH("No email address found in avatar")))))))}}(this._doc),(e=>({threadId:e.threadId,subject:e.subject,loggedUser:e.loggedUser,avatars:(0,s.zG)(e.loggedUser,Ua.g_((()=>new Map),(e=>new Map([[e.email,e]])))),messageCount:Jo(this._messageList).length,expandedMessages:new Map,messageIndexToIdMap:new Map,messageNodeToIdMap:new Map})))),this.threadContext=this._state.view(),(0,s.zG)(this._state.get(),(e=>a.Y(Ua.wE)({threadId:e.threadId,subject:e.subject,loggedUser:e.loggedUser})),Ua.Vn((e=>{this._telemetry.readerGmail.warning("threadInfoExtraction",e.message),this._logger.warn("Static thread info extraction error",e)})));const l=Qa.x.create(this._messageList,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["aria-expanded","tabindex"]}).pipe(Co.e(50),re.O(null),es.shareReplay({bufferSize:1,refCount:!0}));this._subscriptions.add(l.pipe(pt.w((()=>{return e=this._doc,t=this._state.get().avatars,Ea.D(e.querySelectorAll(fo.Q$)||e.querySelectorAll(fo.sK)).pipe(O.h((e=>e instanceof HTMLImageElement)),E.U((e=>(0,s.zG)(Ia.G.create(e.getAttribute(fo.zv)||void 0),b.map((t=>({email:t,name:e.getAttribute(fo.AE)||void 0,img:e})))))),rs.zg(b.fold((()=>ts.E),(({email:e,name:t,img:n})=>{return(i=n,S.of(Zo(i)).pipe(pt.w(b.fold((()=>No.S3(Ze.R(i,"onload"),To.H(1e3)).pipe(E.U((()=>Zo(i))))),(e=>S.of(b.some(e))))))).pipe(E.U(b.map((n=>({email:e,name:t,avatarUrl:n})))));var i}))),C.oA,ls.R(((e,t)=>new Map(e).set(t.email,t)),new Map(t)));var e,t})),xe.b((e=>{this._state.modify((t=>({...t,avatars:e})))}))).subscribe());const d=l.pipe(E.U((e=>{const t=Jo(this._messageList);return{nodes:t,expandedCount:t.filter(Xo).length}})),ut.x(((e,t)=>e.nodes.length===t.nodes.length&&e.expandedCount===t.expandedCount)),So.j("nodes"));this._subscriptions.add(d.pipe(xe.b((e=>{this._state.modify((t=>({...t,messageCount:e.length})))})),(0,s.ls)(E.U((e=>{const t=e.map(((e,t)=>({messageNode:e,index:t}))),n=t.filter((({messageNode:e})=>Xo(e))).map((({messageNode:e,index:t})=>{var n,i;return{id:null===(i=null===(n=e.querySelector(fo.k2))||void 0===n?void 0:n.getAttribute(fo.bq))||void 0===i?void 0:i.slice(1),messageNode:e,index:t}})).filter(Do).reduce(((e,t)=>e.set(t.id,[t.messageNode,t.index])),new Map);return{allNodes:t.reduce(((e,t)=>e.set(t.messageNode,[t.messageNode,t.index])),new Map),expandedNodes:n}})),re.O({allNodes:new Map,expandedNodes:new Map}),as.G(),E.U((([e,t])=>{const n=new Set(e.expandedNodes.keys()),i=new Set(t.expandedNodes.keys()),a=Array.from(bo.e5(cs.yv)(n)(i)),s=new Set(e.allNodes.keys()),o=new Set(t.allNodes.keys()),r=Array.from(bo.e5(cs.w4)(o)(s));return{expanded:a.map((e=>{const n=t.expandedNodes.get(e);return{id:e,messageNode:null==n?void 0:n[0],index:null==n?void 0:n[1]}})).filter(Do),removed:r.reduce(((e,t)=>(e.add(t),e)),new Set),all:t.allNodes}})),O.h((e=>e.expanded.length>0||e.removed.size>0))),xe.b((e=>{const{expanded:t,removed:n,all:i}=e;t.length&&(this._logger.debug(`New message(s) expanded [${t.map((e=>e.id)).join(", ")}]`),this._state.modify((e=>{const n=(0,s.zG)(e.expandedMessages,r.UI(m.UI((e=>{var t,n;return{...e,index:null!==(n=null===(t=i.get(e.messageNode))||void 0===t?void 0:t[1])&&void 0!==n?n:e.index}})))),a=t.reduce(((e,t)=>(e.set(t.id,m.x5),e)),new Map(n)),o=t.reduce(((e,t)=>(e.set(t.messageNode,t.id),e)),new Map(e.messageNodeToIdMap)),l=Array.from(i.values()).reduce(((e,[t,n])=>(o.has(t)&&e.set(n,o.get(t)),e)),new Map);return{...e,expandedMessages:a,messageIndexToIdMap:l,messageNodeToIdMap:o}}))),n.size&&(this._logger.debug(`Message(s) removed [${Array.from(n.values()).join(", ")}]`),this._state.modify((e=>{const t=(0,s.zG)(e.expandedMessages,r.UI(m.UI((e=>{var t,n;return{...e,index:null!==(n=null===(t=i.get(e.messageNode))||void 0===t?void 0:t[1])&&void 0!==n?n:e.index}}))),r.hX((e=>!(m.d6(e)&&n.has(e.value.messageNode))))),a=Array.from(n.values()).reduce(((e,t)=>(e.delete(t),e)),new Map(e.messageNodeToIdMap)),o=Array.from(i.values()).reduce(((e,[t,n])=>a.has(t)?e.set(n,a.get(t)):e),new Map);return{...e,expandedMessages:t,messageIndexToIdMap:o,messageNodeToIdMap:a}})))})),So.j("expanded"),O.h((e=>e.length>0)),rs.zg(n),xe.b((({message:{id:e,messageNode:t,index:n},context:i})=>{this._state.modify((a=>({...a,expandedMessages:new Map(a.expandedMessages).set(e,(0,s.zG)(i,Ua.g_((t=>{const n=`Could not extract context for #${e}: ${String(t)}`;return this._logger.warn(n),m.kH(new Ma.DH(n))}),(i=>(0,s.zG)(b.fromNullable(t.querySelector(fo.xR)),b.filter(Ya.Re),b.fold((()=>{const n=`Could not find message body for #${e}`;return this._logger.warn(n,t),m.kH(new Ma.DH(n))}),(a=>{this._logger.trace(`Message #${e} extracted`),this._logger.trace(`Got ${i.links.length} links`);const s=jo(a);return m.Vp({id:e,index:n,messageNode:t,bodyNode:a,context:i,textMap:s,semanticInformation:{...i.semanticInformation,tableTextCoverage:Ho(s,a)}})})))))))})))}))).subscribe())}dispose(){this._subscriptions.unsubscribe()}}function Ho(e,t){const n=[];t.querySelectorAll("table").forEach((e=>{0!==n.length&&n[n.length-1].contains(e)||n.push(e)}));const i=e.getPlainText().replace(/\s+/g,""),a=n.map((e=>e.innerText.replace(/\s+/g,"")));let s=i;for(const e of a)s=s.replace(e,"");return Math.max(0,Math.min(1,(i.length-s.length)/i.length))}function Zo(e){return(0,s.zG)(b.fromNullable(e.getAttribute("src")),b.filter((e=>!e.includes("no_photo")&&!e.includes("profile_mask"))))}function jo(e){return new xo.Z(e,((e,t)=>xo.Z.defaultFilterNodeAllowList(["PRE","CODE","BLOCKQUOTE"])(e,t)&&!_o.W.maybeGmailHistoryQuote(e)),void 0,xo.Z.isBlockNodeFromTagList((0,s.zG)(new Set(xo.Z.blockTags),bo.Od(cs.yv)("CODE"))),void 0,void 0,_o.W.gmailNodeFormatting,void 0,void 0,!1)}function qo(e){return a.Y(Ua.wE)({email:(0,s.zG)(Ua.ij(new Ma.DH("No email found"))(null==e?void 0:e.getAttribute("email")),Ua.tS((e=>Ua.Yo((()=>new Ma.DH("Invalid email address")))(Ia.G.create(e))))),name:(0,s.zG)(Ua.ij(new Ma.DH("No name found"))(null==e?void 0:e.getAttribute("name")),Ua.UI((e=>e||void 0)))})}function $o(e,t,n=6e3){return i=>ns.T(...e.map((e=>{return i.pipe(O.h((t=>t.message.id===e.id)),(a=n,e=>{const t=e.pipe(Mo.B()),[n,i]=Ao.u(t,((e,t)=>0===t));return ns.T(n.pipe(ho.V(a),bt.q(1)),i)}),go.K((n=>S.of({message:e,context:Ua.t$(new Ma.DH(t+((0,Eo.H)(n)?` [${n.message}]`:"")))}))));var a})))}function Wo(e,t,n,i,o,r=5){return l=>{const{left:d,right:c}=(0,s.zG)(l,Ps.uK(i));return ns.T((0,s.zG)(d,Qo(e),$o(d,"DOM-only extraction timeout")),ns.T((0,s.zG)(c,Qo(e),$o(c,"DOM extraction timeout"),E.U((e=>({...e,kind:"fromDOM"})))),(0,s.zG)(c,function(e,t,n,i=5){const a=new ye.xQ,o=new Map;return r=>ns.T(S.of(r),a).pipe(pt.w((e=>Ea.D(e.reduce(((e,t)=>(e.length>0&&e[e.length-1].length<i?e[e.length-1].push(t):e.push([t]),e)),[])))),Ie.M(e),os.b((([e,n])=>function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if((0,ko.k)(n))return Io(n,null);if((0,yo.K)(n)&&Object.getPrototypeOf(n)===Object.prototype){var i=Object.keys(n);return Io(i.map((function(e){return n[e]})),i)}}if("function"==typeof e[e.length-1]){var a=e.pop();return Io(e=1===e.length&&(0,ko.k)(e[0])?e[0]:e,null).pipe((0,E.U)((function(e){return a.apply(void 0,e)})))}return Io(e,null)}(e.map((e=>Ea.D(Bo(e.id,n,t())).pipe(E.U((t=>({message:e,headers:t}))))))))),os.b((e=>e)),pt.w((({message:e,headers:t})=>(0,s.zG)(t,Ua.g_((t=>{n.warn(`Error accessing MIME headers for #${e.id}:`,t.message);const i=o.get(e.id)||0,s=1;return t.mimeMessageNotFound&&i<s?(n.warn(`Retrying to fetch MIME headers for #${e.id}`),o.set(e.id,i+1),a.next([e]),ts.E):S.of({message:e,context:Ua.t$(new Ma.DH(t.message))})}),(t=>S.of({message:e,context:Ua.F2({date:{kind:"parsedDate",timestamp:t.date.getTime()},author:t.from,audience:t.to.concat(t.cc||[]).concat(t.bcc||[]),replyTo:t.replyTo||[],links:[],isFromMailingList:!!t.listUnsubscribe,semanticInformation:{isWholeHTMLDocument:/^text\/html\b/.test(t.headers["content-type"])}})})))))))}(t,n,o,r),$o(c,"MIME headers extraction timeout"),E.U((e=>({...e,kind:"fromHeaders"}))))).pipe(Fo.v((e=>e.message.id)),rs.zg((e=>e.pipe(xe.b((e=>(0,s.zG)(e.context,Ua.Vn((t=>o.warn(`Context extraction error [${e.kind}] for ${e.message.id}`,t)))))),ls.R(((e,t)=>({...e,message:t.message,[t.kind]:t.context})),{}),O.h((e=>!!(null==e?void 0:e.message)&&!!(null==e?void 0:e.fromDOM)&&!!(null==e?void 0:e.fromHeaders))),E.U((e=>(0,s.zG)(a.Y(Ua.wE)({fromDOM:e.fromDOM,fromHeaders:e.fromHeaders}),Ua.UI((({fromDOM:e,fromHeaders:t})=>(0,Uo.RH)(e,t))),Ua.wp((()=>e.fromDOM)),Ua.wp((()=>e.fromHeaders)),(t=>({message:e.message,context:t})))))))))).pipe(xe.b((e=>(0,s.zG)(e.context,Ua.g_((t=>o.warn(`Context extraction error for ${e.message.id}`,t)),(t=>o.info(`Context extracted for ${e.message.id}`,t)))))))}}function Qo(e){return t=>S.of(t).pipe(Go.u(),rs.zg((t=>{var n;const i=(0,s.zG)(Ua.ij(new Ma.DH("No message date found"))(null===(n=t.messageNode.querySelector(fo.ms))||void 0===n?void 0:n.getAttribute("title")),Ua.UI((t=>(0,s.zG)(new Date(t),(n=>{var i;return Number.isNaN(n.valueOf())?{kind:"unparsedDate",date:t,locale:(null===(i=e.querySelector(fo.Gg))||void 0===i?void 0:i.getAttribute(fo.sC))||void 0}:{kind:"parsedDate",timestamp:n.getTime()}}))))),a=(0,s.zG)(Ua.ij(new Ma.DH("No message author found"))(t.messageNode.querySelector(fo.OL)),Ua.tS(qo)),o=(0,s.zG)(Ua.ij(new Ma.DH("No <to> field found in message"))(t.messageNode.querySelectorAll(fo.VN)),Ua.tS((e=>(0,s.zG)(Array.from(e),Ps.UI(qo),Ps.IX.sequence(Ua.wE))))),r=(0,s.zG)(t.messageNode.querySelector(fo.hZ),(e=>Ua.F2(!!e)));return te.aj([S.of({message:t,date:i,author:a,audience:o,isFromMailingList:r}),(l=t.messageNode,te.aj([S.of(er(l)),(0,s.zG)(Array.from(l.querySelectorAll(fo.Mz)).map(ir),(e=>e.length>0?te.aj(e):S.of([])))]).pipe(E.U((([e,t])=>Array.from(e.concat(t).reduce(((e,t)=>e.set(t.url,t)),new Map).values())))))]);var l})),E.U((([{message:e,date:t,author:n,audience:i,isFromMailingList:s},o])=>({message:e,context:a.Y(Ua.wE)({date:t,author:n,audience:i,replyTo:Ua.F2([]),links:Ua.F2(o),isFromMailingList:s})}))))}function Jo(e){return Array.from(e.children).filter(Yo)}function Yo(e){return e instanceof HTMLDivElement&&(e.matches("[aria-expanded]")&&!!e.innerText||!e.matches("[aria-expanded]"))}function Xo(e){return e instanceof HTMLDivElement&&e.matches('[tabindex="-1"]')&&!!e.innerText}function er(e){return(0,s.zG)(Array.from(e.querySelectorAll(fo.rf)),Ps.DZ((0,s.ls)(b.fromPredicate((e=>!e.closest(fo.A4)&&!e.matches(fo.wJ))),b.chain((e=>(0,s.zG)(xa.A.create(e.getAttribute("href")),b.map((t=>({url:t,name:e.innerText,type:t.startsWith("mailto:")?ya.Q.email:ya.Q.hyperlink})))))))))}function tr(e){return(0,s.zG)(b.fromNullable(e),b.chain((e=>b.fromNullable(/^([^:]+):([^:]+):(https?:\/\/.+)?(https?:\/\/.+)$/.exec(e)))),b.chain((([e,t,n,i,a])=>(0,s.zG)(xa.A.create(a),b.map((e=>({name:decodeURIComponent(n),url:e,type:ya.Q.attachment,mimeType:b.toUndefined(wo.I.create(t))})))))))}function nr(e){return(0,s.zG)(xa.A.create(e.getAttribute("href")),b.map((t=>{var n;return{name:e.getAttribute("data-tooltip")||(null===(n=e.querySelector("div"))||void 0===n?void 0:n.innerText)||e.innerText,url:t,type:ya.Q.attachment,mimeType:void 0}})))}function ir(e,t=4e3){return(0,s.zG)(e.getAttribute("href")||"",b.fromPredicate((e=>!/^https?:\/\/docs\.google\.[^./]+\//.test(e))),b.map((n=>new vo.y((t=>{var n;(0,s.zG)(b.fromNullable(null===(n=e.parentElement)||void 0===n?void 0:n.getAttribute("download_url")),b.filter((e=>!!e)),b.fold((()=>t.error("Attachment not found")),(()=>{t.next(!0),t.complete()})))})).pipe((0,Oo.WV)(t/200,200),ho.V(t),go.K((()=>S.of(!1))),E.U((t=>{var n;return(0,s.zG)(b.fromNullable(null===(n=e.parentElement)||void 0===n?void 0:n.getAttribute("download_url")),b.chain(tr),b.alt((()=>nr(e))))}))))),b.getOrElse((()=>S.of(nr(e)))),C.oA)}function ar(e){const t=null===e.querySelector(fo.Py);return Array.from(e.querySelectorAll(t?fo.KL:fo.Py)).filter(Xo).length}var sr;function or(e){const t=e.querySelector(fo.bK)||e.querySelector(fo.Gc),n=t?Jo(t).length:0;if(!t||0===n)return S.of(Ua.t$("No messages"));if(ar(e)===n)return S.of(Ua.F2(sr.noExpansionNeeded));const i=e.querySelector(fo.p4)||e.querySelector(fo.Vz);return null==i||i.click(),(0,s.zG)((a=t,po.rl(a,{subtree:!0,childList:!1,attributes:!0,attributeFilter:["role","aria-expanded"]}).pipe(re.O(null))),ss.b(10),O.h((()=>ar(e)===n)),ho.V(3e3),bt.q(1),is.h(Ua.F2(sr.expanded)),go.K((e=>S.of(Ua.t$(e.message)))));var a}!function(e){e.expanded="expanded",e.noExpansionNeeded="noExpansionNeeded"}(sr||(sr={}));var rr=n(35214),lr=n(32426),dr=n(45701),cr=rr.getFunctionMonoid(b.getApplyMonoid({concat:(0,lr.getJoinSemigroup)(dr.ordNumber).concat,empty:0}))();function mr(e){return function(t){return t.iterNumber>=e?b.none:b.some(0)}}function ur(e){return function(t){return b.some(e*Math.pow(2,t.iterNumber))}}var pr={iterNumber:0,cumulativeDelay:0,previousDelay:b.none};var hr=cr,gr=n(2788);class fr{constructor(e){this._rpc=e,this.getReaderAnnotations=this._rpc.getReaderAnnotations,this.getReaderSummaries=this._rpc.getReaderSummaries,this.sendReaderEvents=this._rpc.sendReaderEvents,this.sendReaderSurvey=this._rpc.sendReaderSurvey}}var br=n(99596),vr=n(99950),kr=n(62965);function yr(e,t,n){var i=rr.fold(hr)(t);return vo.y.create((function(t){var a=!1,s=function(o){return(0,Gs.pipe)(kr.dk((function(){return t.next(m.x5)})),kr.a1(e),kr.g_((function(e){var r=!a&&n(e)?function(e,t){var n=e(t);return{iterNumber:t.iterNumber+1,cumulativeDelay:t.cumulativeDelay+b.getOrElse((function(){return 0}))(n),previousDelay:n}}(i,o):pr;return(0,Gs.pipe)(r.previousDelay,b.fold((function(){return kr.t$(e)}),(function(n){return t.next(m.vU(e,{cumulativeDelay:r.cumulativeDelay,iterNumber:r.iterNumber,previousDelay:n})),(0,Gs.pipe)(kr.F2(r),vr.delay(n),kr.tS((function(t){return a?kr.t$(e):s(t)})))})))}),kr.F2))};return(0,Gs.pipe)(s(pr),kr.Pd((function(e){return t.next(m.kH(e))}),(function(e){return t.next(m.Vp(e))})))().then((function(){return t.complete()}),(function(e){return t.error(e)})),function(){return a=!0}}))}var Ir=n(17160);class xr{constructor(e,t,n,i,a=d.O,s,o=Xa.Y.create("Reader-Gmail-Feedback-Manager")){this._actions=e,this._threadContext=t,this._sessionUuid=n,this._featuresAndExperiments=i,this._getEnv=a,this._telemetry=s,this._logger=o,this._subscriptions=new _a.w,this._rpcClient=(0,Ja.Vo)((()=>new fr(this._getEnv().bgRpc.api))),this._subscriptions.add(this._handleUIEvents()),this._subscriptions.add(this._handleSubmitFeedbackEvents())}_handleSubmitFeedbackEvents(){return this._actions.pipe(R.ofType(K.Kind.submitFeedback),O.h((()=>this._featuresAndExperiments.features.has("submitFeedbackDialog"))),rs.zg((0,s.ls)(K.matchSubmitFeedback({itemMenu:Er,collapsedPanelButton:wr,expandedPanelHeaderButton:wr,emptyViewButton:wr}),(e=>a.Y(Ua.wE)({threadId:this._threadContext.get().threadId,reader:(0,s.zG)(this._threadContext.get().loggedUser,Ua.UI(gr.R)),feedback:Ua.F2(e)})),Ua.UI((({threadId:e,reader:t,feedback:n})=>({threadId:e,features:Array.from(this._featuresAndExperiments.features),readerExperiment:this._featuresAndExperiments.experimentNames[0],sessionUuid:this._sessionUuid,reader:t,feedback:n}))),Ua.g_((e=>S.of(m.kH(e))),(e=>yr((()=>this._rpcClient.get().sendReaderSurvey(e)),[mr(3),ur(5e3)],(e=>e instanceof br.Lu||e instanceof br.Bb&&e.code>=500))))))).subscribe(m.g_({onInProgress:s.Q1,onSuccess:s.Q1,onError:s.Q1,onFatal:e=>{this._logger.warn("Survey error",e),this._telemetry.readerGmail.warning("feedback","Survey error",e)}}))}_handleUIEvents(){return this._actions.pipe(O.h((0,f.Kg)(K.is(K.Kind.copy),K.is(K.Kind.pin),K.is(K.Kind.dismiss),K.is(K.Kind.like),K.is(K.Kind.dislike),K.is(K.Kind.itemMounted),K.is(K.Kind.check))),O.h((()=>this._featuresAndExperiments.features.has("feedbackEvents"))),E.U((e=>({type:e.kind===K.Kind.itemMounted?"show":e.kind!==K.Kind.pin||e.pinned?e.kind!==K.Kind.check||e.checked?e.kind:"uncheck":"unpin",emailText:(e.kind,void K.Kind.itemMounted),subject:e.kind===K.Kind.check?"followUpItem":e.itemType,...e.kind===K.Kind.check?{id:e.item.itemId,itemText:e.item.text}:_r(e),messageId:e.item.message.id}))),Ir.e(100),O.h((e=>e.length>0)),rs.zg((e=>(0,s.zG)(a.Y(Ua.wE)({threadId:this._threadContext.get().threadId,reader:(0,s.zG)(this._threadContext.get().loggedUser,Ua.UI(gr.R))}),Ua.UI((({threadId:t,reader:n})=>({threadId:t,features:Array.from(this._featuresAndExperiments.features),readerExperiment:this._featuresAndExperiments.experimentNames[0],sessionUuid:this._sessionUuid,reader:n,events:e}))),Ua.g_((e=>S.of(m.kH(e))),(e=>yr((()=>this._rpcClient.get().sendReaderEvents(e)),[mr(3),ur(5e3)],(e=>e instanceof br.Lu||e instanceof br.Bb&&e.code>=500)))))))).subscribe(m.g_({onInProgress:s.Q1,onSuccess:s.Q1,onError:s.Q1,onFatal:e=>{this._logger.warn("Feedback error",e),this._telemetry.readerGmail.warning("feedback","Feedback error",e)}}))}dispose(){this._subscriptions.unsubscribe()}}function _r(e){return{id:"summaryItem"===e.itemType||"followUpItem"===e.itemType?e.item.itemId:"linkItem"===e.itemType?e.item.url:"mentionItem"===e.itemType?e.item.email:(0,B.vE)(e),itemText:"summaryItem"===e.itemType||"followUpItem"===e.itemType?e.item.text:"linkItem"===e.itemType?e.item.name||e.item.url:"mentionItem"===e.itemType?e.item.name||e.item.email:(0,B.vE)(e)}}function Er(e){return{type:"tellUsMoreFeedback",feedbackText:e.text,messageId:e.source.item.message.id,subject:e.source.itemType,action:e.source.action,..._r(e.source)}}function wr(e){return{type:"genericFeedback",placement:e.source.kind,feedbackText:e.text,score:(0,s.zG)(e.scoreResult,b.map((e=>e.score)),b.toUndefined),scoreLabel:(0,s.zG)(e.scoreResult,b.map((e=>e.label)),b.toUndefined)}}var Ur=n(41263),Cr=n(86620),Sr=n(92132),Nr=n(33678),Tr=n(15073),Mr=n(42103),Ar=n(64078);const Fr=({env:e,children:t,className:n})=>g.createElement(co.o,{className:n},g.createElement(oo.p,null,g.createElement(Nr.a.Context.Provider,{value:new Cr.C(e)},g.createElement(Sr.Q,{remSize:S.of(16),setter:e=>Tr.u.setRootCssVar(document.documentElement,e)},g.createElement(Mr.G.DefaultProvider,null,t,g.createElement(lo.p,{regular:!0,bold:!0}),g.createElement(ro.G,null),g.createElement(Ar.X,null))))));var Gr=n(16782);const zr=`${fo.k2} > div + div`;class Pr{constructor(e,t,n=Xa.Y.create("Reader-Gmail-Panel")){this._logger=n,this._mounted=new Gr.t(1),this.elementRef=g.createRef(),this.mounted=this._mounted.asObservable(),this._injectionSub=e.pipe(pt.w((e=>new vo.y((()=>(0,s.zG)(b.fromNullable(e.querySelector(zr)),b.filter((e=>e instanceof HTMLElement)),b.fold((()=>s.Q1),(e=>{const n=Hs.VB.get({monitorAs:"reader-panel"}).inject(Zs.EM.fromDocument(e.ownerDocument,"grammarly-extension"),Zs.zs.appendChild(e),(()=>g.createElement(Ur.L,{chunkName:"readerGmailThreadIntegration"},g.createElement(Fr,{env:(0,d.O)()},g.createElement("div",{style:{marginTop:"2rem"},ref:this.elementRef},g.createElement(t,null))))));return this._mounted.next(),this._logger.debug("Panel injected"),()=>{n.dispose(),this._logger.debug("Panel disposed")}})))))))).subscribe()}dispose(){this._injectionSub.unsubscribe()}}var Lr=n(77150);class Kr{constructor(e,t,n=d.O,i,a=Xa.Y.create("Reader-Gmail-Remote-Data")){this._threadContext=e,this._useCaching=t,this._getEnv=n,this._telemetry=i,this._logger=a,this._subscriptions=new _a.w,this._rpcClient=(0,Ja.Vo)((()=>new fr(this._getEnv().bgRpc.api))),this._summariesToFetch=new ye.xQ,this._annotationsToFetch=new ye.xQ,this._summariesReadyToFetch=new ye.xQ,this._annotationsReadyToFetch=new ye.xQ,this._summaries=u.h.create(new Map),this._annotations=u.h.create(new Map),this.summaries=this._summaries.view(),this.annotations=this._annotations.view(),this._subscriptions.add(this._summariesToFetch.pipe(Rr(this._threadContext)).subscribe((e=>this._summariesReadyToFetch.next(e)))),this._subscriptions.add(this._annotationsToFetch.pipe(Rr(this._threadContext)).subscribe((e=>this._annotationsReadyToFetch.next(e)))),this._subscriptions.add(this._summariesReadyToFetch.pipe(rs.zg((e=>this._getSummaries(e).pipe(E.U((t=>({requestedIds:e,response:t}))))))).subscribe((({requestedIds:e,response:t})=>{this._summaries.modify((n=>Array.from(e).reduce(((e,i)=>e.set(i,(0,s.zG)(m.n2(t)?(0,s.zG)(b.fromNullable(n.get(i)),b.getOrElse((()=>m.x5))):t,m.UI((e=>b.fromNullable(e[i])))))),new Map(n))))}))),this._subscriptions.add(this._annotationsReadyToFetch.pipe(rs.zg((e=>this._getAnnotations(e).pipe(E.U((t=>({requestedIds:e,response:t}))))))).subscribe((({requestedIds:e,response:t})=>{this._annotations.modify((n=>Array.from(e).reduce(((e,i)=>e.set(i,(0,s.zG)(m.n2(t)?(0,s.zG)(b.fromNullable(n.get(i)),b.getOrElse((()=>m.x5))):t,m.UI((e=>b.fromNullable(e[i])))))),new Map(n))))})))}fetchSummaries(e){this._logger.debug(`requesting summaries for [${String(Array.from(e))}]`),this._summariesToFetch.next(e)}fetchAnnotations(e){this._logger.debug(`requesting annotations for [${String(Array.from(e))}]`),this._annotationsToFetch.next(e)}dispose(){this._subscriptions.unsubscribe()}_getThreadInfoForBackend(){return(0,s.zG)(this._threadContext.get(),(e=>a.Y(Ua.wE)({id:e.threadId,subject:e.subject,messageCount:Ua.F2(e.messageCount),messages:Ua.F2(Array.from(e.expandedMessages.values()).filter(m.d6).map((e=>e.value))),loggedUser:e.loggedUser})),Ua.UI((e=>({...e,messages:e.messages.reduce(((t,n)=>(t[n.id]={id:n.id,index:n.index,subject:e.subject,body:n.textMap.getRichText(),plainText:n.textMap.getPlainText(),date:n.context.date,author:n.context.author,audience:n.context.audience,replyTo:n.context.replyTo,semanticInformation:n.semanticInformation,links:n.context.links,isFromMailingList:n.context.isFromMailingList},t)),{})}))))}_getSummaries(e){return(0,s.zG)(this._getThreadInfoForBackend(),Ua.g_((e=>S.of(m.kH(e))),(t=>yr((()=>(this._logger.debug(`Fetching summaries for [${String(Array.from(e))}]`),this._rpcClient.get().getReaderSummaries({thread:{id:t.id,subject:t.subject,messages:(0,s.zG)(t.messages,l.u4({},((e,t)=>(e[t.index]=(0,ka.fH)(t),e)))),num_messages:t.messageCount},reader:(0,gr.R)(t.loggedUser),requestedMessageIds:Array.from(e),useCache:this._useCaching.get()}).then((e=>((0,s.zG)(e,Ua.Pd((e=>{this._telemetry.readerGmail.warning("summariesResponse",e.message,e),this._logger.warn("Summaries error",e.message)}),(e=>{this._logger.debug("Received summaries",e)}))),e))))),[mr(3),ur(5e3)],(e=>e instanceof br.Lu||e instanceof br.Bb&&e.code>=500)))))}_getAnnotations(e){return(0,s.zG)(this._getThreadInfoForBackend(),Ua.g_((e=>S.of(m.kH(e))),(t=>yr((()=>(this._logger.debug(`Fetching annotations for [${String(Array.from(e))}]`),this._rpcClient.get().getReaderAnnotations({thread:{id:t.id,subject:t.subject,messages:(0,s.zG)(t.messages,l.u4({},((e,t)=>(e[t.index]=(0,ka.fH)(t),e)))),num_messages:t.messageCount},reader:(0,gr.R)(t.loggedUser),requestedMessageIds:Array.from(e),useCache:this._useCaching.get()}).then((e=>((0,s.zG)(e,Ua.Pd((e=>{this._telemetry.readerGmail.warning("annotationsResponse",e.message,e),this._logger.warn("Annotations error",e.message)}),(e=>{this._logger.debug("Received annotations",e)}))),e))).then(Ua.UI((0,s.ls)(l.Su(((e,n)=>{var i;const a=null===(i=t.messages[e])||void 0===i?void 0:i.plainText;return{...n,annotations:void 0!==a?n.annotations.map((e=>({...e,text:a.slice(e.span.s,e.span.e)}))):[]}}))))))),[mr(3),ur(5e3)],(e=>e instanceof br.Lu||e instanceof br.Bb&&e.code>=500)))))}}function Rr(e){return t=>{const n=new ye.xQ;return(0,s.zG)(t,os.b((e=>Ea.D(Array.from(e)))),rs.zg((t=>e.pipe(E.U((e=>(0,s.zG)(b.fromNullable(e.expandedMessages.get(t)),b.fold(s.jv,m.d6)))),O.h(Ja.fQ),bt.q(1),is.h(t)))),xe.b((()=>n.next())),Lr.R((()=>n.pipe(ss.b(200)))),E.U((e=>new Set(e))),O.h((e=>e.size>0)))}}function Or(e,t,n,m,p,g,v,y,I,_=d.O,w=Xa.Y.create("Reader-Gmail-Thread-Integration")){const N=Ja.iy.create(),T=new Vo(p.doc,e,Wo(p.doc,t,(()=>p.url),(e=>0===e.index),w),I),M=new Kr(T.threadContext,m,_,I),F=u.h.create(null),G=g.view((({inlineHighlightsEnabled:t})=>{F.modify((i=>(null==i||i.dispose(),t&&(n.features.has("inlineCards")||n.features.has("inlineHighlights"))?new uo(te.aj([M.annotations,g.view((e=>(0,s.zG)(T.threadContext.get().threadId,b.fromEither,b.chain((t=>{var n,i;return(0,s.zG)(b.fromNullable(null===(i=null===(n=e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.annotations),b.map((0,s.ls)(l.UI((0,s.ls)((e=>h.X.decode(e)),b.fromEither)),l.oA,l.u4(new Set,((e,t)=>t.dismissed?e.add(t.itemId):e)))))})),b.getOrElse((()=>new Set)))))]).pipe(Ie.M(T.threadContext),E.U((([[e,t],n])=>(0,s.zG)(e,r.Su(((e,i)=>(0,s.zG)(a.Y(b.option)({annotations:(0,s.zG)(i,Oo.zk,b.flatten,b.map(X.ei("annotations")),b.map(o.hX((e=>!t.has(h.p.Id.create(e.id))))),b.chain(et.nI)),message:(0,s.zG)(b.fromNullable(n.expandedMessages.get(e)),b.chain(Oo.zk))}),b.map((({annotations:e,message:t})=>({messageId:t.id,textMap:t.textMap,bodyNode:t.bodyNode,annotations:e})))))),r.DZ(s.yR))))),e,n.features):null)))})).subscribe(),z=new ye.xQ,P=(L=n.features).has("summaries")||L.has("needsResponse")||L.has("peopleAndLinks")||L.has("mentions")||L.has("links")?new Oa(i.create(T.threadContext,M.summaries,M.annotations),p.config.bundleInfo.browser,y,N,n.features,g):null;var L;const R=P?function(e,t,n,i,a){const o=new _a.w,r=e=>(0,s.zG)(n.get().threadId,b.fromEither,Et.bw(e));return o.add(e.pipe(O.h((0,f.Kg)(K.is(K.Kind.optIn),K.is(K.Kind.optOut)))).subscribe((({kind:e})=>{t.seenReaderGmailOnboarding(e).catch(a("CSActions.seenReaderGmailOnboarding"))}))),o.add(e.pipe(O.h(K.is(K.Kind.threadViewNavigate))).subscribe((({action:e,nextIndex:t})=>i.next({nextActiveIndex:t,navigationAction:e})))),o.add(e.pipe(O.h((0,f.Kg)(K.is(K.Kind.check),(0,f.W9)((0,f.Kg)(K.is(K.Kind.pin),K.is(K.Kind.dismiss),K.is(K.Kind.like),K.is(K.Kind.dislike)),K.itemTypeIs("followUpItem")))),E.U((e=>e.kind===K.Kind.check?{...e.item,checked:e.checked}:Br(e)))).subscribe((e=>r((n=>{t.readerGmailUpdateAnnotationItem({threadId:n,item:e}).catch(a("CSActions.readerGmailUpdateAnnotationItem"))}))))),o.add(e.pipe(O.h((0,f.W9)((0,f.Kg)(K.is(K.Kind.pin),K.is(K.Kind.dismiss),K.is(K.Kind.like),K.is(K.Kind.dislike)),K.itemTypeIs("summaryItem"))),E.U(Br)).subscribe((e=>r((n=>{t.readerGmailUpdateSummaryItem({threadId:n,item:e}).catch(a("CSActions.readerGmailUpdateSummaryItem"))}))))),o.add(e.pipe(O.h((0,f.W9)((0,f.Kg)(K.is(K.Kind.pin),K.is(K.Kind.dismiss),K.is(K.Kind.like),K.is(K.Kind.dislike)),K.itemTypeIs("mentionItem"))),E.U(Br)).subscribe((e=>r((n=>{t.readerGmailUpdatePersonItem({threadId:n,item:e}).catch(a("CSActions.readerGmailUpdatePersonItem"))}))))),o.add(e.pipe(O.h((0,f.W9)((0,f.Kg)(K.is(K.Kind.pin),K.is(K.Kind.dismiss),K.is(K.Kind.like),K.is(K.Kind.dislike)),K.itemTypeIs("linkItem"))),E.U(Br)).subscribe((e=>r((n=>{t.readerGmailUpdateLinkItem({threadId:n,item:e}).catch(a("CSActions.readerGmailUpdateLinkItem"))}))))),o.add(e.pipe(O.h(K.is(K.Kind.toggleInlineHighlights))).subscribe((({enabled:e})=>{t.toggleReaderInlineHighlights(e).catch(a("CSActions.toggleReaderInlineHighlights"))}))),o}(P.actions.asObservable(),v,T.threadContext,z,(e=>t=>{const n=`${e} promise rejection: ${String(t)}`;w.error(n),I.readerGmail.warning("promiseRejection",n,t)})):null,D=new xr((null==P?void 0:P.actions)||ts.E,T.threadContext,N,n,_,I),V=P?new Pr(T.threadContext.view((e=>e.messageCount)).pipe(E.U((()=>{const t=Jo(e);return b.fromNullable(t[t.length-1])})),C.oA,ut.x()),(()=>{return U.UI.mount(ga,(e=P,U.Z.composeKnot({content:U.Z.composeUnion({collapsed:He(e),expanded:qi(e),onboarding:pa(e)},(()=>e.state.pipe(E.U((e=>({kind:x(e)?"onboarding":k(e)?"expanded":"collapsed"})))))),notification:Q(e)})));var e})):null,H=z.pipe(pt.w((()=>or(p.doc))),xe.b(Ua.Pd((e=>w.warn("Error while expanding messages",e)),(e=>{switch(e){case sr.expanded:return w.trace("Messages expanded");case sr.noExpansionNeeded:return w.trace("Thread already expanded");default:(0,B.vE)(e)}}))),es.shareReplay({bufferSize:1,refCount:!0})),Z=T.threadContext.pipe(bt.q(1),xe.b((e=>{y.readerMailSessionStart(e.messageCount,N,(0,s.zG)(e.threadId,b.fromEither,b.toUndefined))}))).subscribe(),j=(0,c.W$)(e),q=j?ns.T(z.pipe(E.U((e=>{var t;return(null===(t=null==V?void 0:V.elementRef)||void 0===t?void 0:t.current)?V.elementRef.current.getBoundingClientRect().top:null}))),H.pipe(is.h(null))).pipe(as.G()).subscribe((([e,t])=>{var n;if((null===(n=null==V?void 0:V.elementRef)||void 0===n?void 0:n.current)&&null===t&&null!==e){const t=V.elementRef.current.getBoundingClientRect().top;j.scrollTop=j.scrollTop+t-e}})):null,$=H.subscribe(),W=g.pipe(pt.w((e=>e.seenOnboarding?S.of(!!e.enabled):g.pipe(O.h((e=>!!e.seenOnboarding)),E.U((e=>!!e.enabled))))),bt.q(1)),J=n.features.has("summaries")&&V?ns.T(z,V.mounted.pipe(E.U((e=>({nextActiveIndex:1/0,navigationAction:A.last}))),(0,Oo.Gx)(W))).pipe(ss.b(100),os.b((({nextActiveIndex:e,navigationAction:t})=>{const n=T.threadContext.get().messageCount,i=e=>e>=0&&e<n;switch(t){case A.left:return Ea.D([e-1,e].filter(i));case A.right:return Ea.D([e,e+1].filter(i));case A.first:return Ea.D([0,1].filter(i));case A.last:return Ea.D([n-2,n-1].filter(i));default:(0,B.vE)(t)}})),rs.zg((e=>T.threadContext.view((t=>t.messageIndexToIdMap.get(e))).pipe(O.h(Ja.fQ),bt.q(1)))),ls.R(((e,t)=>new Set(e).add(t)),new Set),(0,Oo.Yp)(cs.yv)).subscribe((e=>M.fetchSummaries(e))):null,Y=n.features.has("needsResponse")||n.features.has("inlineCards")||n.features.has("inlineHighlights")?T.threadContext.view((e=>new Set(e.messageIndexToIdMap.values()))).pipe(ls.R(((e,t)=>new Set(Array.from(e).concat(Array.from(t)))),new Set),(0,Oo.Yp)(cs.yv),(0,Oo.Gx)(W)).subscribe((e=>M.fetchAnnotations(e))):null;"prod"!==p.config.bundleInfo.env&&(0,Oo.h$)(p.doc,{threadContextManager:T,threadRemoteDataManager:M,panelViewModel:P});const ee=Date.now(),ne=Qa.x.create(e,{subtree:!0,childList:!0,attributes:!0,attributeFilter:["contenteditable"]}).pipe(E.U((e=>b.fromNullable(e.reduce(((e,t)=>null!==e?e:"attributes"==t.type&&(0,Ya.Re)(t.target)?t.target.matches(fo.kO)?t.target:null:Array.from(t.addedNodes).filter(Ya.Re).reduce(((e,t)=>null!==e?e:t.matches(fo.kO)?t:t.querySelector(fo.kO)),null)),null)))),ds.T(Ea.D(Array.from(e.querySelectorAll(fo.kO)).map(b.some))),C.oA,ut.x(),E.U((e=>(0,s.zG)(b.fromNullable(e.closest(fo.e8)),b.chain((t=>{var n,i;return a.Y(b.option)({formEl:b.fromNullable(null===(n=t.closest(fo.KC))||void 0===n?void 0:n.querySelector(fo.ZA)),buttonEl:b.fromNullable(t.querySelector(fo.DM)),messageId:(0,s.zG)(b.fromNullable(null===(i=e.closest(fo.n4))||void 0===i?void 0:i.querySelector(fo.k2)),b.chain((e=>{var t;return b.fromNullable(null===(t=e.getAttribute(fo.bq))||void 0===t?void 0:t.slice(1))}))),startTime:b.some(Date.now()-ee)})}))))),C.oA,Ie.M(T.threadContext),xe.b((([e,t])=>{y.readerMailReplyStart(N,Date.now()-ee,(0,s.zG)(t.threadId,b.fromEither,b.toUndefined))})),rs.zg((([e])=>Ze.R(e.buttonEl,"click").pipe(Ie.M(S.of(e),Wa.x.getRecipientsContextEventObservable(e.formEl,null).pipe(E.U((e=>e.length))),T.threadContext),O.h((([e,t,n])=>n>0)),xe.b((([e,t,n,i])=>{(0,s.zG)(b.fromNullable(i.expandedMessages.get(t.messageId)),b.chain(Oo.zk),Et.bw((e=>{y.readerMailReplySent(e.textMap.getPlainText().length,e.context.audience.length,n,N,Date.now()-t.startTime,(0,s.zG)(i.threadId,b.fromEither,b.toUndefined))})))})))))).subscribe();return w.debug("page integration created"),()=>{y.readerMailSessionEnd(N,(0,s.zG)(T.threadContext.get().threadId,b.fromEither,b.toUndefined)),D.dispose(),null==Y||Y.unsubscribe(),null==J||J.unsubscribe(),Z.unsubscribe(),$.unsubscribe(),null==q||q.unsubscribe(),null==V||V.dispose(),null==P||P.dispose(),F.modify((e=>(null==e||e.dispose(),null))),G.unsubscribe(),M.dispose(),T.dispose(),ne.unsubscribe(),null==R||R.unsubscribe(),w.debug("page integration disposed")}}function Br(e){switch(e.kind){case K.Kind.pin:switch(e.itemType){case"linkItem":case"mentionItem":return{...e.item,pinned:e.pinned,messagePinnedFrom:e.pinned?b.some(e.item.message):b.none};case"summaryItem":case"followUpItem":return{...e.item,pinned:e.pinned};default:(0,B.vE)(e.itemType)}break;case K.Kind.dismiss:return{...e.item,dismissed:!0};case K.Kind.like:case K.Kind.dislike:return{...e.item,rating:Ba(e.kind)};default:(0,B.vE)(e)}}},86620:(e,t,n)=>{n.d(t,{C:()=>d,U:()=>i});var i,a=n(27378),s=n(29511),o=n(33678),r=n(88056),l=n(95574);!function(e){let t;!function(e){e.isAppleSystem="isAppleSystem"}(t=e.SidebarFlag||(e.SidebarFlag={})),e.Flag={...t,...o.a.Flag},e.Context=a.createContext(r.Y.invariantContent("Environment"))}(i||(i={}));class d{constructor(e=(0,s.O)()){this._flags=new Set,this.actions={openUrl:e=>l.vM((()=>{document.location.href=e.toString()})),openPopup:e=>l.vM((()=>{const t=self.open(e.toString(),void 0,"noreferrer");t&&(t.opener=null)}))},e.config.systemInfo.os.isMac&&this._flags.add(i.Flag.isAppleSystem),this._flags.add(i.Flag.supportsSVGDominantBaseline),this._flags.add(i.Flag.onlyTrustedEvents)}has(e){return this._flags.has(e)}}},92132:(e,t,n)=>{n.d(t,{Q:()=>l});var i=n(27378),a=n(15073),s=n(60797),o=n(95300),r=n(5114);const l=({children:e,remSize:t,setter:n})=>(d+=1,i.useEffect((()=>{const e=t.subscribe((e=>{c.next(r.some(e)),n(r.some(e))}));return()=>{e.unsubscribe(),d-=1,0===d&&(c.next(r.none),n(r.none))}}),[t]),i.createElement(a.u.Context.Provider,{value:c.pipe(s.oA)},e));let d=0;const c=new o.X(r.none)},86705:(e,t,n)=>{n.d(t,{v:()=>s});var i=n(27378),a=n(80895);const s=({browser:e,className:t,title:n="BETA"})=>"safari"!==e?i.createElement(a.C,{title:n,className:t}):null},31944:(e,t,n)=>{n.d(t,{J:()=>r});var i=n(57050),a=n(27378),s=n(12187),o=n(22536);const r=({onChange:e,labelId:t,className:n,checkboxClassName:r,labelClassName:l,checked:d,children:c,disabled:m,dataGrammarlyPart:u="ui-kit-checkbox",tabIndex:p=0})=>{const[h,g]=a.useState(null!=d&&d);a.useEffect((()=>{g(Boolean(d))}),[d]);const f=t=>{t.preventDefault(),t.stopPropagation(),g(!h),null==e||e(!h)};return a.createElement("div",{"data-grammarly-part":u,...(0,s.Sh)(o.checkboxContainer,n)},a.createElement("div",{...(0,s.Sh)(o.checkbox,r,h?o.checkboxChecked:null),role:"checkbox","aria-checked":h,tabIndex:p,"aria-labelledby":t,onKeyDown:e=>{" "===e.key&&f(e)},onClick:m?i.Q1:f},h?a.createElement("div",{className:o.checkboxCheckmark}):null),a.createElement("label",{id:t,onClick:f,className:l},c))}},57053:(e,t,n)=>{n.d(t,{i:()=>o});var i=n(27378),a=n(12187),s=n(39070);const o=({maxRating:e=5,ratingLabels:t=["Not at all valuable","Slightly valuable","Somewhat valuable","Very valuable","Extremely valuable"],onChange:n,value:o,ariaLabel:r="Rating",className:l,ratingStarsClassName:d,ratingLegendClassName:c,ratingLabelsClassName:m})=>{const[u,p]=i.useState(o),[h,g]=i.useState(void 0);i.useEffect((()=>{p(o)}),[o]),i.useEffect((()=>{void 0!==u&&n(u)}),[u]);const f=[...Array(e).keys()].map((e=>e+1)),b=void 0!==h?h:u;return i.createElement("div",{"data-grammarly-part":"ui-kit-rating",role:"radiogroup","aria-label":r,...(0,a.Sh)(s.rating,l)},i.createElement("div",{...(0,a.Sh)(s.ratingStars,d),onMouseLeave:()=>g(void 0)},f.map((e=>{const t=void 0!==b&&b>=e;return i.createElement("input",{key:`rating-${e}`,id:`rating-${e}`,type:"radio",name:"rating",checked:u===e,onChange:e=>p(parseInt(e.target.value,10)),value:e,onMouseEnter:e=>{const t=e.target;g(parseInt(t.value,10))},...(0,a.Sh)(s.ratingStar,t?s.ratingStarFilled:null)})}))),i.createElement("div",{...(0,a.Sh)(s.ratingLabels,m)},f.map((e=>i.createElement("label",{key:`rating-label-${e}`,htmlFor:`rating-${e}`,...(0,a.Sh)(b===e?s.ratingLabelVisible:s.ratingLabelNotVisible)},t[e-1])))),void 0!==b?null:i.createElement("div",{...(0,a.Sh)(s.ratingLegend,c)},i.createElement("div",null,t[0]),i.createElement("div",null,t[f.length-1])))}},18347:(e,t,n)=>{n.d(t,{Eh:()=>a,Od:()=>o,e5:()=>s,nI:()=>r});var i=n(13853),a=(i.ZN,new Set,i.AO,i.Eh);i.G,i.UI,i.yW,i.tS,i.KX;i.t9,i.G0,i.jV,i.tV;var s=i.e5,o=(i.Lf,i.oP,i.u4,i.Lx,i.ri,i.$T,i.Od);var r=i.nI;i.oA,i.xu,i.DZ},31846:e=>{e.exports={avatar:"xNYnb",image:"_3Yg3q"}},83771:e=>{e.exports={layout:"_1hKpE",column:"_1rBJw",scrollView:"_1wR-W",sectionTitle:"-RBKX"}},47397:e=>{e.exports={empty:"_1XVf-",title:"_2AfjV",body:"_21gih"}},93253:e=>{e.exports={item:"_27MUw",content:"e2xP-",moreButton:"_2is65",pinned:"_1L-Hp",ellipsis:"_2TIW4"}},67465:e=>{e.exports={menu:"_1f4lm",pinned:"_1uRyx",button:"_12QVt",separator:"Q9ySg",inactiveIcon:"_2taPz"}},50243:e=>{e.exports={list:"u22ST"}},38459:e=>{e.exports={linkAndIcon:"_2mO4u",link:"_3djIE",linkWrapper:"kGyxh",icon:"_26TDA"}},45587:e=>{e.exports={itemLoading:"KdASy",lineOnly:"_3gA50",line:"_3btGG",lineLoading:"_3W_2s",rect:"_2Ln0z",rectLoading:"_1pxCc",lineAndCheckbox:"_3ZgMs",lineAndAvatar:"_1j1Dr"}},93383:e=>{e.exports={personAndAvatar:"_29ogH",nameOrEmail:"_3QT6s"}},69566:e=>{e.exports={title:"rOb7m"}},11071:e=>{e.exports={textChecked:"_1Sg3F",checkboxWrapper:"_45wj5",label:"_1ybvy",checkbox:"T4rHe",itemText:"pqhgN"}},83581:e=>{e.exports={itemText:"_3h7i6"}},69350:e=>{e.exports={emptyCTAButton:"_2-zk6"}},48789:e=>{e.exports={loader:"_38SVK"}},79579:e=>{e.exports={emptyCTAButton:"_3kUpB"}},78870:e=>{e.exports={dialog:"_2-QQ0",header:"_1EWW5",headerGroup:"_1JdLn",buttons:"_3p63M",textbox:"_1CLrn",requiredTextBox:"_2T8Ox",requiredLabel:"_3HHRw"}},61033:e=>{e.exports={panelOverlay:"_1qTMO",dialog:"yOM_O"}},56229:e=>{e.exports={title:"_2k48T",rating:"_3V8Jf",ratingContainer:"_3T2eO",ratingStars:"_1WWyq",ratingLegend:"_9LsLz",ratingLabels:"_1j0UE",requiredLabel:"yOJki"}},35115:e=>{e.exports={title:"_57M23",description:"_2sj__"}},89739:e=>{e.exports={activeMailInfo:"_31J8M",date:"fHbk9",author:"BD2pG"}},37903:e=>{e.exports={header:"_1mfP5"}},14692:e=>{e.exports={navigationFrame:"v_SsT",buttonGroup:"_3n1p4",iconJump:"_22-y3",iconGoFirst:"_2OzZD",icon:"_3hVGV"}},16204:e=>{e.exports={buttonGroup:"_2tWWr",button:"_1jXO0"}},76168:e=>{e.exports={notification:"_1xXpR"}},40349:e=>{e.exports={controls:"_2Hipc",onboardingButtonGroup:"_-9OmU",optInButton:"_5OTjn",optOutButton:"_30tah",navigation:"_1jU2d",leftButton:"P6wpw",rightButton:"_3CBvI",arrowRight:"D-jgQ",stepOfN:"_1HJSf"}},57391:e=>{e.exports={illustration:"fcee3"}},51869:e=>{e.exports={onboarding:"_2ODbM",logo:"Lr1qJ",content:"_3-26v",badge:"_3POlX",steps:"_31CBV"}},19230:e=>{e.exports={title:"gf4R_",body:"_2Vehu"}},23556:e=>{e.exports={header:"_3kzGL"}},86885:e=>{e.exports={panelWrapper:"dVcQ2"}},35300:e=>{e.exports={onboarding:"_1hppt",toolbar:"_38d_I"}},64908:e=>{e.exports={panelGrid:"_1oojw",header:"_15T_5",toolbar:"_3jOrT"}},58120:e=>{e.exports={recapButton:"_318vF",logo:"Tn0sZ",recap:"_3L1sH"}},22536:e=>{e.exports={checkboxContainer:"_3bj_g",checkbox:"xrB8R",checkboxChecked:"Uhddy",checkboxCheckmark:"_1qI2g",spin:"_3S_a3"}},39070:e=>{e.exports={rating:"_2oJv0",ratingStars:"_3FAXT",ratingStar:"_1p53S",ratingStarFilled:"_1E3qz",ratingLabels:"jzPuo",ratingLabelVisible:"_3yF9v",ratingLabelNotVisible:"_2zNv4",ratingLegend:"_1XbY_",spin:"fu5_3"}},39335:(e,t,n)=>{var i={superfasthash:n(11028),murmurhash3:n(13786)};e.exports={createHash:function(e){e=e.replace(/![a-zA-z0-9]/g,"").toLowerCase();try{return i[e]}catch(e){throw new Error(e)}}}},13786:(e,t,n)=>{var i=n(81314);function a(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function s(e,t){return e<<t|e>>>32-t}function o(e){return e=a(e^=e>>>16,2246822507),e=a(e^=e>>>13,3266489909),e^=e>>>16}function r(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]+t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]+t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]+t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]+t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function l(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]*t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]*t[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=e[3]*t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]*t[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[2]*t[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[3]*t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function d(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function c(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function m(e,t){return[e[0]^t[0],e[1]^t[1]]}function u(e){return e=m(e,[0,e[0]>>>1]),e=m(e=l(e,[4283543511,3981806797]),[0,e[0]>>>1]),e=m(e=l(e,[3301882366,444984403]),[0,e[0]>>>1])}var p=function(e,t){e=""+e||"";var n=i.toU8IntArray(e);t=t||0;for(var a=(e={charCodeAt:function(e){return n[e]},length:n.length}).length%16,s=e.length-a,o=[0,t],p=[0,t],h=[0,0],g=[0,0],f=[2277735313,289559509],b=[1291169091,658871167],v=0;v<s;v+=16)h=[255&e.charCodeAt(v+4)|(255&e.charCodeAt(v+5))<<8|(255&e.charCodeAt(v+6))<<16|(255&e.charCodeAt(v+7))<<24,255&e.charCodeAt(v)|(255&e.charCodeAt(v+1))<<8|(255&e.charCodeAt(v+2))<<16|(255&e.charCodeAt(v+3))<<24],g=[255&e.charCodeAt(v+12)|(255&e.charCodeAt(v+13))<<8|(255&e.charCodeAt(v+14))<<16|(255&e.charCodeAt(v+15))<<24,255&e.charCodeAt(v+8)|(255&e.charCodeAt(v+9))<<8|(255&e.charCodeAt(v+10))<<16|(255&e.charCodeAt(v+11))<<24],h=d(h=l(h,f),31),o=r(o=d(o=m(o,h=l(h,b)),27),p),o=r(l(o,[0,5]),[0,1390208809]),g=d(g=l(g,b),33),p=r(p=d(p=m(p,g=l(g,f)),31),o),p=r(l(p,[0,5]),[0,944331445]);switch(h=[0,0],g=[0,0],a){case 15:g=m(g,c([0,e.charCodeAt(v+14)],48));case 14:g=m(g,c([0,e.charCodeAt(v+13)],40));case 13:g=m(g,c([0,e.charCodeAt(v+12)],32));case 12:g=m(g,c([0,e.charCodeAt(v+11)],24));case 11:g=m(g,c([0,e.charCodeAt(v+10)],16));case 10:g=m(g,c([0,e.charCodeAt(v+9)],8));case 9:g=l(g=m(g,[0,e.charCodeAt(v+8)]),b),p=m(p,g=l(g=d(g,33),f));case 8:h=m(h,c([0,e.charCodeAt(v+7)],56));case 7:h=m(h,c([0,e.charCodeAt(v+6)],48));case 6:h=m(h,c([0,e.charCodeAt(v+5)],40));case 5:h=m(h,c([0,e.charCodeAt(v+4)],32));case 4:h=m(h,c([0,e.charCodeAt(v+3)],24));case 3:h=m(h,c([0,e.charCodeAt(v+2)],16));case 2:h=m(h,c([0,e.charCodeAt(v+1)],8));case 1:h=l(h=m(h,[0,e.charCodeAt(v)]),f),o=m(o,h=l(h=d(h,31),b))}return o=r(o=m(o,[0,e.length]),p=m(p,[0,e.length])),p=r(p,o),o=r(o=u(o),p=u(p)),p=r(p,o),("00000000"+(o[0]>>>0).toString(16)).slice(-8)+("00000000"+(o[1]>>>0).toString(16)).slice(-8)+("00000000"+(p[0]>>>0).toString(16)).slice(-8)+("00000000"+(p[1]>>>0).toString(16)).slice(-8)};e.exports={x86Hash32:function(e,t){e=""+e||"";var n=i.toU8IntArray(e);t=t||0;for(var r=(e={charCodeAt:function(e){return n[e]},length:n.length}).length%4,l=e.length-r,d=t,c=0,m=3432918353,u=461845907,p=0;p<l;p+=4)c=a(c=255&e.charCodeAt(p)|(255&e.charCodeAt(p+1))<<8|(255&e.charCodeAt(p+2))<<16|(255&e.charCodeAt(p+3))<<24,m),c=a(c=s(c,15),u),d=a(d=s(d^=c,13),5)+3864292196;switch(c=0,r){case 3:c^=(255&e.charCodeAt(p+2))<<16;case 2:c^=(255&e.charCodeAt(p+1))<<8;case 1:c=a(c^=255&e.charCodeAt(p),m),d^=c=a(c=s(c,15),u)}return((d=o(d^=e.length))>>>0).toString(16)},x86Hash128:function(e,t){e=""+e||"";var n=i.toU8IntArray(e);t=t||0;for(var r=(e={charCodeAt:function(e){return n[e]},length:n.length}).length%16,l=e.length-r,d=t,c=t,m=t,u=t,p=0,h=0,g=0,f=0,b=597399067,v=2869860233,k=951274213,y=2716044179,I=0;I<l;I+=16)p=255&e.charCodeAt(I)|(255&e.charCodeAt(I+1))<<8|(255&e.charCodeAt(I+2))<<16|(255&e.charCodeAt(I+3))<<24,h=255&e.charCodeAt(I+4)|(255&e.charCodeAt(I+5))<<8|(255&e.charCodeAt(I+6))<<16|(255&e.charCodeAt(I+7))<<24,g=255&e.charCodeAt(I+8)|(255&e.charCodeAt(I+9))<<8|(255&e.charCodeAt(I+10))<<16|(255&e.charCodeAt(I+11))<<24,f=255&e.charCodeAt(I+12)|(255&e.charCodeAt(I+13))<<8|(255&e.charCodeAt(I+14))<<16|(255&e.charCodeAt(I+15))<<24,p=s(p=a(p,b),15),d=s(d^=p=a(p,v),19),d=a(d+=c,5)+1444728091,h=s(h=a(h,v),16),c=s(c^=h=a(h,k),17),c=a(c+=m,5)+197830471,g=s(g=a(g,k),17),m=s(m^=g=a(g,y),15),m=a(m+=u,5)+2530024501,f=s(f=a(f,y),18),u=s(u^=f=a(f,b),13),u=a(u+=d,5)+850148119;switch(p=0,h=0,g=0,f=0,r){case 15:f^=e.charCodeAt(I+14)<<16;case 14:f^=e.charCodeAt(I+13)<<8;case 13:f=a(f^=e.charCodeAt(I+12),y),u^=f=a(f=s(f,18),b);case 12:g^=e.charCodeAt(I+11)<<24;case 11:g^=e.charCodeAt(I+10)<<16;case 10:g^=e.charCodeAt(I+9)<<8;case 9:g=a(g^=e.charCodeAt(I+8),k),m^=g=a(g=s(g,17),y);case 8:h^=e.charCodeAt(I+7)<<24;case 7:h^=e.charCodeAt(I+6)<<16;case 6:h^=e.charCodeAt(I+5)<<8;case 5:h=a(h^=e.charCodeAt(I+4),v),c^=h=a(h=s(h,16),k);case 4:p^=e.charCodeAt(I+3)<<24;case 3:p^=e.charCodeAt(I+2)<<16;case 2:p^=e.charCodeAt(I+1)<<8;case 1:p=a(p^=e.charCodeAt(I),b),d^=p=a(p=s(p,15),v)}return d^=e.length,d+=c^=e.length,d+=m^=e.length,c+=d+=u^=e.length,m+=d,u+=d,d=o(d),d+=c=o(c),d+=m=o(m),c+=d+=u=o(u),m+=d,u+=d,("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(c>>>0).toString(16)).slice(-8)+("00000000"+(m>>>0).toString(16)).slice(-8)+("00000000"+(u>>>0).toString(16)).slice(-8)},x64Hash64:function(e,t){return p(e,t).slice(8)},x64Hash128:p,hash:function(e,t){return p(e,t)}}},11028:(e,t,n)=>{var i=n(81314);function a(e,t){return e[t]<<8|e[t+1]}e.exports={hash:function(e){var t,n=i.toU8IntArray(e+""),s=0;if(!e)return s.toString(16);var o=n.length,r=0;t=3&o,o>>>=2;for(var l=0;l<o;l++)s=(s+=a(n,r))<<16^(a(n,r+2)<<11^s),r+=4,s+=s>>11;switch(t){case 3:s+=a(n,r),s^=s<<16,s^=n[r+2]<<18,s+=s>>11;break;case 2:s+=a(n,r),s^=s<<11,s+=s>>17;break;case 1:s+=n[r],s^=s<<10,s+=s>>1}return s^=s<<3,s+=s>>5,s^=s<<4,s+=s>>17,s^=s<<25,s+=s>>6,i.intToUnsignedHex(s)}}},81314:e=>{e.exports={toU8IntArray:function(e){for(var t=[],n=[],i=0;i<e.length;i++){var a,s=e.charCodeAt(i);for(n.length=0;(a=255&s)||s;)n.push(a),s>>>=8;t=t.concat(n.reverse())}return t},intToUnsignedHex:function(e){for(var t,n=[];(t=65535&e)||e;)t=t.toString(16),t="0000".slice(t.length)+t,n.push(t),e>>>=16;return n.reverse().join("")}}}}]);